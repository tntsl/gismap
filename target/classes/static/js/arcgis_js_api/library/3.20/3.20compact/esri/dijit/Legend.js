// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.20/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/debounce":function(){define([],function(){return function(r,q){var p;return function(){p&&clearTimeout(p);var d=this,h=arguments;p=setTimeout(function(){r.apply(d,h)},q)}}})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(r,q,p){r.DeferredList=function(d,h,k,m,a){var f=[];q.call(this);var r=this;0!==d.length||h||this.resolve([0,[]]);var E=0;p.forEach(d,function(a,p){function q(c,a){f[p]=[c,a];E++;E===d.length&&r.resolve(f)}
a.then(function(c){h?r.resolve([p,c]):q(!0,c)},function(c){k?r.reject(c):q(!1,c);if(m)return null;throw c;})})};r.DeferredList.prototype=new q;r.DeferredList.prototype.gatherResults=function(d){d=new r.DeferredList(d,!1,!0,!1);d.addCallback(function(d){var h=[];p.forEach(d,function(d){h.push(d[1])});return h});return d};return r.DeferredList})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(r,q,p,d,h,k,m,a,f,J,E,y,C){function v(){}function c(c){return function(a,g,d,f){return a&&"string"==typeof g&&a[g]==v?a.on(g.substring(2).toLowerCase(),m.hitch(d,f)):c.apply(p,arguments)}}r.around(p,"connect",c);k.connect&&r.around(k,"connect",c);r=d("dijit._Widget",[E,y,C],{onClick:v,onDblClick:v,onKeyDown:v,onKeyPress:v,onKeyUp:v,onMouseDown:v,onMouseMove:v,onMouseOut:v,onMouseOver:v,onMouseLeave:v,onMouseEnter:v,onMouseUp:v,constructor:function(c){this._toConnect={};for(var a in c)this[a]===
v&&(this._toConnect[a.replace(/^on/,"").toLowerCase()]=c[a],delete c[a])},postCreate:function(){this.inherited(arguments);for(var c in this._toConnect)this.on(c,this._toConnect[c]);delete this._toConnect},on:function(c,a){return this[this._onMap(c)]===v?p.connect(this.domNode,c.toLowerCase(),this,a):this.inherited(arguments)},_setFocusedAttr:function(c){this._focused=c;this._set("focused",c)},setAttribute:function(c,a){k.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(c,a)},attr:function(c,a){return 2<=arguments.length||"object"===typeof c?this.set.apply(this,arguments):this.get(c)},getDescendants:function(){k.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?a("[widgetId]",this.containerNode).map(J.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});h("dijit-legacy-requires")&&f(0,function(){require(["dijit/_base"])});
return r})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(r,q,p,d,h,k,m,a,f,J,E,y,C,v,c,w,H,g,u,F,B,T,G){function L(c){return function(z){a[z?
"set":"remove"](this.domNode,c,z);this._set(c,z)}}C.add("dijit-legacy-requires",!v.isAsync);C.add("dojo-bidi",!1);C("dijit-legacy-requires")&&H(0,function(){r(["dijit/_base/manager"])});var I={};d=k("dijit._WidgetBase",[g,B],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:L("lang"),dir:"",_setDirAttr:L("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(c){this._set("ownerDocument",
c)},attributeMap:{},_blankGif:d.blankGif||r.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var c=this.constructor;if(!c._setterAttrs){var a=c.prototype,d=c._setterAttrs=[],c=c._onMap={},g;for(g in a.attributeMap)d.push(g);for(g in a)/^on/.test(g)&&(c[g.substring(2).toLowerCase()]=g),/^_set[A-Z](.*)Attr$/.test(g)&&(g=g.charAt(4).toLowerCase()+g.substr(5,g.length-9),a.attributeMap&&g in a.attributeMap||d.push(g))}},postscript:function(c,a){this.create(c,a)},create:function(a,g){this._introspect();
this.srcNodeRef=m.byId(g);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,c.mixin(this,a));this.postMixInProperties();this.id||(this.id=G.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=F.body(this.ownerDocument);G.add(this);
this.buildRendering();var z;if(this.domNode){this._applyAttributes();var d=this.srcNodeRef;d&&d.parentNode&&this.domNode!==d&&(d.parentNode.replaceChild(this.domNode,d),z=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();z&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var c={},a;for(a in this.params||{})c[a]=this._get(a);q.forEach(this.constructor._setterAttrs,function(a){if(!(a in c)){var g=this._get(a);g&&this.set(a,g)}},this);for(a in c)this.set(a,c[a])},
postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var c=this.baseClass.split(" ");this.isLeftToRight()||(c=c.concat(q.map(c,function(c){return c+"Rtl"})));f.add(this.domNode,c)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,q.forEach(this.getChildren(),function(a){a._started||a._destroyed||!c.isFunction(a.startup)||(a.startup(),a._started=!0)}))},destroyRecursive:function(c){this._beingDestroyed=
!0;this.destroyDescendants(c);this.destroy(c)},destroy:function(a){function g(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();q.forEach(this._connects,c.hitch(this,"disconnect"));q.forEach(this._supportingWidgets,g);this.domNode&&q.forEach(G.findWidgets(this.domNode,this.containerNode),g);this.destroyRendering(a);G.remove(this.id);this._destroyed=!0},destroyRendering:function(c){this.bgIframe&&(this.bgIframe.destroy(c),delete this.bgIframe);
this.domNode&&(c?a.remove(this.domNode,"widgetId"):J.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(c||J.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(c){q.forEach(this.getChildren(),function(a){a.destroyRecursive&&a.destroyRecursive(c)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var g=this.domNode;c.isObject(a)?y.set(g,a):g.style.cssText=g.style.cssText?g.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(g,d,u){u=3<=
arguments.length?u:this.attributeMap[g];q.forEach(c.isArray(u)?u:[u],function(u){var m=this[u.node||u||"domNode"];switch(u.type||"attribute"){case "attribute":c.isFunction(d)&&(d=c.hitch(this,d));u=u.attribute?u.attribute:/^on[A-Z][a-zA-Z]*$/.test(g)?g.toLowerCase():g;m.tagName?a.set(m,u,d):m.set(u,d);break;case "innerText":m.innerHTML="";m.appendChild(this.ownerDocument.createTextNode(d));break;case "innerHTML":m.innerHTML=d;break;case "class":f.replace(m,d,this[g]);break;case "toggleClass":f.toggle(m,
u.className||g,d)}},this)},get:function(c){var a=this._getAttrNames(c);return this[a.g]?this[a.g]():this._get(c)},set:function(a,g){if("object"===typeof a){for(var d in a)this.set(d,a[d]);return this}d=this._getAttrNames(a);var u=this[d.s];if(c.isFunction(u))var f=u.apply(this,Array.prototype.slice.call(arguments,1));else{var u=this.focusNode&&!c.isFunction(this.focusNode)?"focusNode":"domNode",m=this[u]&&this[u].tagName,h;if((h=m)&&!(h=I[m])){h=this[u];var k={},z;for(z in h)k[z.toLowerCase()]=!0;
h=I[m]=k}z=h;d=a in this.attributeMap?this.attributeMap[a]:d.s in this?this[d.s]:z&&d.l in z&&"function"!=typeof g||/^aria-|^data-|^role$/.test(a)?u:null;null!=d&&this._attrToDom(a,g,d);this._set(a,g)}return f||this},_attrPairNames:{},_getAttrNames:function(c){var a=this._attrPairNames;if(a[c])return a[c];var g=c.replace(/^[a-z]|-[a-zA-Z]/g,function(c){return c.charAt(c.length-1).toUpperCase()});return a[c]={n:c+"Node",s:"_set"+g+"Attr",g:"_get"+g+"Attr",l:g.toLowerCase()}},_set:function(c,a){var g=
this[c];this[c]=a;!this._created||g===a||g!==g&&a!==a||(this._watchCallbacks&&this._watchCallbacks(c,g,a),this.emit("attrmodified-"+c,{detail:{prevValue:g,newValue:a}}))},_get:function(c){return this[c]},emit:function(c,a,g){a=a||{};void 0===a.bubbles&&(a.bubbles=!0);void 0===a.cancelable&&(a.cancelable=!0);a.detail||(a.detail={});a.detail.widget=this;var d,u=this["on"+c];u&&(d=u.apply(this,g?g:[a]));this._started&&!this._beingDestroyed&&w.emit(this.domNode,c.toLowerCase(),a);return d},on:function(c,
a){var g=this._onMap(c);return g?p.after(this,g,a,!0):this.own(w(this.domNode,c,a))[0]},_onMap:function(c){var a=this.constructor,g=a._onMap;if(!g){var g=a._onMap={},d;for(d in a.prototype)/^on/.test(d)&&(g[d.replace(/^on/,"").toLowerCase()]=d)}return g["string"==typeof c&&c.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?G.findWidgets(this.containerNode):[]},getParent:function(){return G.getEnclosingWidget(this.domNode.parentNode)},
connect:function(c,a,g){return this.own(h.connect(c,a,this,g))[0]},disconnect:function(c){c.remove()},subscribe:function(a,g){return this.own(u.subscribe(a,c.hitch(this,g)))[0]},unsubscribe:function(c){c.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():E.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=y.get(this.domNode,"display")},placeAt:function(c,a){var g=!c.tagName&&G.byId(c);!g||!g.addChild||a&&"number"!==typeof a?(g=g&&"domNode"in
g?g.containerNode&&!/after|before|replace/.test(a||"")?g.containerNode:g.domNode:m.byId(c,this.ownerDocument),J.place(this.domNode,g,a),!this._started&&(this.getParent()||{})._started&&this.startup()):g.addChild(this,a);return this},defer:function(a,g){var d=setTimeout(c.hitch(this,function(){d&&(d=null,this._destroyed||c.hitch(this,a)())}),g||0);return{remove:function(){d&&(clearTimeout(d),d=null);return null}}}});C("dojo-bidi")&&d.extend(T);return d})},"dijit/Destroyable":function(){define(["dojo/_base/array",
"dojo/aspect","dojo/_base/declare"],function(r,q,p){return p("dijit.Destroyable",null,{destroy:function(d){this._destroyed=!0},own:function(){var d=["destroyRecursive","destroy","remove"];r.forEach(arguments,function(h){function k(){a.remove();r.forEach(f,function(a){a.remove()})}var m,a=q.before(this,"destroy",function(a){h[m](a)}),f=[];h.then?(m="cancel",h.then(k,k)):r.forEach(d,function(a){"function"===typeof h[a]&&(m||(m=a),f.push(q.after(h,a,k,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),
function(r,q,p,d,h,k){r=d("dijit._OnDijitClickMixin",null,{connect:function(d,a,f){return this.inherited(arguments,[d,"ondijitclick"==a?k:a,f])}});r.a11yclick=k;return r})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(r,q,p,d){d.extend(q,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return p("dijit._FocusMixin",null,{_focusManager:r})})},"dijit/hccss":function(){define(["dojo/dom-class",
"dojo/hccss","dojo/domReady","dojo/_base/window"],function(r,q,p,d){p(function(){q("highcontrast")&&r.add(d.body(),"dijit_a11y")});return q})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(r,q,p,d,h,k,m){h.add("highcontrast",function(){var a=m.doc.createElement("div");try{a.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(q.blankGif||
r.toUrl("./resources/blank.gif"))+'");';m.body().appendChild(a);var f=d.getComputedStyle(a),k=f.backgroundImage;return f.borderTopColor==f.borderRightColor||k&&("none"==k||"url(invalid-url:)"==k)}catch(E){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+E.toString()),!1}finally{8>=h("ie")?a.outerHTML="":m.body().removeChild(a)}});k(function(){h("highcontrast")&&p.add(m.body(),"dj_a11y")});return h})},"dojox/html/entities":function(){define(["dojo/_base/lang"],
function(r){var q=r.getObject("dojox.html.entities",!0),p=function(d,k){var m,a;if(k._encCache&&k._encCache.regexp&&k._encCache.mapper&&k.length==k._encCache.length)m=k._encCache.mapper,a=k._encCache.regexp;else{m={};a=["["];var f;for(f=0;f<k.length;f++)m[k[f][0]]="\x26"+k[f][1]+";",a.push(k[f][0]);a.push("]");a=new RegExp(a.join(""),"g");k._encCache={mapper:m,regexp:a,length:k.length}}return d=d.replace(a,function(a){return m[a]})},d=function(d,k){var m,a;if(k._decCache&&k._decCache.regexp&&k._decCache.mapper&&
k.length==k._decCache.length)m=k._decCache.mapper,a=k._decCache.regexp;else{m={};a=["("];var f;for(f=0;f<k.length;f++){var h="\x26"+k[f][1]+";";f&&a.push("|");m[h]=k[f][0];a.push(h)}a.push(")");a=new RegExp(a.join(""),"g");k._decCache={mapper:m,regexp:a,length:k.length}}return d=d.replace(a,function(a){return m[a]})};q.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];q.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],
["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0",
"Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da",
"Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4",
"ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f",
"Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3",
"sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0",
"lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245",
"cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],
["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];q.encode=function(d,k){d&&(k?
d=p(d,k):(d=p(d,q.html),d=p(d,q.latin)));return d};q.decode=function(h,k){h&&(k?h=d(h,k):(h=d(h,q.html),h=d(h,q.latin)));return h};return q})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(r,q,p,d){var h=function(d,a){return d-a},k={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(d){var a=String(d),f=a.match(k._reNumber);d={integer:0,fractional:0};f&&f[1]?(d.integer=f[1].split("").length,d.fractional=f[3]?f[3].split("").length:
0):-1<a.toLowerCase().indexOf("e")&&(f=a.split("e"),a=f[0],f=f[1],a&&f&&(a=Number(a),f=Number(f),(d=0<f)||(f=Math.abs(f)),a=k.getDigits(a),d?(a.integer+=f,a.fractional=f>a.fractional?0:a.fractional-f):(a.fractional+=f,a.integer=f>a.integer?1:a.integer-f),d=a));return d},getFixedNumbers:function(d,a){var f,m;f=Number(d.toFixed(a));f<d?m=f+1/Math.pow(10,a):(m=f,f-=1/Math.pow(10,a));f=Number(f.toFixed(a));m=Number(m.toFixed(a));return[f,m]},getPctChange:function(d,a,f,k){var m={prev:null,next:null},
h;null!=f&&(h=d-f,m.prev=Math.floor(Math.abs(100*(a-f-h)/h)));null!=k&&(h=k-d,m.next=Math.floor(Math.abs(100*(k-a-h)/h)));return m},round:function(d,a){var f=d.slice(0),m,p,r,q,v,c,w,H,g,u=a&&null!=a.tolerance?a.tolerance:2,F=a&&a.indexes,B=a&&null!=a.strictBounds?a.strictBounds:!1;if(F)F.sort(h);else for(F=[],c=0;c<f.length;c++)F.push(c);for(c=0;c<F.length;c++)if(g=F[c],m=f[g],p=0===g?null:f[g-1],r=g===f.length-1?null:f[g+1],q=k.getDigits(m),q=q.fractional){w=0;for(H=!1;w<=q&&!H;)v=k.getFixedNumbers(m,
w),v=B&&0===c?v[1]:v[0],H=k.hasMinimalChange(m,v,p,r,u),w++;H&&(f[g]=v)}return f},hasMinimalChange:function(d,a,f,h,p){d=k.getPctChange(d,a,f,h);a=null==d.prev||d.prev<=p;f=null==d.next||d.next<=p;return a&&f||d.prev+d.next<=2*p},_reAllZeros:new RegExp("\\"+p.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$","g"),format:function(d,a){a=a||{places:20,round:-1};var f=q.format(d,a);f&&(f=f.replace(k._reSomeZeros,"$1").replace(k._reAllZeros,""));return f}};r("extend-esri")&&(d.numberUtils=k);return k})},
"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!../nls/jsapi dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(r,q,p,d,h,k,m,a,f){function J(c){return c&&q.map(c,function(c){return new m(c)})}function E(c,a,d){var g="";0===a?g=C.lt+" ":a===d&&(g=C.gt+" ");return g+c}var y={},C={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},v={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},
c={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},w={formatLength:"short",
fullYear:!0},H={formatLength:"short"};r.mixin(y,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(c,a){var g,u=[];null==c||c instanceof Date||(c=new Date(c));a=a||{};a=r.mixin({},a);var h=a.selector?a.selector.toLowerCase():null;g=!h||-1<h.indexOf("time");h=!h||-1<h.indexOf("date");g&&(a.timeOptions=a.timeOptions||H,a.timeOptions&&(a.timeOptions=r.mixin({},a.timeOptions),a.timeOptions.selector=a.timeOptions.selector||"time",u.push(a.timeOptions)));
h&&(a.dateOptions=a.dateOptions||w,a.dateOptions&&(a.dateOptions=r.mixin({},a.dateOptions),a.dateOptions.selector=a.dateOptions.selector||"date",u.push(a.dateOptions)));u&&u.length?(u=q.map(u,function(a){return d.format(c,a)}),g=1==u.length?u[0]:f["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,c){return u[c]})):g=d.format(c);return g},createColorStops:function(a){var c=a.values,d=a.colors,g=a.labelIndexes,f=a.isDate,h=a.dateFormatOptions;a=[];return a=q.map(c,function(a,
u){var m=null;if(!g||-1<q.indexOf(g,u)){var p;(p=f?y.formatDate(a,h):k.format(a))&&(m=E(p,u,c.length-1))}return{value:a,color:d[u],label:m}})},updateColorStops:function(a){var c=a.stops,d=a.changes,g=a.isDate,f=a.dateFormatOptions,h=[],m,p=q.map(c,function(a){return a.value});q.forEach(d,function(a){h.push(a.index);p[a.index]=a.value});m=k.round(p,{indexes:h});q.forEach(c,function(a,d){a.value=p[d];if(null!=a.label){var u,h=null;(u=g?y.formatDate(m[d],f):k.format(m[d]))&&(h=E(u,d,c.length-1));a.label=
h}})},createClassBreakLabel:function(c){var d=c.minValue,g=c.maxValue,f=c.isFirstBreak?"":C.gt+" ";c="percent-of-total"===c.normalizationType?C.pct:"";d=null==d?"":k.format(d);g=null==g?"":k.format(g);return f+d+c+" "+a.smartMapping.minToMax+" "+g+c},setLabelsForClassBreaks:function(a){var c=a.classBreaks,d=a.classificationMethod,g=a.normalizationType,f=[];c&&c.length&&("standard-deviation"===d?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):
a.round?(f.push(c[0].minValue),q.forEach(c,function(a){f.push(a.maxValue)}),f=k.round(f),q.forEach(c,function(a,c){a.label=y.createClassBreakLabel({minValue:0===c?f[0]:f[c],maxValue:f[c+1],isFirstBreak:0===c,normalizationType:g})})):q.forEach(c,function(a,c){a.label=y.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===c,normalizationType:g})}))},updateClassBreak:function(a){var c=a.classBreaks,d=a.normalizationType,g=a.change,f=g.index,g=g.value,h=-1,m=-1,p=c.length;"standard-deviation"===
a.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===f?h=f:f===p?m=f-1:(m=f-1,h=f),-1<h&&h<p&&(a=c[h],a.minValue=g,a.label=y.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===h,normalizationType:d})),-1<m&&m<p&&(a=c[m],a.maxValue=g,a.label=y.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===m,normalizationType:d})))},calculateDateFormatInterval:function(a){var c,
d,g=a.length,f,h,m,p,k,r,w=Infinity,y;a=q.map(a,function(a){return new Date(a)});for(c=0;c<g-1;c++){f=a[c];m=[];k=Infinity;r="";for(d=c+1;d<g;d++)h=a[d],h=f.getFullYear()!==h.getFullYear()&&"year"||f.getMonth()!==h.getMonth()&&"month"||f.getDate()!==h.getDate()&&"day"||f.getHours()!==h.getHours()&&"hour"||f.getMinutes()!==h.getMinutes()&&"minute"||f.getSeconds()!==h.getSeconds()&&"second"||"millisecond",p=v[h],p<k&&(k=p,r=h),m.push(h);k<w&&(w=k,y=r)}return y},createUniqueValueLabel:function(a){var d=
a.value,g=a.fieldInfo,f=a.domain;a=a.dateFormatInterval;var h=String(d);(f=f&&f.codedValues?f.getName(d):null)?h=f:"number"===typeof d&&(h=g&&"esriFieldTypeDate"===g.type?y.formatDate(d,a&&c[a]):k.format(d));return h},cloneColorInfo:function(a){var c;a&&(c=r.mixin({},a),c.colors=J(c.colors),c.stops=c.stops&&q.map(c.stops,function(a){a=r.mixin({},a);a.color&&(a.color=new m(a.color));return a}),c.legendOptions&&(c.legendOptions=r.mixin({},c.legendOptions)));return c},cloneOpacityInfo:function(a){var c;
if(a){c=r.mixin({},a);if(a=c.opacityValues)c.opacityValues=a.slice(0);if(a=c.stops)c.stops=q.map(a,function(a){return r.mixin({},a)});if(a=c.legendOptions)c.legendOptions=r.mixin({},a)}return c},cloneSizeInfo:function(a){var c;a&&(c=r.mixin({},a),c.stops&&(c.stops=q.map(c.stops,function(a){return r.mixin({},a)})),(a=c.minSize)&&"object"===typeof a&&(c.minSize=y.cloneSizeInfo(a)),(a=c.maxSize)&&"object"===typeof a&&(c.maxSize=y.cloneSizeInfo(a)),a=c.legendOptions)&&(c.legendOptions=r.mixin({},a),a=
a.customValues)&&(c.legendOptions.customValues=a.slice(0));return c}});p("extend-esri")&&r.setObject("renderer.utils",y,h);return y})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(r,q,p,d,h,k){return r([k,h],{_onMap:function(d){var a=this.constructor._onMap,f;a&&a.FINAL||(delete this.constructor._onMap,a=this.registerConnectEvents(),a.FINAL=!0);d=d.toLowerCase();a[d]?f=this[a[d].method]:(d=this._onCamelCase(d),
this[d]&&(f=d));return f},on:function(h,a){var f=this._onMap(h),p=h.replace(/\-/g,""),k="on"+p in this.domNode;return f||!k?this.inherited(arguments):this.own(d(this.domNode,p,a))[0]},emit:function(d,a,f){var h,p,k,m=d.toLowerCase(),r=this.constructor._onMap||this.registerConnectEvents();p=this[this._onMap(m)];a=a||{};a.target||(a.target=this);p&&r&&r[m]&&(this._onObj2Arr(function(){h=Array.prototype.slice.call(arguments)},r[m].argKeys)(a),k=q.mixin({},arguments),k[2]=h,k[0]=r[m].name.replace(/^on/,
""));return this.inherited(k||arguments)}})})},"*noref":1}});
define("esri/dijit/Legend","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleLineSymbol ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),function(r,
q,p,d,h,k,m,a,f,J,E,y,C,v,c,w,H,g,u,F,B,T,G,L,I,z,Q,N,R,O,W,X,Y,U,Z,aa,ba,S,ca,da,V){var K=q([da,g],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,_preserveCacheOnDestroy:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new m([64,64,64]),defaultText:"Aa",sizeRampLightColor:new m([255,255,255]),sizeRampDarkColor:new m([128,128,128]),layerConnects:[],gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",
gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(b,e){p.mixin(this,V.widgets.legend);this._i18n=V.widgets.legend;b=b||{};b.map?e?(this.map=b.map,this.layerInfos=b.layerInfos,this._respectCurrentMapScale=!1===b.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===b.respectVisibility?!1:!0,this._preserveCacheOnDestroy=b.preserveCacheOnDestroy?!0:!1,this.arrangement=b.arrangement===K.ALIGN_RIGHT?K.ALIGN_RIGHT:K.ALIGN_LEFT,this.arrangement===K.ALIGN_RIGHT&&
(this.alignRight=!0),this.autoUpdate=!1===b.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=a(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var b=["ar","he"],e,a;for(e=0;e<b.length;e+=1)a=b[e],r.locale&&-1!==r.locale.indexOf(a)&&(-1!==r.locale.indexOf("-")?-1!==r.locale.indexOf(a+
"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>f("ie")&&(this._repaintItems=p.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();
this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||d.forEach(this.layers,function(b){delete b.legendResponse})},refresh:function(b){if(this.domNode){b?(this.layerInfos=b,this.layers=[],d.forEach(this.layerInfos,function(b){this._isSupportedLayerType(b.layer)&&(b.title&&(b.layer._titleForLegend=b.title),b.layer._hideDefaultSymbol=!1===b.defaultSymbol?!0:!1,b.hideLayers?(this.hideLayersInLegend[b.layer.id]=
b.hideLayers,this._addSubLayersToHide(b)):this.hideLayersInLegend[b.layer.id]=[],b.hoverLabel&&(b.layer._hoverLabel=b.hoverLabel),b.hoverLabels&&(b.layer._hoverLabels=b.hoverLabels),this.layers.push(b.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(b=this.domNode.children.length-1;0<=b;b--)c.destroy(this.domNode.children[b]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&
(this.layers=[],d.forEach(this.layerInfos,function(b){this._isSupportedLayerType(b.layer)&&(b.title&&(b.layer._titleForLegend=b.title),b.layer._hideDefaultSymbol=!1===b.defaultSymbol?!0:!1,b.hideLayers?(this.hideLayersInLegend[b.layer.id]=b.hideLayers,this._addSubLayersToHide(b)):this.hideLayersInLegend[b.layer.id]=[],b.hoverLabel&&(b.layer._hoverLabel=b.hoverLabel),b.hoverLabels&&(b.layer._hoverLabels=b.hoverLabels),this.layers.push(b.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=
!0;this.layers=[];var b=[],e=[];d.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);var c;this._isSupportedLayerType(a)&&(a.arcgisProps&&a.arcgisProps.title&&(a._titleForLegend=a.arcgisProps.title),this.layers.push(a));"esri.layers.KMLLayer"==a.declaredClass&&(c=a.getLayers(),d.forEach(c,function(a){b.push(a.id)},this));"esri.layers.GeoRSSLayer"==a.declaredClass&&(c=a.getFeatureLayers(),d.forEach(c,function(b){e.push(b.id)},this))},this);d.forEach(this.map.graphicsLayerIds,function(a){var c=
this.map.getLayer(a);-1==d.indexOf(b,a)&&-1==d.indexOf(e,a)&&this._isSupportedLayerType(c)&&c._params&&c._params.drawMode&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c))},this)}this._createLegend()},_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=h.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=h.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),
this._olrConnect=h.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=h.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),d.forEach(this.layers,function(b){var a={};a.ovcConnect=h.connect(b,"onVisibilityChange",this,"_refreshLayers");a.oocConnect=h.connect(b,"onOpacityChange",this,"_refreshLayers");a.oscConnect=h.connect(b,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===b.declaredClass&&b.supportsDynamicLayers&&(a.odcConnect=
h.connect(b,"_onDynamicLayersChange",p.hitch(this,"_updateDynamicLayers",b)));"esri.layers.ArcGISImageServiceLayer"===b.declaredClass&&(a.oirConnect=h.connect(b,"onRenderingChange",p.partial(this._updateImageServiceLayers,this,b)));"esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass&&(a.oivrConnect=h.connect(b,"onRendererChange",p.hitch(this,"_refreshLayers")));this.layerConnects[b.id]=a},this))},_deactivate:function(){this._ozeConnect&&h.disconnect(this._ozeConnect);this._olaConnect&&h.disconnect(this._olaConnect);
this._olroConnect&&h.disconnect(this._olroConnect);this._olrConnect&&h.disconnect(this._olrConnect);d.forEach(this.layers,function(b){b=this.layerConnects[b.id]||{};b.ovcConnect&&h.disconnect(b.ovcConnect);b.oocConnect&&h.disconnect(b.oocConnect);b.oscConnect&&h.disconnect(b.oscConnect);b.odcConnect&&h.disconnect(b.odcConnect);b.oirConnect&&h.disconnect(b.oirConnect);b.oivrConnect&&h.disconnect(b.oivrConnect)},this);this.layerConnects=[]},_updateDynamicLayers:function(b){delete b.legendResponse;this._refreshLayers()},
_updateImageServiceLayers:function(b,a){delete a.legendResponse;b._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];d.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);this._isSupportedLayerType(b)&&this.layers.push(b)},this);d.forEach(this.map.graphicsLayerIds,function(b){b=this.map.getLayer(b);this._isSupportedLayerType(b)&&b._params&&b._params.drawMode&&this.layers.push(b)},this);this.refresh()},_createLegend:function(){var b=!1,
a=!1;w.set(this.domNode,"position","relative");c.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var n=[];d.forEach(this.layers,function(e){if("esri.layers.KMLLayer"==e.declaredClass||"esri.layers.GeoRSSLayer"==e.declaredClass){var l;e.loaded?("esri.layers.KMLLayer"==e.declaredClass?l=e.getLayers():"esri.layers.GeoRSSLayer"==e.declaredClass&&(l=e.getFeatureLayers(),this.hideLayersInLegend[e.id]&&(l=d.filter(l,function(b){return-1==d.indexOf(this.hideLayersInLegend[e.id],
b.id)},this))),d.forEach(l,function(b){"esri.layers.FeatureLayer"==b.declaredClass&&e._titleForLegend&&(b._titleForLegend=e._titleForLegend+" - ","esriGeometryPoint"==b.geometryType?b._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==b.geometryType?b._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==b.geometryType&&(b._titleForLegend+=this.NLS_areas),n.push(b))},this)):h.connect(e,"onLoad",p.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===e.declaredClass)if(!e.loaded)h.connect(e,
"onLoad",p.hitch(this,function(){this.refresh(this.layerInfos)}));else{if((!this._respectVisibility||this._respectVisibility&&e.visible)&&0<e.layerInfos.length&&d.some(e.layerInfos,function(b){return b.legendURL})){var x=!1;d.forEach(e.layerInfos,function(a){if(a.legendURL&&-1<d.indexOf(e.visibleLayers,a.name)){x||(c.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(e._titleForLegend||e.name||e.id)+"\x3c/span\x3e"},this.domNode),x=!0);var n;a=a.legendURL;if(e.customParameters||
e.customLayerParameters){var l=p.clone(e.customParameters||{});p.mixin(l,e.customLayerParameters||{});for(n in l)a+=(-1===a.indexOf("?")?"?":"\x26")+n+"\x3d"+l[n]}c.create("div",{innerHTML:"\x3cimg src\x3d'"+a+"'/\x3e"},this.domNode);b=!0}},this)}}else"esri.layers.WFSLayer"!==e.declaredClass||e.renderer?n.push(e):(l=c.create("div",{id:this.id+"_"+e.id,"class":"esriLegendService"}),c.create("span",{innerHTML:this._getServiceTitle(e),"class":"esriLegendServiceLabel"},c.create("td",{align:this._align},
c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},l))))),c.place(l,this.id,"first"),tableNode=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},l),tableBody=c.create("tbody",{},tableNode),"esriGeometryComplex"===e.geometryType?(this._buildRow_Renderer(e,e._pointSymbol,null,this.NLS_points,null,tableBody),this._buildRow_Renderer(e,e._lineSymbol,null,this.NLS_lines,null,tableBody),this._buildRow_Renderer(e,e._polygonSymbol,null,this.NLS_areas,null,
tableBody)):"esriGeometryPoint"===e.geometryType?this._buildRow_Renderer(e,e._pointSymbol,null,"",null,tableBody):"esriGeometryPolyline"===e.geometryType?this._buildRow_Renderer(e,e._lineSymbol,null,"",null,tableBody):"esriGeometryPolygon"===e.geometryType&&this._buildRow_Renderer(e,e._polygonSymbol,null,"",null,tableBody),a=!0)},this);var x=[];d.forEach(n,function(b){if(!b.loaded)var a=h.connect(b,"onLoad",this,function(b){h.disconnect(a);a=null;this.refresh()});else if((!this._respectVisibility||
this._respectVisibility&&b.visible)&&(b.layerInfos||b.renderer||"esri.layers.ArcGISImageServiceLayer"==b.declaredClass)){var e=c.create("div",{id:this.id+"_"+b.id,style:{display:"none"},"class":"esriLegendService"});c.create("span",{innerHTML:this._getServiceTitle(b),"class":"esriLegendServiceLabel"},c.create("td",{align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},e)))));c.place(e,this.id,"first");b.legendResponse||b.renderer?this._createLegendForLayer(b):this.isHostedTileService(b)?
this._getLayerInfos(b).then(p.hitch(this,function(b){this._createLegendForLayer(b)}),p.hitch(this,function(b){x.push(this._legendRequest(b))})):x.push(this._legendRequest(b))}},this);0!==x.length||b||a?(new y(x)).addCallback(p.hitch(this,function(e){b||a?v.byId(this.id+"_msg").innerHTML="":v.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):(v.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForLayer:function(b){if(b.legendResponse||b.renderer||this.isHostedTileService(b)){var a=
!1;if(b.legendResponse||this.isHostedTileService(b)){var c=b.dynamicLayerInfos||b.layerInfos;c&&c.length?d.forEach(c,function(e,c){if(!this.hideLayersInLegend[b.id]||-1===d.indexOf(this.hideLayersInLegend[b.id],e.id)){var n=this._buildLegendItems(b,e,c);a=a||n}},this):"esri.layers.ArcGISImageServiceLayer"==b.declaredClass&&(a=this._buildLegendItems(b,{id:0,name:null,title:b.name,subLayerIds:null,parentLayerId:-1},0))}else b.renderer&&(c=b.url?b.url.substring(b.url.lastIndexOf("/")+1,b.url.length):
"fc_"+b.id,a=this._buildLegendItems(b,{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));a&&(w.set(v.byId(this.id+"_"+b.id),"display","block"),w.set(v.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(b){if(b.loaded)return 10.01<=b.version?this._legendRequestServer(b):this._legendRequestTools(b);h.connect(b,"onLoad",p.hitch(this,"_legendRequest"))},_legendRequestServer:function(b){var a=b.url,c=a.indexOf("?"),a=-1<c?a.substring(0,c)+"/legend"+a.substring(c):a+"/legend";(c=b._getToken())&&
(a+="?token\x3d"+c);var x=p.hitch(this,"_processLegendResponse"),l={f:"json"};b._params.dynamicLayers&&(l.dynamicLayers=C.stringify(this._createDynamicLayers(b)),"[{}]"===l.dynamicLayers&&(l.dynamicLayers="[]"));b._params.bandIds&&(l.bandIds=b._params.bandIds);b._params.renderingRule?l.renderingRule=b._params.renderingRule:b.rasterFunctionInfos&&0<b.rasterFunctionInfos.length&&d.forEach(b.rasterFunctionInfos,function(b){b&&b.name&&"none"===b.name.toLowerCase()&&(l.renderingRule=C.stringify({rasterFunction:b.name}))});
return L({url:a,content:l,callbackParamName:"callback",load:function(a,e){x(b,a,e)},error:G.defaults.io.errorHandler})},_legendRequestTools:function(b){var a=b.url.toLowerCase().indexOf("/rest/"),a=b.url.substring(0,a)+b.url.substring(a+5,b.url.length),a=this._legendUrl+"?soapUrl\x3d"+window.escape(a);if(!f("ie")||8<f("ie"))a+="\x26returnbytes\x3dtrue";var c=p.hitch(this,"_processLegendResponse");return L({url:a,content:{f:"json"},callbackParamName:"callback",load:function(a,e){c(b,a,e)},error:G.defaults.io.errorHandler})},
_processLegendResponse:function(b,a){a&&a.layers?(b.legendResponse=a,v.byId(this.id+"_"+b.id)&&c.empty(v.byId(this.id+"_"+b.id)),c.create("span",{innerHTML:this._getServiceTitle(b),"class":"esriLegendServiceLabel"},c.create("td",{align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},v.byId(this.id+"_"+b.id)))))),this._createLegendForLayer(b)):console.log("Legend could not get generated for "+b.url+": "+k.toJson(a))},_buildLegendItems:function(b,a,n){var e=!1,l=v.byId(this.id+
"_"+b.id),A=a.parentLayerId;if(a.subLayerIds)b=c.create("div",{id:this.id+"_"+b.id+"_"+a.id+"_group",style:{display:"none"},"class":-1==A?0<n?"esriLegendGroupLayer":"":this._legendAlign},-1==A?l:v.byId(this.id+"_"+b.id+"_"+A+"_group")),c.create("td",{innerHTML:B.encode(a.name),align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%","class":"esriLegendLayerLabel"},b))));else{if(this._respectVisibility&&b.visibleLayers)if(n=b.dynamicLayerInfos||b.layerInfos)if(b._params&&
b._params.layers){if(-1===d.indexOf(b.visibleLayers,a.id))return e}else{if(n=this._getReallyVisibleLayers(n,b.visibleLayers),-1===d.indexOf(n,a.id))return e}else if(-1===d.indexOf(b.visibleLayers,a.id))return e;l=c.create("div",{id:this.id+"_"+b.id+"_"+a.id,style:{display:"none"},"class":-1<A?this._legendAlign:""},-1==A?l:v.byId(this.id+"_"+b.id+"_"+A+"_group"));c.create("td",{innerHTML:B.encode(a.name)||"",align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%","class":"esriLegendLayerLabel"},
l))));n=b.dynamicLayerInfos||b.layerInfos;A=!1;n&&n.length&&(A=d.some(n,function(b){return!!b.drawingInfo}));if(b.legendResponse)e=e||this._buildLegendItems_Tools(b,a,l);else if(b.renderer||A)e=e||this._buildLegendItems_Renderer(b,a,l)}return e},_getReallyVisibleLayers:function(b,a){if(!b||!a||!a.length)return[];var e=[],c=[],l;for(l=0;l<b.length;l++)if(b[l].subLayerIds){if(-1===d.indexOf(a,b[l].id)||-1<d.indexOf(c,b[l].id))c=c.concat(b[l].subLayerIds)}else-1<d.indexOf(a,b[l].id)&&-1===d.indexOf(c,
b[l].id)&&e.push(b[l].id);return e},_buildLegendItems_Tools:function(b,a,n){var e=a.parentLayerId,l=this.map.getScale(),A=!1,f=function(b,a){var e,c;for(e=0;e<b.length;e++)if(a.dynamicLayerInfos)for(c=0;c<a.dynamicLayerInfos[c].length;c++){if(a.dynamicLayerInfos[c].mapLayerId==b[e].layerId)return b[e]}else if(a.id==b[e].layerId)return b[e];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(b,a,l)){var h=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===
b.declaredClass||"esri.layers.ArcGISMapServiceLayer"===b.declaredClass)){var g=this._getEffectiveScale(b,a);if(g.minScale&&g.minScale<l||g.maxScale&&g.maxScale>l)h=!1}if(h){var l=f(b.legendResponse.layers,a),p=l.legendType,t=l.layerType,k=l.legend;if(k){"esri.layers.ArcGISImageServiceLayer"!==b.declaredClass&&this._sanitizeLegendResponse(b,l,a);n=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},n);var m=c.create("tbody",{},n);(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(n,
b,a);d.forEach(k,function(e){if(!(10.1<=b.version&&!e.values&&1<k.length)||!b._hideDefaultSymbol&&"\x3call other values\x3e"!==e.label&&(e.label||"esri.layers.ArcGISImageServiceLayer"===b.declaredClass&&10.3<=b.version||"Raster Layer"===t))if(e.url&&0===e.url.indexOf("http")||e.imageData&&0<e.imageData.length)A=!0,this._buildRow_Tools(e,m,b,a.id,p)},this)}}}A&&(w.set(v.byId(this.id+"_"+b.id+"_"+a.id),"display","block"),-1<e&&(w.set(v.byId(this.id+"_"+b.id+"_"+e+"_group"),"display","block"),this._findParentGroup(b.id,
b,e)));return A},_getLayerInfos:function(b){var a=new E,c=b.dynamicLayerInfos||b.layerInfos;if(c&&c.length)if(d.some(c,function(b){return!!b.drawingInfo}))a.resolve(b);else{var x=b.url,l=x.indexOf("?"),x=-1==l?x+"/layers":x.substring(0,l)+"/layers"+x.substring(l,x.length);L({url:x,content:{f:"json"},callbackParamName:"callback",load:function(e,n){e.layers?(d.forEach(c,function(b){var a=d.filter(e.layers,function(a){return b.source?a.id===b.source.mapLayerId:a.id===b.id});a&&a[0]&&a[0].drawingInfo&&
(b.drawingInfo=a[0].drawingInfo,b.fields=a[0].fields)}),a.resolve(b)):a.reject(b)},error:function(e){a.reject(b)}})}return a},_sanitizeLegendResponse:function(b,a,c){var e=a.legend;if(10.1<=b.version&&1<e.length&&!a._sanitized){b=p.getObject("layerDefinition.drawingInfo.renderer",!1,c);var n,A;b||(b=p.getObject("drawingInfo.renderer",!1,c));d.some(e,function(b){if(b.values)return!0})&&d.some(e,function(b,a){b.values||(A=a,n=b);return!!n});b?"uniqueValue"===b.type?n&&(e.splice(A,1),e.push(n)):"classBreaks"===
b.type&&(n&&e.splice(A,1),e.reverse(),n&&e.push(n)):n&&(e.splice(A,1),e.push(n));a._sanitized=!0}},_buildRow_Tools:function(b,a,n,d,l){var e=c.create("tr",{},a),x;this.alignRight?(a=c.create("td",{align:this._isRightToLeft?"left":"right"},e),x=c.create("td",{align:this._isRightToLeft?"left":"right",width:35},e)):(x=c.create("td",{width:35,align:"center"},e),a=c.create("td",{},e));e=b.url;(!f("ie")||9<=f("ie")||9>f("ie")&&"esri.layers.ArcGISImageServiceLayer"===n.declaredClass)&&b.imageData&&0<b.imageData.length?
e="data:image/png;base64,"+b.imageData:0!==b.url.indexOf("http")&&(e=n.url+"/"+d+"/images/"+b.url,(d=n._getToken())&&(e+="?token\x3d"+d));d=c.create("img",{src:e,border:0,style:"opacity:"+n.opacity},x);b=c.create("td",{innerHTML:B.encode(b.label),align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%",dir:"ltr"},a))));l&&"Stretched"===l&&10.3<=n.version&&"esri.layers.ArcGISImageServiceLayer"===n.declaredClass&&(b.style.verticalAlign="top",b.style.lineHeight="1",d.style.marginBottom=
"-1px",d.style.display="block",a.style.verticalAlign="top");9>f("ie")&&(d.style.filter="alpha(opacity\x3d"+100*n.opacity+")")},_getVariable:function(b,a,c){var e;b&&(e=(b=b.getVisualVariablesForType(a,c))&&b[0]);return e},_getVariables:function(b,a,c){b=[this._getVariable(b,"colorInfo",!1),this._getVariable(b,"opacityInfo",!1),this._getVariable(b,"sizeInfo",!1)];return a?d.filter(b,function(b){return!(!b||b.field!==a||b.normalizationField!=c)}):b},_getFieldAlias:function(b,a,c){var e=a.infoTemplate,
e=e&&e.getFieldInfo&&e.getFieldInfo(b);b=p.isFunction(b)?null:this.getField(a,b,c);a=e||b;c="";a&&(c=e&&e.label||b&&b.alias||a.name||a.fieldName);return c},_getRampTitle:function(b,a,c){var e,d=b.field,n=b.normalizationField,f=!1,h=!1,g=!1,d=p.isFunction(d)?null:d,n=p.isFunction(n)?null:n;if(b.legendOptions&&b.legendOptions.title)e=b.legendOptions.title;else if(b.valueExpressionTitle)e=b.valueExpressionTitle;else{if(a.renderer&&a.renderer.authoringInfo&&a.renderer.authoringInfo.visualVariables){var k=
a.renderer.authoringInfo.visualVariables;for(b=0;b<k.length;b++){var t=k[b];if("colorInfo"===t.type&&"ratio"===t.style){f=!0;break}else if("colorInfo"===t.type&&"percent"===t.style){h=!0;break}else if("colorInfo"===t.type&&"percentTotal"===t.style){g=!0;break}}}(f=g&&"showRatioPercentTotal"||h&&"showRatioPercent"||f&&"showRatio"||n&&"showNormField"||d&&"showField"||null)&&(e=I.substitute({field:d&&this._getFieldAlias(d,a,c),normField:n&&this._getFieldAlias(n,a,c)},this._i18n[f]))}return e},_getRendererTitle:function(b,
a,c){var e;if(b){var d,n,f;b instanceof O&&(d=b.attributeField,n=b.normalizationField,f="percent-of-total"===b.normalizationType);d=p.isFunction(d)?null:d;n=p.isFunction(n)?null:n;b.legendOptions&&b.legendOptions.title?e=b.legendOptions.title:b.valueExpressionTitle?e=b.valueExpressionTitle:(b=n&&"showNormField"||(f?"showNormPct":null)||d&&"showField"||null)&&(e=I.substitute({field:d&&this._getFieldAlias(d,a,c),normField:n&&this._getFieldAlias(n,a,c)},this._i18n[b]))}return e},_buildLegendItems_Renderer:function(b,
a,n){var e=a.parentLayerId,l=this.map,f=l.getScale(),h,g=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(b,a,f)){var k,m,t,r,q,u,P,y;t="esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass?b.renderer.renderer:a&&a.drawingInfo?ca.fromJson(p.clone(a.drawingInfo.renderer)):b.renderer;if(t instanceof W&&(t=(t="zoom"===t.rangeType?t.getRendererInfoByZoom(l.getZoom()):t.getRendererInfoByScale(f))&&t.renderer,!t))return!1;var D=this._getVariables(t),z=d.filter(D,function(b){return!!b}).length,
f=D[0],l=D[1],D=D[2],C,E,M,F,G;f&&(r=this._getMedianColor(t,f),f.field&&(u=p.isFunction(f.field)?null:this.getField(b,f.field,a)),C=!(f.legendOptions&&!1===f.legendOptions.showLegend));l&&(l.field&&(y=p.isFunction(l.field)?null:this.getField(b,l.field,a)),E=!(l.legendOptions&&!1===l.legendOptions.showLegend));D&&(D.field&&(P=p.isFunction(D.field)?null:this.getField(b,D.field,a)),M=!(D.legendOptions&&!1===D.legendOptions.showLegend));if(t instanceof Z)h=g=!0,this._showHeatRamp(b,a,t,n);else if(t instanceof
X)h=g=!0,this._showDotDensityLegend(b,a,t,n);else if(t instanceof Y)h=g=!0,m=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},n),k=c.create("tbody",{},m),(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(m,b,a),t.latestObservationRenderer&&t.latestObservationRenderer instanceof N&&this._buildRow_Renderer(b,t.latestObservationRenderer.symbol,r,B.encode(t.latestObservationRenderer.label)||this.NLS_currentObservations,null,k),t.observationRenderer&&t.observationRenderer instanceof
N&&this._buildRow_Renderer(b,t.observationRenderer.symbol,r,B.encode(t.observationRenderer.label)||this.NLS_previousObservations,null,k);else if(t instanceof R){if(t.infos&&0<t.infos.length){h=g=!0;if(t.legendOptions&&t.legendOptions.title||t.valueExpressionTitle)m=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},n),k=c.create("tbody",{},m),z=t.legendOptions&&t.legendOptions.title?t.legendOptions.title:t.valueExpressionTitle,this._buildRow_Renderer(b,null,r,B.encode(z),
null,k);m=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},n);k=c.create("tbody",{},m);(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(m,b,a);t.attributeField&&D&&this._addSubHeader(k,this._getFieldAlias(t.attributeField,b,a));var H=[];d.forEach(t.infos,function(a){var e=null;b._editable&&b.types&&(e=this._getTemplateFromTypes(b.types,a.value));var c=a.label;null==c&&(c=a.value);-1===d.indexOf(H,c)&&(H.push(c),this._buildRow_Renderer(b,a.symbol,r,B.encode(c),
e,k))},this)}G=this._displayDefaultSymbol(b,t,n)}else if(t instanceof O){if(t.infos&&0<t.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass)h=g=!0,F=this._isUnclassedRenderer(t),f||1!==t.infos.length||(q=(q=t.infos[0])&&q.symbol),F||(m=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},n),k=c.create("tbody",{},m),z=this._getRendererTitle(t,b,a),this._buildRow_Renderer(b,null,r,B.encode(z),null,k)),m=c.create("table",{cellpadding:0,cellspacing:0,
width:"95%","class":"esriLegendLayer"},n),k=c.create("tbody",{},m),(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(m,b,a),F&&D&&M||(z=t.infos.slice(0).reverse(),d.forEach(z,function(a){var e=a.label;null!=e||F||(e=a.minValue+" - "+a.maxValue);this._buildRow_Renderer(b,a.symbol,r,B.encode(e),null,k)},this)),"esri.layers.ArcGISImageServiceVectorLayer"!==b.declaredClass||b.renderer.style!==U.STYLE_SCALAR&&b.renderer.style!==U.STYLE_SINGLE_ARROW||(this._buildRow_Renderer(b,t.defaultSymbol,null,
"",null,k),b._hideDefaultSymbol=!0);F||(G=this._displayDefaultSymbol(b,t,n))}else t instanceof N&&(h=g=!0,m=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},n),k=c.create("tbody",{},m),(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(m,b,a),q=null,b._editable&&b.templates&&0<b.templates.length&&(q=b.templates[0]),m=1<z?null:u&&C||y&&E||P&&M,this._buildRow_Renderer(b,t.symbol,r,B.encode(m?this._getRampTitle(1<z?null:f||l||D,b,a):t.label),q,k),q=f?null:t.symbol,
m&&(u=y=P=null));h&&(f&&C&&(f.field||f.valueExpression)&&this._showGradientRamp(b,a,t,null,n,f,u,null,D&&M?!0:!1),D&&M&&(D.field||D.valueExpression)&&(h=f&&C||t instanceof R?!1:!0,this._showSizeLegend(b,a,t,D,r,n,P,null,h)),l&&E&&(l.field||l.valueExpression)&&this._showGradientRamp(b,a,t,q&&!q.url&&q.color?q.color:this.transparencyRampColor,n,l,y,null,!1));G||F&&!C&&!M&&!E||(G=this._displayDefaultSymbol(b,t,n));g=g||G}g&&(w.set(v.byId(this.id+"_"+b.id+"_"+a.id),"display","block"),-1<e&&(w.set(v.byId(this.id+
"_"+b.id+"_"+e+"_group"),"display","block"),this._findParentGroup(b.id,e)));return g},_isUnclassedRenderer:function(b,a){var e;if(b instanceof O&&b.infos&&1===b.infos.length){e=b.attributeField;var c=b.normalizationField;e=a?e===a:!!this._getVariables(b,e,c).length}return e},_displayDefaultSymbol:function(b,a,d){var e;!b._hideDefaultSymbol&&a.defaultSymbol&&(e=!0,d=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),d=c.create("tbody",{},d),this._buildRow_Renderer(b,
a.defaultSymbol,null,B.encode(a.defaultLabel)||"others",null,d));return e},_showGradientRamp:function(b,a,d,f,l,h,g,k,m){m=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(m?"":" esriLegendSubFragment")},l);l=c.create("tbody",{},m);(b._hoverLabel||b._hoverLabels||k)&&this._createHoverAction(m,b,a,k);(g||h.valueExpression)&&this._addSubHeader(l,this._getRampTitle(h,b,a));g=h.field;var e;g&&(e=p.isFunction(g)?null:this.getField(b,g,a));(a=this._getRampStops(d,h,f,
e&&"esriFieldTypeDate"===e.type))&&a.length&&this._drawGradientRamp(l,a,!0,b,this._getRampBorderColor(d),!!f)},_getMedianColor:function(b,a){var c,e;a.colors?(c=a.minDataValue,e=a.maxDataValue):a.stops&&(c=a.stops[0].value,e=a.stops[a.stops.length-1].value);return b.getColor(c+(e-c)/2,{colorInfo:a})},_getRampStops:function(b,a,c,f){var e,n,h,g,x=!1;a.colors||a.opacityValues?(n=a.maxDataValue-a.minDataValue,e=d.map([0,.25,.5,.75,1],function(b){h=a.minDataValue+b*n;return Number(h.toFixed(6))}),this._checkPrecision(0,
4,e)):a.stops&&(e=d.map(a.stops,function(b){return b.value}),(x=d.some(a.stops,function(b){return!!b.label}))&&(g=d.map(a.stops,function(b){return b.label})));var k=e[0],t,p;n=e[e.length-1]-k;return d.map(e,function(d,l){c?(t=new m(c.toRgba()),p=b.getOpacity(d,{opacityInfo:a}),null!=p&&(t.a=p)):t=b.getColor(d,{colorInfo:a});var h="";if(x)h=g[l];else{var h=f?Q.formatDate(d,Q.timelineDateFormatOptions):z.format(d),A="";0===l?A=this._specialChars.lt+" ":l===e.length-1&&(A=this._specialChars.gt+" ");
h=A+h}return{value:d,color:t,offset:1-(d-k)/n,label:h}},this).reverse()},_checkPrecision:function(b,a,c){var e=b+(a-b)/2,d=c[b],n=c[e],f=c[a],h=Math.floor(d),g=Math.floor(n),k=Math.floor(f);h===d&&k===f&&g!==n&&h!==g&&k!==g&&(c[e]=g);b+1!==e&&this._checkPrecision(b,e,c);e+1!==a&&this._checkPrecision(e,a,c)},_getRampBorderColor:function(b){var a;if(b instanceof N)a=b.symbol;else if(b instanceof R||b instanceof O)a=b.infos[0].symbol;return(b=a&&-1===a.type.indexOf("linesymbol")?a.getStroke():null)&&
b.color},_drawGradientRamp:function(b,a,n,h,l,g){var e=c.create("tr",{},b),x,k,p,t,A,r=a.length-1,q;t=0;this.alignRight?(b=c.create("td",{align:this._isRightToLeft?"left":"right"},e),x=c.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},e)):(x=c.create("td",{width:this.gradientWidth,align:"center"},e),b=c.create("td",{},e));e=l&&0<l.a&&!(240<=l.r&&240<=l.g&&240<=l.b);k=c.create("div",{"class":e?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+
"px;"},x);x=c.create("div",{"class":"esriLegendColorRamp"+(g?" esriLegendTransparencyRamp":"")},k);g=w.get(x,"width");e&&(l=9>f("ie")?l.toHex():"rgba("+l.toRgba().join(",")+")",w.set(x,"border",this.colorRampBorder+" "+l));n?(l=this.gradientHeight*r,w.set(x,"height",l+"px")):l=w.get(x,"height");w.set(k,"height",l+"px");e=u.createSurface(x,g,l);9>f("ie")&&(t=e.getEventSource(),w.set(t,"position","relative"),w.set(t.parentNode,"position","relative"),t=1);try{n&&d.forEach(a,function(b,a){b.offset=a/
r}),A=e.createRect({x:-t,y:-t,width:g+t,height:l+t}),A.setFill({type:"linear",x1:0,y1:0,x2:0,y2:l,colors:a}).setStroke(null),e.createRect({width:g,height:l}).setFill(new m([255,255,255,1-h.opacity])).setStroke(null),this._surfaceItems.push(e)}catch(P){e.clear(),e.destroy()}d.forEach(a,function(b,e){if(b.label){q="top:"+100*b.offset+"%;";var d="";0===e&&(d+=" esriLegendColorRampTickFirst");e===a.length-1&&(d+=" esriLegendColorRampTickLast");c.create("div",{"class":"esriLegendColorRampTick"+d,innerHTML:"\x26nbsp;",
style:q},k)}});p=c.create("div",{"class":"esriLegendColorRampLabels",style:{height:l+this.gradientHeight+"px"}},b);n?d.forEach(a,function(b){c.create("div",{"class":"esriLegendColorRampLabel",innerHTML:B.encode(b.label)||"\x26nbsp;"},p)}):(c.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},p),c.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(l+this.gradientHeight-2*this.gradientHeight)+"px;"},p))},_showHeatRamp:function(b,a,d,f,l){var e,
n=d.field;e=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},f);f=c.create("tbody",{},e);(b._hoverLabel||b._hoverLabels||l)&&this._createHoverAction(e,b,a,l);(n=n&&this.getField(b,n,a))&&this._addSubHeader(f,this._getFieldAlias(n.name,b,a));a=this._getHeatmapStops(d);a.length&&this._drawGradientRamp(f,a,!1,b)},_getHeatmapStops:function(b){var a=b.colorStops;b=b.colors;var c,f,l,h;a&&a[0]?(c=a.length-1,(b=a[0]&&null!=a[0].ratio)?(b=a[c])&&1!==b.ratio&&(a=a.slice(0),
a.push({ratio:1,color:b.color}),c++):(f=a[0].value,l=a[c].value-f,a=d.map(a,function(b){return{color:b.color,ratio:(b.value-f)/l}}))):b&&b[0]&&(c=b.length-1,h=1/(b.length-1),a=d.map(b,function(b,a){return{color:b,ratio:a*h}}));a=d.map(a,function(b,a){var e="";0===a?e="Low":a===c&&(e="High");return{color:b.color,label:e,offset:1-b.ratio}});return a.reverse()},_showDotDensityLegend:function(b,a,n,f){var e=n.legendOptions,h,g,x,k,m,t,r,q=this.dotDensitySwatchSize,u=Math.round(q/2);e&&(g=e.backgroundColor,
x=e.outline,k=e.valueUnit,m=e.dotCoverage);m=(m||this.dotCoverage)/100;r=Math.round(q*q/Math.pow(n.dotSize,2)*m);f=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},f);t=c.create("tbody",{},f);(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(f,b,a);this._addSubHeader(t,I.substitute({value:n.dotValue,unit:k||""},this.NLS_dotValue));d.forEach(n.fields,function(c){c=p.mixin({},c);c.numPoints=r;h=new aa(n._generateImageSrc(q,q,[c],{x:0,y:0},{x:q,y:q},g),x||n.outline,
q,q);c=this.getField(b,c.name,a)||c;this._buildRow_Renderer(b,h,null,B.encode(this._getFieldAlias(c.name,b,a)),null,t,{type:"path",path:"M "+-u+","+-u+" L "+u+","+-u+" L "+u+","+u+" L "+-u+","+u+" L "+-u+","+-u+" E"})},this)},_showSizeLegend:function(b,a,d,f,l,h,g,k,m){var e=f.legendOptions,e=e&&e.customValues;l=this._getSizeSymbol(d,l);if((!f.valueUnit||"unknown"===f.valueUnit)&&l&&(e||null!=f.minSize&&null!=f.maxSize&&null!=f.minDataValue&&null!=f.maxDataValue||f.stops&&!(1>=f.stops.length))){m=
c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(m?"":" esriLegendSubFragment")},h);h=c.create("tbody",{},m);(b._hoverLabel||b._hoverLabels||k)&&this._createHoverAction(m,b,a,k);(g||f.valueExpression)&&this._addSubHeader(h,this._getRampTitle(f,b,a));g=f.field;var n;g&&(n=p.isFunction(g)?null:this.getField(b,g,a));a=n&&"esriFieldTypeDate"===n.type;e=e||this._getDataValues(d,l,f,a);for(n=m=e.length-1;0<=n;n--)g=e[n],l=S.fromJson(l.toJson()),this._applySize(l,d,f,
g),g=a?Q.formatDate(g,Q.timelineDateFormatOptions):z.format(g),k="",n===m?k=this._specialChars.gt+" ":0===n&&(k=this._specialChars.lt+" "),k="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+B.encode(k+g)+"\x3c/span\x3e",this._buildRow_Renderer(b,l,null,k,null,h)}},_getSizeSymbol:function(b,a){var c,e;if(b instanceof N)c=b.symbol;else if(b instanceof U)c=b.defaultSymbol;else if(b instanceof R||b instanceof O)c=b.infos[0].symbol,e=1<b.infos.length;if(c=c&&-1!==c.type.indexOf("fillsymbol")?null:c)if(c=
S.fromJson(c.toJson()),a||e)-1!==c.type.indexOf("linesymbol")?c.setColor(new m(this.sizeRampDarkColor)):(c.setColor(new m(this.sizeRampLightColor)),c.setOutline&&(e=new ba,e.setColor(new m(this.sizeRampDarkColor)),e.setWidth(1.5),c.setOutline(e)));return c},_getDataValues:function(b,a,c,f,l,g){l=null==l?5:l;g=null==g?20:g;var e=b.getSizeRangeAtScale(c,this.map.getScale());l=this._interpolateSizeRange(e,l);var n=this._getDataRange(c),h=d.map(l,function(b){return this._getDataValueFromSize(b,n,e)},
this);if(!f){var k,h=z.round(h);for(f=1;f<h.length-1;f++)if(k=this._roundDataValue(b,a,c,h[f],h[f-1],g))h[f]=k[0],l[f]=k[1]}return h},_getDataRange:function(b){var a=b.stops;return a?{min:a[0].value,max:a[a.length-1].value}:{min:b.minDataValue,max:b.maxDataValue}},_interpolateSizeRange:function(b,a){var c=b.minSize,e=(b.maxSize-c)/(a-1),d,f=[];for(d=0;d<a;d++)f.push(c+e*d);return f},_getDataValueFromSize:function(b,a,c){var e=c.minSize;c=c.maxSize;var d=a.min;a=a.max;return b<=e?d:b>=c?a:(b-e)/(c-
e)*(a-d)+d},_roundDataValue:function(b,a,c,d,f,h){var e=this._getSize(a,b,c,d);f=this._getSize(a,b,c,f);var n,g=z.getDigits(d),l=g.integer,g=g.fractional,k,m,p,x,q,r,A,u,v,w,y;0<d&&1>d&&(n=Math.pow(10,g),d*=n,l=z.getDigits(d).integer);for(--l;0<=l&&(k=Math.pow(10,l),g=Math.floor(d/k)*k,k*=Math.ceil(d/k),null!=n&&(g/=n,k/=n),m=(g+k)/2,m=z.round([g,m,k],{indexes:[1]})[1],p=this._getSize(a,b,c,g),x=this._getSize(a,b,c,k),q=this._getSize(a,b,c,m),r=z.getPctChange(e,p,f,null),A=z.getPctChange(e,x,f,null),
u=z.getPctChange(e,q,f,null),v=r.prev<=h,w=A.prev<=h,v&&w&&(r.prev<=A.prev?(v=!0,w=!1):(w=!0,v=!1)),v?y=[g,p]:w?y=[k,x]:u.prev<=h&&(y=[m,q]),!y);l--);return y},_applySize:function(b,a,c,d){var e=b.type;a=this._getSize(b,a,c,d);switch(e){case "simplemarkersymbol":b.setSize(a);break;case "picturemarkersymbol":e=b.width;c=b.height;b.setHeight(a);b.setWidth(e/c*a);break;case "simplelinesymbol":case "cartographiclinesymbol":b.setWidth(a);break;case "textsymbol":b.font&&b.font.setSize(a)}},_getSize:function(b,
a,c,d){return a.getSize(d,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==b.type.indexOf("markersymbol")?b.style:null})},_buildRow_Renderer:function(b,a,d,f,g,h,k){var e=c.create("tr",{},h),n;this.alignRight?(h=c.create("td",{align:this._isRightToLeft?"left":"right"},e),a&&(n=c.create("td",{align:this._isRightToLeft?"left":"right",width:35},e))):(a&&(n=c.create("td",{width:35,align:"center"},e)),h=c.create("td",{},e));var l=e=30,m;if(a){if("simplemarkersymbol"==a.type)e=Math.min(Math.max(e,a.size+
12),125),l=Math.min(Math.max(l,a.size+12),125);else if("picturemarkersymbol"==a.type)e=Math.min(Math.max(e,a.width),125),l=Math.min(a.height||l,125);else if("textsymbol"==a.type){var p,q;a.text||(p=a.text,q=!0,a.setText(this.defaultText));e=Math.min(Math.max(e,a.getWidth()+12),125);l=Math.min(Math.max(l,a.getHeight()+12),125);q&&a.setText(p)}m=c.create("div",{style:"width:"+e+"px;height:"+l+"px;"},n)}I.isDefined(f)&&"number"===typeof f&&(f=""+f);c.create("td",{innerHTML:f||"",align:this._align},c.create("tr",
{},c.create("tbody",{},c.create("table",{width:"95%"},h))));a&&(b=this._drawSymbol(m,a,d,e,l,g,b,k),this._surfaceItems.push(b))},_addSubHeader:function(a,e){var b=c.create("tr",{},a),b=c.create("td",{align:this._align,colspan:2},b);c.create("td",{innerHTML:B.encode(e)||"",align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},b))))},_drawSymbol:function(a,c,d,g,h,k,q,r){c=S.fromJson(c.toJson());var b=q.opacity;d&&c.setColor(new m(d.toRgba()));if("simplelinesymbol"===
c.type||"cartographiclinesymbol"===c.type||"textsymbol"===c.type){if(!c.color)return;d=c.color.toRgba();d[3]*=b;c.color.setColor(d)}else"simplemarkersymbol"===c.type||"simplefillsymbol"===c.type?(c.color&&(d=c.color.toRgba(),d[3]*=b,c.color.setColor(d)),c.outline&&c.outline.color&&(d=c.outline.color.toRgba(),d[3]*=b,c.outline.color.setColor(d))):"picturemarkersymbol"===c.type&&(a.style.opacity=b,a.style.filter="alpha(opacity\x3d("+100*b+"))");a=u.createSurface(a,g,h);9>f("ie")&&(d=a.getEventSource(),
w.set(d,"position","relative"),w.set(d.parentNode,"position","relative"));k=this._getDrawingToolShape(c,k)||S.getShapeDescriptors(c);var e,b=(d=k.defaultShape)&&"text"===d.type;try{b&&!d.text&&(d.text=this.defaultText),e=a.createShape(r||d).setFill(k.fill).setStroke(k.stroke),b&&e.setFont(k.font)}catch(ea){a.clear();a.destroy();return}var l=e.getBoundingBox();r=l.width;k=l.height;var b=-(l.x+r/2),n=-(l.y+k/2);d=a.getDimensions();b={dx:b+d.width/2,dy:n+d.height/2};if("simplemarkersymbol"===c.type&&
"path"===c.style)g=q._getScaleMatrix(l,c.size),e.applyTransform(F.scaleAt(g.xx,g.yy,{x:d.width/2,y:d.height/2}));else if(r>g||k>h)q=r/g>k/h,g=((q?g:h)-5)/(q?r:k),p.mixin(b,{xx:g,yy:g});e.applyTransform(b);return a},_getDrawingToolShape:function(a,c){var b;switch(c?c.drawingTool||null:null){case "esriFeatureEditToolArrow":b={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":b={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};
break;case "esriFeatureEditToolRectangle":b={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};break;case "esriFeatureEditToolCircle":b={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":b={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:b,fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){d.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());
try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(e){}a.children&&p.isArray(a.children)&&d.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,d,f,g){if(g=d._hoverLabel||d._hoverLabels&&d._hoverLabels[f.id]||g)g=B.encode(g),d.mouseMoveHandler=d.mouseMoveHandler||{},d.mouseMoveHandler[f.id]=h.connect(a,"onmousemove",p.hitch(this,function(a,b){this.mouseX=b.clientX;this.mouseY=b.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,w.set(v.byId(this.id+"_hoverLabel"),"display",
"none"));setTimeout(p.hitch(this,function(a,b,d){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,v.byId(this.id+"_hoverLabel")){var e=v.byId(this.id+"_hoverLabel");e.innerHTML="\x3cspan\x3e"+d+"\x3c/span\x3e";w.set(e,"top",b+"px");w.set(e,"left",a+15+"px");w.set(e,"display","")}else c.create("div",{innerHTML:"\x3cspan\x3e"+d+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,
a),500)},g)),d.mouseOutHandler=d.mouseOutHandler||{},d.mouseOutHandler[f.id]=h.connect(a,"onmouseout",p.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,w.set(v.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;d.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)h.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)h.disconnect(b.mouseOutHandler[a])})},
_createDynamicLayers:function(a){var b=[],c;d.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJson();var e;a.layerDefinitions&&a.layerDefinitions[d.id]&&(e=a.layerDefinitions[d.id]);e&&(c.definitionExpression=e);var f;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&(f=a.layerDrawingOptions[d.id]);f&&(c.drawingInfo=f.toJson());c.minScale=d.minScale||0;c.maxScale=d.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,c){var b;for(b=0;b<
a.length;b++)if(a[b].id==c&&a[b].templates&&0<a[b].templates.length)return a[b].templates[0];return null},_findParentGroup:function(a,c,d){var b,e=c.dynamicLayerInfos||c.layerInfos;for(b=0;b<e.length;b++)if(d==e[b].id){-1<e[b].parentLayerId&&(w.set(v.byId(this.id+"_"+a+"_"+e[b].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,c,e[b].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,e){var f=a.layer.dynamicLayerInfos||a.layer.layerInfos,g,h;for(g=0;g<f.length;g++)if(f[g].id===
c&&f[g].subLayerIds)for(h=0;h<f[g].subLayerIds.length;h++){var k=f[g].subLayerIds[h];-1===d.indexOf(e,k)&&(e.push(k),b(k,e))}}a.layer.layerInfos&&d.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,c,d){var b,e=!0;if(a.legendResponse&&a.legendResponse.layers)for(b=0;b<a.legendResponse.layers.length;b++){var f=a.legendResponse.layers[b];if(c.id==f.layerId){var g,h;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?
(0==f.minScale&&a.tileInfo&&(g=a.tileInfo.lods[0].scale),0==f.maxScale&&a.tileInfo&&(h=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(g=Math.min(a.minScale,f.minScale)||a.minScale||f.minScale,h=Math.max(a.maxScale,f.maxScale));if(0<g&&g<d||h>d)e=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<d||a.maxScale&&a.maxScale>d)e=!1;return e},_getServiceTitle:function(a){var b=a._titleForLegend;b||(b=a.url,a.url?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),
b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+
a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],I.isDefined(a)&&(b+=" ("+a+")"));return B.encode(b)},_getEffectiveScale:function(a,c){var b=c.minScale,d=c.maxScale;if(I.isDefined(c.parentLayerId)){var e=a.layerInfos,f=c.parentLayerId,g;for(g=e.length-1;0<=g;g--)if(e[g].id==f)if(0==b&&0<e[g].minScale?b=e[g].minScale:0<b&&0==e[g].minScale||0<b&&0<e[g].minScale&&(b=Math.min(b,e[g].minScale)),d=Math.max(d||0,e[g].maxScale||0),-1<e[g].parentLayerId)f=e[g].parentLayerId;
else break}return{minScale:b,maxScale:d}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===
a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1},isHostedTileService:function(a){var b=/(https?:)?\/\/services.*\.arcgis\.com/i;return"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass&&b.test(a.url)?!0:!1},getField:function(a,c,f){if(a.getField)return a.getField(c);if(f&&f.fields){var b;d.forEach(f.fields,function(a){a.name===c&&(b=a)});return b}return null}});p.mixin(K,{ALIGN_LEFT:0,ALIGN_RIGHT:1});
f("extend-esri")&&p.setObject("dijit.Legend",K,T);return K});