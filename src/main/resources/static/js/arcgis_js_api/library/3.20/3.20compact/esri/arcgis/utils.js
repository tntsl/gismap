// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.20/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(n,k,f){n.DeferredList=function(r,p,d,n,m){var q=[];k.call(this);var u=this;0!==r.length||p||this.resolve([0,[]]);var c=0;f.forEach(r,function(b,g){function x(b,a){q[g]=[b,a];c++;c===r.length&&u.resolve(q)}b.then(function(b){p?u.resolve([g,b]):x(!0,b)},function(b){d?u.reject(b):x(!1,b);if(n)return null;throw b;})})};n.DeferredList.prototype=new k;n.DeferredList.prototype.gatherResults=
function(k){k=new n.DeferredList(k,!1,!0,!1);k.addCallback(function(k){var d=[];f.forEach(k,function(f){d.push(f[1])});return d});return k};return n.DeferredList})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(n,k,f,r,p,d,w,m){n=n([d,w],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(q,d){k.mixin(this,
d);this.initialize(q,d)},getTitle:function(q){var d;this.info&&(d=this.titleHasRelatedFields?"":this._getPopupValues(q,!0).title);return d||""},getContent:function(d){return this.info?(new m({template:this,graphic:d,chartTheme:this.chartTheme},r.create("div"))).domNode:""}});f("extend-esri")&&k.setObject("dijit.PopupTemplate",n,p);return n})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition dojo/i18n!dojo/cldr/nls/number".split(" "),
function(n,k,f,r,p,d,w,m,q,u,c,b,g,x,h,a,e){n=n(null,{declaredClass:"esri.PopupInfo",initialize:function(a,b){if(a){k.mixin(this,b);this.info=a;this.title=this.getTitle;this.content=this.getContent;var l=this._fieldLabels={},v=this._fieldsMap={};a.fieldInfos&&f.forEach(a.fieldInfos,function(a){var t=a.fieldName.toLowerCase();l[t]=a.label;v[t]=a});this._relatedFieldPrefix="relationships/";this.titleHasRelatedFields=!(!a.title||-1===a.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return r.fromJson(r.toJson(this.info))},
getTitle:function(){},getContent:function(){},getFieldInfo:function(a){var l;f.some(this.info&&this.info.fieldInfos,function(b){b.fieldName===a&&(l=b);return!!l});return l},getComponents:function(a){var l=this.info,b=new w,e,y;l.fieldInfos&&(y=f.filter(l.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this));y&&0<y.length&&(e=this._getRelatedRecords({graphic:a,fieldsInfo:y}));e?e.always(k.hitch(this,function(){b.resolve(this._getPopupValues(a))})):b.resolve(this._getPopupValues(a));
return b.promise},getAttachments:function(a){var b=a.getLayer();a=a.attributes;if(this.info.showAttachments&&b&&b.hasAttachments&&b.objectIdField&&(a=a&&a[b.objectIdField]))return b.queryAttachmentInfos(a)},_getPopupValues:function(a,b){var l=this.info,e=a.getLayer(),y=k.clone(a.attributes)||{},t=k.clone(y),v=l.fieldInfos,c="",g="",x,h,d,q,m,p=e&&e._getDateOpts&&e._getDateOpts().properties,p=p&&p.slice(0),r={dateFormat:{properties:p,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};
if(this._relatedInfo)for(q in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(q)){var n=this._relatedInfo[q],w=this._relatedLayersInfo[q];n&&(f.forEach(n.relatedFeatures,function(a){for(m in a.attributes)if(a.attributes.hasOwnProperty(m)&&"esriRelCardinalityOneToOne"===w.relation.cardinality){var b=this._toRelatedFieldName([w.relation.id,m]);y[b]=t[b]=a.attributes[m]}},this),f.forEach(n.relatedStatsFeatures,function(a){for(m in a.attributes)if(a.attributes.hasOwnProperty(m)){var b=this._toRelatedFieldName([w.relation.id,
m]);y[b]=t[b]=a.attributes[m]}},this))}v&&f.forEach(v,function(a){h=a.fieldName;var b=this._getLayerFieldInfo(e,h);b&&(h=a.fieldName=b.name);t[h]=this._formatValue(t[h],h,r);p&&a.format&&a.format.dateFormat&&(a=f.indexOf(p,h),-1<a&&p.splice(a,1))},this);if(e){q=e.types;var X=(n=e.typeIdField)&&y[n];for(h in y)if(y.hasOwnProperty(h)&&-1===h.indexOf(this._relatedFieldPrefix)&&(d=y[h],u.isDefined(d))){var H=this._getDomainName(e,a,q,X,h,d);u.isDefined(H)?t[h]=H:h===n&&(H=this._getTypeName(e,a,d),u.isDefined(H)&&
(t[h]=H))}}l.title&&(c=this._processFieldsInLinks(this._fixTokens(l.title,e),y),c=k.trim(u.substitute(t,c,r)||""));if(b)return{title:c};l.description&&(g=this._processFieldsInLinks(this._fixTokens(l.description,e),y),g=k.trim(u.substitute(t,g,r)||""));v&&(x=[],f.forEach(v,function(a){(h=a.fieldName)&&a.visible&&x.push([a.label||h,u.substitute(t,"${"+h+"}",r)||""])}));var F,L;l.mediaInfos&&(F=[],f.forEach(l.mediaInfos,function(a){L=0;d=a.value;switch(a.type){case "image":var b=d.sourceURL,b=b&&k.trim(u.substitute(y,
this._fixTokens(b,e)));L=!!b;break;case "piechart":case "linechart":case "columnchart":case "barchart":var l,b=d.normalizeField;d.fields=f.map(d.fields,function(a){return(l=this._getLayerFieldInfo(e,a))?l.name:a},this);b&&(l=this._getLayerFieldInfo(e,b),d.normalizeField=l?l.name:b);L=f.some(d.fields,function(a){return u.isDefined(y[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(L){a=k.clone(a);d=a.value;var b=a.title?this._processFieldsInLinks(this._fixTokens(a.title,
e),y):"",v=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,e),y):"";a.title=b?k.trim(u.substitute(t,b,r)||""):"";a.caption=v?k.trim(u.substitute(t,v,r)||""):"";if("image"===a.type)d.sourceURL=u.substitute(y,this._fixTokens(d.sourceURL,e)),d.linkURL&&(d.linkURL=k.trim(u.substitute(y,this._fixTokens(d.linkURL,e))||""));else{var c,g;f.forEach(d.fields,function(a,b){if(-1!==a.indexOf(this._relatedFieldPrefix))g=this._getRelatedChartInfos(a,d,y,r),g instanceof Array?d.fields=g:d.fields[b]=
g;else{var t=y[a],t=void 0===t?null:t;c=y[d.normalizeField]||0;t&&c&&(t/=c);d.fields[b]={y:t,tooltip:(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(t,a,r,!!c)}}},this)}F.push(a)}},this));return{title:c,description:g,hasDescription:!!l.description,fields:x&&x.length?x:null,mediaInfos:F&&F.length?F:null,formatted:t,editSummary:e&&e.getEditSummary?e.getEditSummary(a):""}},_getRelatedChartInfos:function(a,b,e,c){var l,t,v,g,z,h;l=[];h=this._fromRelatedFieldName(a);z=h[0];t=this._relatedInfo[z];
z=this._relatedLayersInfo[z];t&&f.forEach(t.relatedFeatures,function(t){t=t.attributes;var y,z;for(z in t)if(t.hasOwnProperty(z)&&z===h[1]){y={};g=t[z];b.normalizeField&&(v=-1!==b.normalizeField.indexOf(this._relatedFieldPrefix)?t[this._fromRelatedFieldName(b.normalizeField)[1]]:e[b.normalizeField]);g&&v&&(g/=v);if(b.tooltipField)if(-1!==b.tooltipField.indexOf(this._relatedFieldPrefix)){var d=this._fromRelatedFieldName(b.tooltipField)[1],x=u.isDefined(t[d])?t[d]:d;y.tooltip=x+":\x3cbr/\x3e"+this._formatValue(g,
d,c,!!v)}else y.tooltip=(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(g,b.tooltipField,c,!!v);else y.tooltip=g;y.y=g;l.push(y)}},this);return"esriRelCardinalityOneToMany"===z.relation.cardinality||"esriRelCardinalityManyToMany"===z.relation.cardinality?l:l[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",
shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,
_fixTokens:function(a,b){var l=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,e,t){a=l._getLayerFieldInfo(b,t);return"$"+(a?"{"+a.name+"}":e)})},_encodeAttributes:function(a){a=k.clone(a)||{};var b,l;for(b in a)(l=a[b])&&"string"===typeof l&&(l=encodeURIComponent(l).replace(/\'/g,"\x26apos;"),a[b]=l);return a},_processFieldsInLinks:function(a,b){var l=this._encodeAttributes(b),e=this;a&&(a=a.replace(this._reHref,function(a,t){return e._addValuesToHref(a,t,b,l)}).replace(this._reHrefApos,function(a,
t){return e._addValuesToHref(a,t,b,l)}));return a},_addValuesToHref:function(a,b,e,c){b=b&&k.trim(b);return u.substitute(b&&0===b.indexOf("${")?e:c,a)},_getLayerFieldInfo:function(a,b){return a&&a.getField?a.getField(b):null},_formatValue:function(a,b,c,g){var l=this._fieldsMap[b.toLowerCase()],t=l&&l.format;b=-1!==f.indexOf(c.dateFormat.properties,b);var v="number"===typeof a&&!b&&(!t||!t.dateFormat);if(!u.isDefined(a)||!l||!u.isDefined(t))return v?this._forceLTR(a):a;var h="",l=[],d=t.hasOwnProperty("places")||
t.hasOwnProperty("digitSeparator"),z=t.hasOwnProperty("digitSeparator")?t.digitSeparator:!0;if(d&&!b)h="NumberFormat",l.push("places: "+(u.isDefined(t.places)&&(!g||0<t.places)?Number(t.places):"Infinity")),l.length&&(h+="("+l.join(",")+")");else if(t.dateFormat)h="DateFormat"+this._insertOffset(this._dateFormats[t.dateFormat]||this._dateFormats.shortDateShortTime);else return v?this._forceLTR(a):a;var x=this._applyFormatting(a,h,c);d&&-1<a.constructor.toString().indexOf("Array")&&(x="",f.forEach(a,
k.hitch(this,function(a,b){b&&(x+=" ");x+=this._applyFormatting(a,h,c)})));d&&!z&&e.group&&(x=x.replace(new RegExp("\\"+e.group,"g"),""));b&&(x='\x3cspan class\x3d"esriDateValue"\x3e'+x+"\x3c/span\x3e");return v?this._forceLTR(x):x},_applyFormatting:function(a,b,e){return u.substitute({myKey:a},"${myKey:"+b+"}",e)||""},_forceLTR:function(a){var b=m("ie");return b&&10>=b?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=u.isDefined(this.utcOffset)?a.replace(/\)\s*$/,
", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,b,e,c,y,t){return(a=a.getDomain&&a.getDomain(y,{feature:b}))&&a.codedValues?a.getName(t):null},_getTypeName:function(a,b,e){return(a=a.getType&&a.getType(b))&&a.name},_getRelatedRecords:function(a){var b=a.graphic,e=new w,c;this._relatedLayersInfo?this._queryRelatedLayers(b).then(k.hitch(this,function(a){this._setRelatedRecords(b,a);e.resolve(a)}),k.hitch(this,this._handlerErrorResponse,e)):this._getRelatedLayersInfo(a).then(k.hitch(this,
function(a){for(c in a)a.hasOwnProperty(c)&&a[c]&&(this._relatedLayersInfo[c].relatedLayerInfo=a[c]);this._queryRelatedLayers(b).then(k.hitch(this,function(a){this._setRelatedRecords(b,a);e.resolve(a)}),k.hitch(this,this._handlerErrorResponse,e))}),k.hitch(this,this._handlerErrorResponse,e));return e.promise},_getRelatedLayersInfo:function(e){var c=e.fieldsInfo,l,g,y={};l=e.graphic.getLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});f.forEach(c,function(b){var t,e,c,g;t=this._fromRelatedFieldName(b.fieldName);
e=t[0];t=t[1];e&&(this._relatedLayersInfo[e]||(f.some(l.relationships,function(a){if(a.id==e)return g=a,!0}),g&&(this._relatedLayersInfo[e]={relation:g,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[e]&&(this._relatedLayersInfo[e].relatedFields.push(t),b.statisticType&&(c=new a,c.statisticType=b.statisticType,c.onStatisticField=t,c.outStatisticFieldName=t,this._relatedLayersInfo[e].outStatistics.push(c))))},this);for(g in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(g)&&
this._relatedLayersInfo[g]&&(e=this._relatedLayersInfo[g].relation,e=l.url.replace(/[0-9]+$/,e.relatedTableId),this._relatedLayersInfo[g].relatedLayerUrl=e,y[g]=b({url:e,content:{f:"json"},callbackParamName:"callback"}));return q(y)},_queryRelatedLayers:function(a){var b={},e;for(e in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(e)&&(b[e]=this._queryRelatedLayer({graphic:a,relatedInfo:this._relatedLayersInfo[e]}));return q(b)},_queryRelatedLayer:function(a){var b,e,c,l,t,h,d,m,u,
p,r,n,R;b=a.graphic;e=b.getLayer();c=e.url.match(/[0-9]+$/g)[0];r=a.relatedInfo;p=r.relatedLayerInfo;n=r.relatedLayerUrl;a=r.relation;f.some(p.relationships,function(a){if(a.relatedTableId===parseInt(c,10))return l=a,!0},this);l&&(t=new g,f.some(p.fields,function(a){if(a.name===l.keyField)return m=-1!==f.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),l.relationshipTableId&&l.keyFieldInRelationshipTable?(R=new w,
this._queryRelatedRecords(b,l).then(k.hitch(this,function(a){var c;c=a[b.attributes[e.objectIdField]];a=f.map(c.features,function(a){return a.attributes[p.objectIdField]},this);r.outStatistics&&0<r.outStatistics.length&&p.supportsStatistics&&(u=new g,u.objectIds=a,u.outFields=t.outFields,u.outStatistics=r.outStatistics);u&&(h=new x(n),h.execute(u).then(k.hitch(this,function(a){var b=[];b.push(c);b.push(a);R.resolve(b)})))}))):(d="string"===m?l.keyField+"\x3d'"+b.attributes[a.keyField]+"'":l.keyField+
"\x3d"+b.attributes[a.keyField],t.where=d,t.outFields=r.relatedFields,r.outStatistics&&0<r.outStatistics.length&&p.supportsStatistics&&(u=new g,u.where=t.where,u.outFields=t.outFields,u.outStatistics=r.outStatistics),h=new x(n),d=[],d.push(h.execute(t)),u&&d.push(h.execute(u))));return d?q(d):R?R.promise:void 0},_setRelatedRecords:function(a,b){this._relatedInfo=[];for(var e in b)if(b.hasOwnProperty(e)&&b[e]){var c=b[e];this._relatedInfo[e]={};this._relatedInfo[e].relatedFeatures=c[0].features;u.isDefined(c[1])&&
(this._relatedInfo[e].relatedStatsFeatures=c[1].features)}},_handlerErrorResponse:function(a,b){a.reject(b)},_fromRelatedFieldName:function(a){var b=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),b=a.slice(1));return b},_toRelatedFieldName:function(a){var b="";a&&0<a.length&&(b=this._relatedFieldPrefix+a[0]+"/"+a[1]);return b},_queryRelatedRecords:function(a,b){var e=a.getLayer(),c=new h;c.outFields=["*"];c.relationshipId=b.id;c.objectIds=[a.attributes[e.objectIdField]];return e.queryRelatedFeatures(c)}});
d("extend-esri")&&(c.PopupInfo=c.PopupInfoTemplate=n);return n})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(n,k,f,r,p,d,w,m,q,u,c,b,g){n=n(b,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],
"execute-relationship-query-complete":["featureSets"]},constructor:function(b,c){this._handler=k.hitch(this,this._handler);this._relationshipQueryHandler=k.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=k.hitch(this,this._executeForIdsHandler);this._countHandler=k.hitch(this,this._countHandler);this._extentHandler=k.hitch(this,this._extentHandler);this.source=c&&c.source;this.gdbVersion=c&&c.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],
e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(b,c,a,e,g){var l=g.assembly;b=this._encode(k.mixin({},this._url.query,{f:"json"},b.toJson(l&&l[0])));var d=this._handler,h=this._errorHandler;
this.source&&(l={source:this.source.toJson()},b.layer=p.toJson(l));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return m({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,e){d(b,e,c,a,g.dfd)},error:function(b){h(b,a,g.dfd)},callbackSuffix:e},this.requestOptions)},executeRelationshipQuery:function(b,c,a){b=this._encode(k.mixin({},this._url.query,{f:"json"},b.toJson()));var e=this._relationshipQueryHandler,g=this._errorHandler;this.gdbVersion&&(b.gdbVersion=this.gdbVersion);
var d=new r(q._dfdCanceller);d._pendingDfd=m({url:this._url.path+"/queryRelatedRecords",content:b,callbackParamName:"callback",load:function(b,g){e(b,g,c,a,d)},error:function(b){g(b,a,d)}},this.requestOptions);return d},executeForIds:function(b,c,a,e){var g=e.assembly;b=this._encode(k.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},b.toJson(g&&g[0])));var d=this._executeForIdsHandler,h=this._errorHandler;this.source&&(g={source:this.source.toJson()},b.layer=p.toJson(g));this.gdbVersion&&(b.gdbVersion=
this.gdbVersion);return m({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,g){d(b,g,c,a,e.dfd)},error:function(b){h(b,a,e.dfd)}},this.requestOptions)},executeForCount:function(b,c,a,e){var g=e.assembly;b=this._encode(k.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},b.toJson(g&&g[0])));var d=this._countHandler,h=this._errorHandler;this.source&&(g={source:this.source.toJson()},b.layer=p.toJson(g));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);
return m({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,g){d(b,g,c,a,e.dfd)},error:function(b){h(b,a,e.dfd)}},this.requestOptions)},executeForExtent:function(b,c,a,e){var g=e.assembly;b=this._encode(k.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},b.toJson(g&&g[0])));var d=this._extentHandler,h=this._errorHandler;this.source&&(g={source:this.source.toJson()},b.layer=p.toJson(g));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return m({url:this._url.path+
"/query",content:b,callbackParamName:"callback",load:function(b,g){d(b,g,c,a,e.dfd)},error:function(b){h(b,a,e.dfd)}},this.requestOptions)},_handler:function(b,c,a,e,l){try{var d=new g(b);this._successHandler([d],"onComplete",a,l)}catch(z){this._errorHandler(z,e,l)}},_relationshipQueryHandler:function(b,c,a,e,l){try{var d=b.geometryType,h=b.spatialReference,q={};f.forEach(b.relatedRecordGroups,function(a){var b={};b.geometryType=d;b.spatialReference=h;b.features=a.relatedRecords;b=new g(b);if(null!=
a.objectId)q[a.objectId]=b;else for(var e in a)a.hasOwnProperty(e)&&"relatedRecords"!==e&&(q[a[e]]=b)});this._successHandler([q],"onExecuteRelationshipQueryComplete",a,l)}catch(y){this._errorHandler(y,e,l)}},_executeForIdsHandler:function(b,c,a,e,g){try{this._successHandler([b.objectIds],"onExecuteForIdsComplete",a,g)}catch(v){this._errorHandler(v,e,g)}},_countHandler:function(b,c,a,e,g){try{var l,d=b.features,h=b.objectIds;if(h)l=h.length;else{if(d)throw Error("Unable to perform query. Please check your parameters.");
l=b.count}this._successHandler([l],"onExecuteForCountComplete",a,g)}catch(y){this._errorHandler(y,e,g)}},_extentHandler:function(b,c,a,e,g){try{b.extent&&(b.extent=new u(b.extent)),this._successHandler([b],"onExecuteForExtentComplete",a,g)}catch(v){this._errorHandler(v,e,g)}}});c._createWrappers(n);d("extend-esri")&&k.setObject("tasks.QueryTask",n,w);return n})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),
function(n,k,f,r,p,d,w,m){n=n(m,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(d,m){d&&k.isString(d)&&(this._url=w.urlToObject(this.url=d));m&&m.requestOptions&&(this.requestOptions=m.requestOptions);this.normalization=!0;this._errorHandler=k.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var d=this._url,m=/^http:/i;this.url&&(this.url=this.url.replace(m,"https:"));d&&d.path&&(d.path=d.path.replace(m,"https:"))},
_encode:function(d,m,c){var b,g,q={},h,a;for(h in d)if("declaredClass"!==h&&(b=d[h],g=typeof b,null!==b&&void 0!==b&&"function"!==g))if(k.isArray(b))for(q[h]=[],a=b.length,g=0;g<a;g++)q[h][g]=this._encode(b[g]);else"object"===g?b.toJson&&(g=b.toJson(c&&c[h]),"esri.tasks.FeatureSet"===b.declaredClass&&g.spatialReference&&(g.sr=g.spatialReference,delete g.spatialReference),q[h]=m?g:f.toJson(g)):q[h]=b;return q},_successHandler:function(q,m,c,b){m&&this[m].apply(this,q);c&&c.apply(null,q);b&&d._resDfd(b,
q)},_errorHandler:function(d,m,c){this.onError(d);m&&m(d);c&&c.errback(d)},setNormalization:function(d){this.normalization=d},onError:function(){}});r("extend-esri")&&(p.Task=n);return n})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(n,k,f,r,p,d,w,m,q,u,c){n=n(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(b){if(b){k.mixin(this,
b);var g=this.features,d=b.spatialReference,h=u.getGeometryType(b.geometryType),d=this.spatialReference=new m(d);this.geometryType=b.geometryType;b.fields&&(this.fields=b.fields);f.forEach(g,function(a,b){var e=a.geometry&&a.geometry.spatialReference;g[b]=new w(h&&a.geometry?new h(a.geometry):null,a.symbol&&c.fromJson(a.symbol),a.attributes);g[b].geometry&&!e&&g[b].geometry.setSpatialReference(d)});this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,
fieldAliases:null,toJson:function(b){var c={};this.displayFieldName&&(c.displayFieldName=this.displayFieldName);this.fields&&(c.fields=this.fields);this.spatialReference?c.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(c.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(c.geometryType=u.getJsonType(this.features[0].geometry)),c.features=q._encodeGraphics(this.features,b));c.exceededTransferLimit=
this.exceededTransferLimit;c.transform=this.transform;return d.fixJson(c)},_hydrate:function(){var b=this.transform,c=this.geometryType;if(b&&c)for(var d=this.features,h=b.translate[0],a=b.translate[1],e=b.scale[0],l=b.scale[1],v=function(a,b,e){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=e(a.y)};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){a=a.rings||a.paths;var c,t,g,d,l,y,h,v;c=0;for(t=a.length;c<t;c++)for(l=a[c],g=0,d=l.length;g<d;g++)y=l[g],0<g?
(h+=y[0],v+=y[1]):(h=y[0],v=y[1]),y[0]=b(h),y[1]=e(v)};if("esriGeometryEnvelope"===a)return function(a){a.xmin=b(a.xmin);a.ymin=e(a.ymin);a.xmax=b(a.xmax);a.ymax=e(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var c,t,g,d,l;c=0;for(t=a.length;c<t;c++)g=a[c],0<c?(d+=g[0],l+=g[1]):(d=g[0],l=g[1]),g[0]=b(d),g[1]=e(l)}}(c,function(a){return a*e+h},function(b){return a-b*l}),b=0,c=d.length;b<c;b++)d[b].geometry&&v(d[b].geometry);this.transform=null},quantize:function(b){if(!this.geometryType)return this.transform=
null,this;var c=b.translate[0],d=b.translate[1],h=b.scale[0],a=b.scale[1],e=this.features,l=function(a,b,e){var c,t,g,d,l,y,h=[];c=0;for(t=a.length;c<t;c++)if(g=a[c],0<c){if(y=b(g[0]),g=e(g[1]),y!==d||g!==l)h.push([y-d,g-l]),d=y,l=g}else d=b(g[0]),l=e(g[1]),h.push([d,l]);return 0<h.length?h:null},v=function(a,b,c){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=c(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){var e,g,t,d,y;t=a.rings||a.paths;
y=[];e=0;for(g=t.length;e<g;e++)d=t[e],(d=l(d,b,c))&&y.push(d);return 0<y.length?(a.rings?a.rings=y:a.paths=y,a):null};if("esriGeometryMultipoint"===a)return function(a){var e;e=l(a.points,b,c);return 0<e.length?(a.points=e,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,function(a){return Math.round((a-c)/h)},function(b){return Math.round((d-b)/a)}),m,q;m=0;for(q=e.length;m<q;m++)e[m].geometry&&(v(e[m].geometry)||e[m].setGeometry(null));this.transform=b;return this}});
r("extend-esri")&&k.setObject("tasks.FeatureSet",n,p);return n})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(n,k,f,r,p){n=n(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,toJson:function(){var d={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,
maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},k=this.objectIds,m=this.outFields,q=this.outSpatialReference;k&&(d.objectIds=k.join(","));m&&(d.outFields=m.join(","));q&&(d.outSR=q.wkid||f.toJson(q.toJson()));d._ts=this._ts;return d}});r("extend-esri")&&k.setObject("tasks.RelationshipQuery",n,p);return n})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,k,f,r){n=n(null,{declaredClass:"esri.tasks.StatisticDefinition",
toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});f("extend-esri")&&k.setObject("tasks.StatisticDefinition",n,r);return n})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(n,k,f,r,p,d,w,m,q,u,c,b,g,x,h,a,e,l,v,z){var A=0;k=k([v,h,a],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=r.mixin({},z.widgets.popup)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(r.hitch(this,this._handleComponentsSuccess),r.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+
1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var a=this._mediaInfos,b=a.length,e=this.domNode,g=this._prevMedia,l=this._nextMedia;if(1<b){var h=0,v=0;p.forEach(a,function(a){"image"===a.type?h++:-1!==a.type.indexOf("chart")&&v++});h&&(u.set(this._imageCount,"innerHTML",h),d.query(".summary .image",e).removeClass("hidden"));v&&(u.set(this._chartCount,"innerHTML",v),d.query(".summary .chart",e).removeClass("hidden"))}else d.query(".summary",
e).addClass("hidden"),c.add(g,"hidden"),c.add(l,"hidden");a=this._mediaPtr;0===a?c.add(g,"hidden"):c.remove(g,"hidden");a===b-1?c.add(l,"hidden"):c.remove(l,"hidden");this._destroyFrame()},_displayMedia:function(){var a=this._mediaInfos[this._mediaPtr],b=a.title,e=a.caption,g=d.query(".mediaSection .hzLine",this.domNode)[0];u.set(this._mediaTitle,"innerHTML",b);c[b?"remove":"add"](this._mediaTitle,"hidden");u.set(this._mediaCaption,"innerHTML",e);c[e?"remove":"add"](this._mediaCaption,"hidden");c[b&&
e?"remove":"add"](g,"hidden");this._rid=null;if("image"===a.type)this._showImage(a.value);else{var l=this,b=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],e=a.value.theme||this.chartTheme;r.isString(e)&&(e=e.replace(/\./gi,"/"),-1===e.indexOf("/")&&(e="dojox/charting/themes/"+e));e||(e="./Rainbow");b.push(e);try{var h=this._rid=A++;n(b,function(b,e,c){h===l._rid&&(l._rid=null,l._showChart(a.type,a.value,b,e,c))})}catch(ha){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(a){return(a=
a&&r.trim(a).toLowerCase())&&(0===a.indexOf("mailto:")||0===a.indexOf("tel:"))},_showImage:function(a){c.add(this._mediaFrame,"image");var e=g.get(this._gallery,"height"),l;a.linkURL&&(l=b.create("a",{href:a.linkURL,target:this._preventNewTab(a.linkURL)?"":"_blank"},this._mediaFrame));b.create("img",{className:"esriPopupMediaImage",src:a.sourceURL},l||this._mediaFrame);var h=d.query(".esriPopupMediaImage",this._mediaFrame)[0],y=this,v;v=f.connect(h,"onload",function(){f.disconnect(v);v=null;y._imageLoaded(h,
e)})},_showChart:function(a,e,g,d,l){c.remove(this._mediaFrame,"image");g=this._chart=new g(b.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});l&&g.setTheme(l);switch(a){case "piechart":g.addPlot("default",{type:"Pie",labels:!1});g.addSeries("Series A",e.fields);break;case "linechart":g.addPlot("default",{type:"Markers"});g.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});g.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});p.forEach(e.fields,
function(a,b){a.x=b+1});g.addSeries("Series A",e.fields);break;case "columnchart":g.addPlot("default",{type:"Columns",gap:3});g.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});g.addSeries("Series A",e.fields);break;case "barchart":g.addPlot("default",{type:"Bars",gap:3}),g.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),g.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),g.addSeries("Series A",e.fields)}this._action=new d(g);g.render()},
_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);u.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,b){var e=a.height;e<b&&g.set(a,"marginTop",Math.round((b-e)/2)+"px")},_attListHandler:function(a,b){if(a===this._dfd){this._dfd=null;var e="";b instanceof Error||!b||!b.length||p.forEach(b,function(a){e+="\x3cli\x3e";e+="\x3ca href\x3d'"+l.addProxy(a.url)+"' target\x3d'_blank'\x3e"+(a.name||
"[No name]")+"\x3c/a\x3e";e+="\x3c/li\x3e"});u.set(this._attachmentsList,"innerHTML",e||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_handleComponentsSuccess:function(a){if(a){var b=this.showTitle?a.title:"",e=a.description,g=a.fields,l=a.mediaInfos,h=this.domNode,v=this._nls,y=this,m=this.template,f=this.graphic;this._prevMedia.title=v.NLS_prevMedia;this._nextMedia.title=v.NLS_nextMedia;u.set(this._title,"innerHTML",b);b||c.add(this._title,"hidden");!a.hasDescription&&g&&(e="",p.forEach(g,
function(a){e+="\x3ctr valign\x3d'top'\x3e";e+="\x3ctd class\x3d'attrName'\x3e"+x.encode(a[0])+"\x3c/td\x3e";e+="\x3ctd class\x3d'attrValue'\x3e"+a[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+v.NLS_moreInfo+"\x3c/a\x3e")+"\x3c/td\x3e";e+="\x3c/tr\x3e"}),e&&(e="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+e+"\x3c/table\x3e"));u.set(this._description,"innerHTML",e);e||c.add(this._description,"hidden");d.query("a",
this._description).forEach(function(a){y._preventNewTab(a.href)?"_blank"===a.target&&u.remove(a,"target"):u.set(a,"target","_blank")});b&&e?d.query(".mainSection .hzLine",h).removeClass("hidden"):b||e?d.query(".mainSection .hzLine",h).addClass("hidden"):d.query(".mainSection",h).addClass("hidden");if(b=this._dfd=m.getAttachments(f))b.addBoth(r.hitch(this,this._attListHandler,b)),u.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+v.NLS_searching+"...\x3c/li\x3e"),d.query(".attachmentsSection",h).removeClass("hidden");
l&&l.length&&(d.query(".mediaSection",h).removeClass("hidden"),q.setSelectable(this._mediaFrame,!1),this._mediaInfos=l,this._mediaPtr=0,this._updateUI(),this._displayMedia());a.editSummary&&(u.set(this._editSummary,"innerHTML",a.editSummary),l&&l.length&&c.remove(this._mediaBreak,"hidden"),c.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(a){console.log("PopupRenderer: error loading template",a)}});w("extend-esri")&&r.setObject("dijit._PopupRenderer",k,e);return k})},
"dojox/html/entities":function(){define(["dojo/_base/lang"],function(n){var k=n.getObject("dojox.html.entities",!0),f=function(f,d){var k,m;if(d._encCache&&d._encCache.regexp&&d._encCache.mapper&&d.length==d._encCache.length)k=d._encCache.mapper,m=d._encCache.regexp;else{k={};m=["["];var q;for(q=0;q<d.length;q++)k[d[q][0]]="\x26"+d[q][1]+";",m.push(d[q][0]);m.push("]");m=new RegExp(m.join(""),"g");d._encCache={mapper:k,regexp:m,length:d.length}}return f=f.replace(m,function(d){return k[d]})},r=function(f,
d){var k,m;if(d._decCache&&d._decCache.regexp&&d._decCache.mapper&&d.length==d._decCache.length)k=d._decCache.mapper,m=d._decCache.regexp;else{k={};m=["("];var q;for(q=0;q<d.length;q++){var u="\x26"+d[q][1]+";";q&&m.push("|");k[u]=d[q][0];m.push(u)}m.push(")");m=new RegExp(m.join(""),"g");d._decCache={mapper:k,regexp:m,length:d.length}}return f=f.replace(m,function(c){return k[c]})};k.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];k.latin=[["\u00a1","iexcl"],["\u00a2",
"cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],
["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],
["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1",
"ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],
["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],
["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],
["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],
["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665",
"hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039",
"lsaquo"],["\u203a","rsaquo"]];k.encode=function(p,d){p&&(d?p=f(p,d):(p=f(p,k.html),p=f(p,k.latin)));return p};k.decode=function(f,d){f&&(d?f=r(f,d):(f=r(f,k.html),f=r(f,k.latin)));return f};return k})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(n,k,f,r,p,d,w,m,q,u,c,b,g){function x(){}
function h(a){return function(b,c,g,d){return b&&"string"==typeof c&&b[c]==x?b.on(c.substring(2).toLowerCase(),w.hitch(g,d)):a.apply(f,arguments)}}n.around(f,"connect",h);d.connect&&n.around(d,"connect",h);n=r("dijit._Widget",[c,b,g],{onClick:x,onDblClick:x,onKeyDown:x,onKeyPress:x,onKeyUp:x,onMouseDown:x,onMouseMove:x,onMouseOut:x,onMouseOver:x,onMouseLeave:x,onMouseEnter:x,onMouseUp:x,constructor:function(a){this._toConnect={};for(var b in a)this[b]===x&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=
a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===x?f.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){d.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(a,b)},attr:function(a,
b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){d.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?m("[widgetId]",this.containerNode).map(u.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});p("dijit-legacy-requires")&&q(0,function(){require(["dijit/_base"])});return n})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(n,k,f,r,p,d,w,m,q,u,c,b,g,x,h,a,e,l,v,z,A,y,t){function C(a){return function(b){m[b?"set":"remove"](this.domNode,a,b);this._set(a,b)}}g.add("dijit-legacy-requires",!x.isAsync);g.add("dojo-bidi",!1);g("dijit-legacy-requires")&&e(0,function(){n(["dijit/_base/manager"])});var D={};r=d("dijit._WidgetBase",[l,A],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:C("lang"),dir:"",_setDirAttr:C("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:r.blankGif||n.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,e=a._setterAttrs=[],a=a._onMap={},c;for(c in b.attributeMap)e.push(c);for(c in b)/^on/.test(c)&&(a[c.substring(2).toLowerCase()]=c),/^_set[A-Z](.*)Attr$/.test(c)&&(c=c.charAt(4).toLowerCase()+
c.substr(5,c.length-9),b.attributeMap&&c in b.attributeMap||e.push(c))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();this.srcNodeRef=w.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,h.mixin(this,a));this.postMixInProperties();this.id||(this.id=t.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=
this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=z.body(this.ownerDocument);t.add(this);this.buildRendering();var e;if(this.domNode){this._applyAttributes();var c=this.srcNodeRef;c&&c.parentNode&&this.domNode!==c&&(c.parentNode.replaceChild(this.domNode,c),e=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();e&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);
k.forEach(this.constructor._setterAttrs,function(b){if(!(b in a)){var e=this._get(b);e&&this.set(b,e)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(k.map(a,function(a){return a+"Rtl"})));q.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=
!0,k.forEach(this.getChildren(),function(a){a._started||a._destroyed||!h.isFunction(a.startup)||(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(b){b.destroyRecursive?b.destroyRecursive(a):b.destroy&&b.destroy(a)}this._beingDestroyed=!0;this.uninitialize();k.forEach(this._connects,h.hitch(this,"disconnect"));k.forEach(this._supportingWidgets,b);this.domNode&&k.forEach(t.findWidgets(this.domNode,
this.containerNode),b);this.destroyRendering(a);t.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);this.domNode&&(a?m.remove(this.domNode,"widgetId"):u.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||u.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){k.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var e=
this.domNode;h.isObject(a)?b.set(e,a):e.style.cssText=e.style.cssText?e.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,b,e){e=3<=arguments.length?e:this.attributeMap[a];k.forEach(h.isArray(e)?e:[e],function(e){var c=this[e.node||e||"domNode"];switch(e.type||"attribute"){case "attribute":h.isFunction(b)&&(b=h.hitch(this,b));e=e.attribute?e.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;c.tagName?m.set(c,e,b):c.set(e,b);break;case "innerText":c.innerHTML="";c.appendChild(this.ownerDocument.createTextNode(b));
break;case "innerHTML":c.innerHTML=b;break;case "class":q.replace(c,b,this[a]);break;case "toggleClass":q.toggle(c,e.className||a,b)}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var e in a)this.set(e,a[e]);return this}e=this._getAttrNames(a);var c=this[e.s];if(h.isFunction(c))var g=c.apply(this,Array.prototype.slice.call(arguments,1));else{var c=this.focusNode&&!h.isFunction(this.focusNode)?"focusNode":
"domNode",d=this[c]&&this[c].tagName,t;if((t=d)&&!(t=D[d])){t=this[c];var l={},v;for(v in t)l[v.toLowerCase()]=!0;t=D[d]=l}v=t;e=a in this.attributeMap?this.attributeMap[a]:e.s in this?this[e.s]:v&&e.l in v&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?c:null;null!=e&&this._attrToDom(a,b,e);this._set(a,b)}return g||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var e=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});
return b[a]={n:a+"Node",s:"_set"+e+"Attr",g:"_get"+e+"Attr",l:e.toLowerCase()}},_set:function(a,b){var e=this[a];this[a]=b;!this._created||e===b||e!==e&&b!==b||(this._watchCallbacks&&this._watchCallbacks(a,e,b),this.emit("attrmodified-"+a,{detail:{prevValue:e,newValue:b}}))},_get:function(a){return this[a]},emit:function(b,e,c){e=e||{};void 0===e.bubbles&&(e.bubbles=!0);void 0===e.cancelable&&(e.cancelable=!0);e.detail||(e.detail={});e.detail.widget=this;var g,d=this["on"+b];d&&(g=d.apply(this,c?
c:[e]));this._started&&!this._beingDestroyed&&a.emit(this.domNode,b.toLowerCase(),e);return g},on:function(b,e){var c=this._onMap(b);return c?f.after(this,c,e,!0):this.own(a(this.domNode,b,e))[0]},_onMap:function(a){var b=this.constructor,e=b._onMap;if(!e){var e=b._onMap={},c;for(c in b.prototype)/^on/.test(c)&&(e[c.replace(/^on/,"").toLowerCase()]=c)}return e["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?
t.findWidgets(this.containerNode):[]},getParent:function(){return t.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,b,e){return this.own(p.connect(a,b,this,e))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(v.subscribe(a,h.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():c.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=b.get(this.domNode,"display")},
placeAt:function(a,b){var e=!a.tagName&&t.byId(a);!e||!e.addChild||b&&"number"!==typeof b?(e=e&&"domNode"in e?e.containerNode&&!/after|before|replace/.test(b||"")?e.containerNode:e.domNode:w.byId(a,this.ownerDocument),u.place(this.domNode,e,b),!this._started&&(this.getParent()||{})._started&&this.startup()):e.addChild(this,b);return this},defer:function(a,b){var e=setTimeout(h.hitch(this,function(){e&&(e=null,this._destroyed||h.hitch(this,a)())}),b||0);return{remove:function(){e&&(clearTimeout(e),
e=null);return null}}}});g("dojo-bidi")&&r.extend(y);return r})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(n,k,f){return f("dijit.Destroyable",null,{destroy:function(f){this._destroyed=!0},own:function(){var f=["destroyRecursive","destroy","remove"];n.forEach(arguments,function(p){function d(){m.remove();n.forEach(q,function(d){d.remove()})}var r,m=k.before(this,"destroy",function(d){p[r](d)}),q=[];p.then?(r="cancel",p.then(d,d)):n.forEach(f,
function(m){"function"===typeof p[m]&&(r||(r=m),q.push(k.after(p,m,d,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(n,k,f,r,p,d){n=r("dijit._OnDijitClickMixin",null,{connect:function(f,m,q){return this.inherited(arguments,[f,"ondijitclick"==m?d:m,q])}});n.a11yclick=d;return n})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],
function(n,k,f,r){r.extend(k,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return f("dijit._FocusMixin",null,{_focusManager:n})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(n,k,f,r){f(function(){k("highcontrast")&&n.add(r.body(),"dijit_a11y")});return k})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(n,k,f,r,p,d,w){p.add("highcontrast",function(){var d=w.doc.createElement("div");try{d.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(k.blankGif||n.toUrl("./resources/blank.gif"))+'");';w.body().appendChild(d);var q=r.getComputedStyle(d),f=q.backgroundImage;return q.borderTopColor==q.borderRightColor||f&&("none"==f||"url(invalid-url:)"==f)}catch(c){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
c.toString()),!1}finally{8>=p("ie")?d.outerHTML="":w.body().removeChild(d)}});d(function(){p("highcontrast")&&f.add(w.body(),"dj_a11y")});return p})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(n,k,f,r,p,d,w){d.extend(n,{waiRole:"",waiState:""});return p("dijit._Templated",[k,f],{constructor:function(){w.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(d,f){var m=this.inherited(arguments),c=f(d,"waiRole");c&&d.setAttribute("role",c);(c=f(d,"waiState"))&&r.forEach(c.split(/\s*,\s*/),function(b){-1!=b.indexOf("-")&&(b=b.split("-"),d.setAttribute("aria-"+b[0],b[1]))});return m}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(n,k,f,r,p,d,w,m){var q=k("dijit._TemplatedMixin",m,{templateString:null,
templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(d){var c=this.declaredClass,b=this;return w.substitute(d,this,function(g,d){"!"==d.charAt(0)&&(g=r.getObject(d.substr(1),!1,b));if("undefined"==typeof g)throw Error(c+" template:"+d);return null==g?"":"!"==d.charAt(0)?g:this._escapeValue(""+g)},this)},_escapeValue:function(d){return d.replace(/["'<>&]/g,function(c){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[c]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=n(this.templatePath,{sanitize:!0}));var d=q.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),c;if(r.isString(d)){if(c=f.toDom(this._stringRepl(d),this.ownerDocument),1!=c.nodeType)throw Error("Invalid template: "+d);}else c=d.cloneNode(!0);this.domNode=c}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(d){var c=this.containerNode;if(d&&c)for(;d.hasChildNodes();)c.appendChild(d.firstChild)}});
q._templateCache={};q.getCachedTemplate=function(d,c,b){var g=q._templateCache,m=d,h=g[m];if(h){try{if(!h.ownerDocument||h.ownerDocument==(b||document))return h}catch(a){}f.destroy(h)}d=w.trim(d);if(c||d.match(/\$\{([^\}]+)\}/g))return g[m]=d;c=f.toDom(d,b);if(1!=c.nodeType)throw Error("Invalid template: "+d);return g[m]=c};d("ie")&&p(window,"unload",function(){var d=q._templateCache,c;for(c in d){var b=d[c];"object"==typeof b&&f.destroy(b);delete d[c]}});return q})},"dojo/cache":function(){define(["./_base/kernel",
"./text"],function(n){return n.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(n,k,f,r,p,d,w,m,q){var u=p.delegate(m,{mouseenter:d.enter,mouseleave:d.leave,keypress:f._keypress}),c;f=r("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);
this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(b){for(var c=b;;)if(1==c.nodeType&&(this._processTemplateNode(c,function(b,c){return b.getAttribute(c)},this._attach)||this.searchContainerNode)&&c.firstChild)c=c.firstChild;else{if(c==b)break;for(;!c.nextSibling;)if(c=c.parentNode,c==b)return;c=c.nextSibling}},_processTemplateNode:function(b,c,d){var g=!0,a=this.attachScope||this,e=c(b,"dojoAttachPoint")||c(b,"data-dojo-attach-point");if(e)for(var l=e.split(/\s*,\s*/);e=
l.shift();)p.isArray(a[e])?a[e].push(b):a[e]=b,g="containerNode"!=e,this._attachPoints.push(e);if(c=c(b,"dojoAttachEvent")||c(b,"data-dojo-attach-event"))for(e=c.split(/\s*,\s*/),l=p.trim;c=e.shift();)if(c){var v=null;-1!=c.indexOf(":")?(v=c.split(":"),c=l(v[0]),v=l(v[1])):c=l(c);v||(v=c);this._attachEvents.push(d(b,c,p.hitch(a,v)))}return g},_attach:function(b,d,m){d=d.replace(/^on/,"").toLowerCase();d="dijitclick"==d?c||(c=n("./a11yclick")):u[d]||d;return w(b,d,m)},_detachTemplateNodes:function(){var b=
this.attachScope||this;k.forEach(this._attachPoints,function(c){delete b[c]});this._attachPoints=[];k.forEach(this._attachEvents,function(b){b.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});p.extend(q,{dojoAttachEvent:"",dojoAttachPoint:""});return f})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(n,k,f,r,p){return f("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var d=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);p.parse(d,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(r.hitch(this,function(d){this._startupWidgets=d;for(var m=0;m<d.length;m++)this._processTemplateNode(d[m],
function(d,m){return d[m]},function(d,m,c){return m in d?d.connect(d,m,c):d.on(m,c,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(d,f,m){return f(d,"dojoType")||f(d,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){n.forEach(this._startupWidgets,function(d){d&&!d._started&&d.startup&&d.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(n,k,f,r,p,d,w,m,q,u,c,b,g,x,h,a){function e(a){return eval("("+a+")")}function l(a){var b=
a._nameCaseMap,e=a.prototype;if(!b||b._extendCnt<z){var b=a._nameCaseMap={},c;for(c in e)"_"!==c.charAt(0)&&(b[c.toLowerCase()]=c);b._extendCnt=z}return b}function v(a,b){b||(b=n);var e=b._dojoParserCtorMap||(b._dojoParserCtorMap={}),c=a.join();if(!e[c]){for(var d=[],g=0,l=a.length;g<l;g++){var t=a[g];d[d.length]=e[t]=e[t]||f.getObject(t)||~t.indexOf("/")&&b(t)}g=d.shift();e[c]=d.length?g.createSubclass?g.createSubclass(d):g.extend.apply(g,d):g}return e[c]}new Date("X");var z=0;q.after(f,"extend",
function(){z++},!0);var A={_clearCache:function(){z++;_ctorMap={}},_functionFromScript:function(a,b){var e="",c="",d=a.getAttribute(b+"args")||a.getAttribute("args"),g=a.getAttribute("with"),d=(d||"").split(/\s*,\s*/);g&&g.length&&r.forEach(g.split(/\s*,\s*/),function(a){e+="with("+a+"){";c+="}"});return new Function(d,e+a.innerHTML+c)},instantiate:function(a,b,e){b=b||{};e=e||{};var c=(e.scope||k._scopeName)+"Type",d="data-"+(e.scope||k._scopeName)+"-",g=d+"type",l=d+"mixins",t=[];r.forEach(a,function(a){var e=
c in b?b[c]:a.getAttribute(g)||a.getAttribute(c);if(e){var d=a.getAttribute(l),e=d?[e].concat(d.split(/\s*,\s*/)):[e];t.push({node:a,types:e})}});return this._instantiate(t,b,e)},_instantiate:function(a,b,e,c){function d(a){b._started||e.noStart||r.forEach(a,function(a){"function"!==typeof a.startup||a._started||a.startup()});return a}a=r.map(a,function(a){var c=a.ctor||v(a.types,e.contextRequire);if(!c)throw Error("Unable to resolve constructor for: '"+a.types.join()+"'");return this.construct(c,
a.node,b,e,a.scripts,a.inherited)},this);return c?u(a).then(d):d(a)},construct:function(a,b,d,v,z,p){function t(a){M&&f.setObject(M,a);for(D=0;D<I.length;D++)q[I[D].advice||"after"](a,I[D].method,f.hitch(a,I[D].func),!0);for(D=0;D<T.length;D++)T[D].call(a);for(D=0;D<V.length;D++)a.watch(V[D].prop,V[D].func);for(D=0;D<O.length;D++)h(a,O[D].event,O[D].func);return a}var y=a&&a.prototype;v=v||{};var A={};v.defaults&&f.mixin(A,v.defaults);p&&f.mixin(A,p);var u;g("dom-attributes-explicit")?u=b.attributes:
g("dom-attributes-specified-flag")?u=r.filter(b.attributes,function(a){return a.specified}):(p=(/^input$|^img$/i.test(b.nodeName)?b:b.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),u=r.map(p.split(/\s+/),function(a){var e=a.toLowerCase();return{name:a,value:"LI"==b.nodeName&&"value"==a||"enctype"==e?b.getAttribute(e):b.getAttributeNode(e).value}}));var n=v.scope||k._scopeName;p="data-"+n+"-";var C={};"dojo"!==n&&(C[p+"props"]=
"data-dojo-props",C[p+"type"]="data-dojo-type",C[p+"mixins"]="data-dojo-mixins",C[n+"type"]="dojotype",C[p+"id"]="data-dojo-id");for(var D=0,w,n=[],M,H;w=u[D++];){var F=w.name,Q=F.toLowerCase();w=w.value;switch(C[Q]||Q){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":H=w;break;case "data-dojo-id":case "jsid":M=w;break;case "data-dojo-attach-point":case "dojoattachpoint":A.dojoAttachPoint=w;break;case "data-dojo-attach-event":case "dojoattachevent":A.dojoAttachEvent=
w;break;case "class":A["class"]=b.className;break;case "style":A.style=b.style&&b.style.cssText;break;default:if(F in y||(F=l(a)[Q]||F),F in y)switch(typeof y[F]){case "string":A[F]=w;break;case "number":A[F]=w.length?Number(w):NaN;break;case "boolean":A[F]="false"!=w.toLowerCase();break;case "function":""===w||-1!=w.search(/[^\w\.]+/i)?A[F]=new Function(w):A[F]=f.getObject(w,!1)||new Function(w);n.push(F);break;default:Q=y[F],A[F]=Q&&"length"in Q?w?w.split(/\s*,\s*/):[]:Q instanceof Date?""==w?new Date(""):
"now"==w?new Date:c.fromISOString(w):Q instanceof m?k.baseUrl+w:e(w)}else A[F]=w}}for(u=0;u<n.length;u++)C=n[u].toLowerCase(),b.removeAttribute(C),b[C]=null;if(H)try{H=e.call(v.propsThis,"{"+H+"}"),f.mixin(A,H)}catch(Z){throw Error(Z.toString()+" in data-dojo-props\x3d'"+H+"'");}f.mixin(A,d);z||(z=a&&(a._noScript||y._noScript)?[]:x("\x3e script[type^\x3d'dojo/']",b));var I=[],T=[],V=[],O=[];if(z)for(D=0;D<z.length;D++)C=z[D],b.removeChild(C),d=C.getAttribute(p+"event")||C.getAttribute("event"),v=
C.getAttribute(p+"prop"),H=C.getAttribute(p+"method"),n=C.getAttribute(p+"advice"),u=C.getAttribute("type"),C=this._functionFromScript(C,p),d?"dojo/connect"==u?I.push({method:d,func:C}):"dojo/on"==u?O.push({event:d,func:C}):A[d]=C:"dojo/aspect"==u?I.push({method:H,advice:n,func:C}):"dojo/watch"==u?V.push({prop:v,func:C}):T.push(C);a=(z=a.markupFactory||y.markupFactory)?z(A,b,a):new a(A,b);return a.then?a.then(t):t(a)},scan:function(a,e){function c(a){if(!a.inherited){a.inherited={};var b=a.node,e=
c(a.parent),b={dir:b.getAttribute("dir")||e.dir,lang:b.getAttribute("lang")||e.lang,textDir:b.getAttribute(q)||e.textDir},d;for(d in b)b[d]&&(a.inherited[d]=b[d])}return a.inherited}var d=[],l=[],t={},h=(e.scope||k._scopeName)+"Type",m="data-"+(e.scope||k._scopeName)+"-",f=m+"type",q=m+"textdir",m=m+"mixins",y=a.firstChild,z=e.inherited;if(!z){var p=function(a,b){return a.getAttribute&&a.getAttribute(b)||a.parentNode&&p(a.parentNode,b)},z={dir:p(a,"dir"),lang:p(a,"lang"),textDir:p(a,q)},x;for(x in z)z[x]||
delete z[x]}for(var z={inherited:z},A,u;;)if(y)if(1!=y.nodeType)y=y.nextSibling;else if(A&&"script"==y.nodeName.toLowerCase())(w=y.getAttribute("type"))&&/^dojo\/\w/i.test(w)&&A.push(y),y=y.nextSibling;else if(u)y=y.nextSibling;else{var w=y.getAttribute(f)||y.getAttribute(h);x=y.firstChild;if(w||x&&(3!=x.nodeType||x.nextSibling)){u=null;if(w){var L=y.getAttribute(m);A=L?[w].concat(L.split(/\s*,\s*/)):[w];try{u=v(A,e.contextRequire)}catch(T){}u||r.forEach(A,function(a){~a.indexOf("/")&&!t[a]&&(t[a]=
!0,l[l.length]=a)});L=u&&!u.prototype._noScript?[]:null;z={types:A,ctor:u,parent:z,node:y,scripts:L};z.inherited=c(z);d.push(z)}else z={node:y,scripts:A,parent:z};A=L;u=y.stopParser||u&&u.prototype.stopParser&&!e.template;y=x}else y=y.nextSibling}else{if(!z||!z.node)break;y=z.node.nextSibling;u=!1;z=z.parent;A=z.scripts}var I=new b;l.length?(g("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+l.join(", ")),(e.contextRequire||n)(l,function(){I.resolve(r.filter(d,function(a){if(!a.ctor)try{a.ctor=
v(a.types,e.contextRequire)}catch(Z){}for(var b=a.parent;b&&!b.types;)b=b.parent;var c=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(c&&c.stopParser&&!e.template);a.instantiate=!b||b.instantiate&&b.instantiateChildren;return a.instantiate}))})):I.resolve(d);return I.promise},_require:function(a,c){var d=e("{"+a.innerHTML+"}"),g=[],l=[],t=new b,h=c&&c.contextRequire||n,v;for(v in d)g.push(v),l.push(d[v]);h(l,function(){for(var a=0;a<g.length;a++)f.setObject(g[a],arguments[a]);t.resolve(arguments)});
return t.promise},_scanAmd:function(a,e){var c=new b,d=c.promise;c.resolve(!0);var g=this;x("script[type\x3d'dojo/require']",a).forEach(function(a){d=d.then(function(){return g._require(a,e)});a.parentNode.removeChild(a)});return d},parse:function(a,b){!a||"string"==typeof a||"nodeType"in a||(b=a,a=b.rootNode);var e=a?d.byId(a):w.body();b=b||{};var c=b.template?{template:!0}:{},g=[],l=this,t=this._scanAmd(e,b).then(function(){return l.scan(e,b)}).then(function(a){return l._instantiate(a,c,b,!0)}).then(function(a){return g=
g.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});f.mixin(g,t);return g}};k.parser=A;p.parseOnLoad&&a(100,A,"parse");return A})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(n,k){var f={};n.setObject("dojo.date.stamp",f);f.fromISOString=function(r,p){f._isoRegExp||(f._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var d=f._isoRegExp.exec(r),n=null;
if(d){d.shift();d[1]&&d[1]--;d[6]&&(d[6]*=1E3);p&&(p=new Date(p),k.forEach(k.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(d){return p["get"+d]()}),function(m,c){d[c]=d[c]||m}));n=new Date(d[0]||1970,d[1]||0,d[2]||1,d[3]||0,d[4]||0,d[5]||0,d[6]||0);100>d[0]&&n.setFullYear(d[0]||1970);var m=0,q=d[7]&&d[7].charAt(0);"Z"!=q&&(m=60*(d[8]||0)+(Number(d[9])||0),"-"!=q&&(m*=-1));q&&(m-=n.getTimezoneOffset());m&&n.setTime(n.getTime()+6E4*m)}return n};f.toISOString=function(f,
k){var d=function(c){return 10>c?"0"+c:c};k=k||{};var p=[],m=k.zulu?"getUTC":"get",q="";"time"!=k.selector&&(q=f[m+"FullYear"](),q=["0000".substr((q+"").length)+q,d(f[m+"Month"]()+1),d(f[m+"Date"]())].join("-"));p.push(q);if("date"!=k.selector){q=[d(f[m+"Hours"]()),d(f[m+"Minutes"]()),d(f[m+"Seconds"]())].join(":");m=f[m+"Milliseconds"]();k.milliseconds&&(q+="."+(100>m?"0":"")+d(m));if(k.zulu)q+="Z";else if("time"!=k.selector)var m=f.getTimezoneOffset(),u=Math.abs(m),q=q+((0<m?"-":"+")+d(Math.floor(u/
60))+":"+d(u%60));p.push(q)}return p.join("T")};return f})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(n,k,f,r,p,d){return n([d,p],{_onMap:function(d){var m=this.constructor._onMap,f;m&&m.FINAL||(delete this.constructor._onMap,m=this.registerConnectEvents(),m.FINAL=!0);d=d.toLowerCase();m[d]?f=this[m[d].method]:(d=this._onCamelCase(d),this[d]&&(f=d));return f},on:function(d,m){var f=this._onMap(d),
k=d.replace(/\-/g,""),c="on"+k in this.domNode;return f||!c?this.inherited(arguments):this.own(r(this.domNode,k,m))[0]},emit:function(d,m,f){var q,c,b,g=d.toLowerCase(),x=this.constructor._onMap||this.registerConnectEvents();c=this[this._onMap(g)];m=m||{};m.target||(m.target=this);c&&x&&x[g]&&(this._onObj2Arr(function(){q=Array.prototype.slice.call(arguments)},x[g].argKeys)(m),b=k.mixin({},arguments),b[2]=q,b[0]=x[g].name.replace(/^on/,""));return this.inherited(b||arguments)}})})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ./Task ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/jsonUtils".split(" "),
function(n,k,f,r,p,d,w,m,q,u,c,b,g,x,h){n=n(u,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"densify-complete":["geometries"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],
"offset-complete":["geometries"],"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(a){a=k.hitch;this._projectHandler=a(this,this._projectHandler);this._simplifyHandler=a(this,this._simplifyHandler);this._bufferHandler=a(this,this._bufferHandler);this._areasAndLengthsHandler=a(this,this._areasAndLengthsHandler);this._lengthsHandler=
a(this,this._lengthsHandler);this._labelPointsHandler=a(this,this._labelPointsHandler);this._relationHandler=a(this,this._relationHandler);this._convexHullHandler=a(this,this._convexHullHandler);this._unionHandler=a(this,this._unionHandler);this._autoCompleteHandler=a(this,this._autoCompleteHandler);this._reshapeHandler=a(this,this._reshapeHandler);this._cutHandler=a(this,this._cutHandler);this._intersectHandler=a(this,this._intersectHandler);this._differenceHandler=a(this,this._differenceHandler);
this._trimExtendHandler=a(this,this._trimExtendHandler);this._densifyHandler=a(this,this._densifyHandler);this._generalizeHandler=a(this,this._densifyHandler);this._offsetHandler=a(this,this._offsetHandler);this._distanceHandler=a(this,this._distanceHandler);this._toGeoCoordinateHandler=a(this,this._toGeoCoordinateHandler);this._fromGeoCoordinateHandler=a(this,this._fromGeoCoordinateHandler);this.registerConnectEvents()},_encodeGeometries:function(a){var b=[],c,d=a.length;for(c=0;c<d;c++)b.push(a[c].toJson());
return{geometryType:h.getJsonType(a[0]),geometries:b}},_decodeGeometries:function(a,b,c){var e=h.getGeometryType(b);a=a.geometries;var d=[],g={spatialReference:c.toJson()},l=k.mixin;f.forEach(a,function(a,b){d[b]=new e(l(a,g))});return d},_toProjectGeometry:function(a){var e=a.spatialReference.toJson();return a instanceof c?new g({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:e}):new b({paths:[[].concat(a.points)],spatialReference:e})},
_fromProjectedGeometry:function(a,b,d){return"esriGeometryEnvelope"===b?(a=a.rings[0],new c(a[0][0],a[0][1],a[2][0],a[2][1],d)):new x({points:a.paths[0],spatialReference:d.toJson()})},project:function(a,b,c,d){var e=k.mixin({},this._url.query,{f:"json"}),g;a.geometries?(d=c,c=b,b=a.outSR,g=a.geometries[0],e=k.mixin(e,a.toJson())):(g=a[0],e=k.mixin(e,{outSR:b.wkid||r.toJson(b.toJson()),inSR:g.spatialReference.wkid||r.toJson(g.spatialReference.toJson()),geometries:r.toJson(this._encodeGeometries(a))}));
var l=h.getJsonType(g),t=this._projectHandler,v=this._errorHandler,f=new p(q._dfdCanceller);f._pendingDfd=m({url:this._url.path+"/project",content:e,callbackParamName:"callback",load:function(a,e){t(a,e,l,b,c,d,f)},error:function(a){v(a,d,f)}});return f},_projectHandler:function(a,b,c,d,g,h,f){try{var e=this._decodeGeometries(a,c,d);this._successHandler([e],"onProjectComplete",g,f)}catch(C){this._errorHandler(C,h,f)}},onProjectComplete:function(){},simplify:function(a,b,c){var e=a[0].spatialReference,
d=k.mixin({},this._url.query,{f:"json",sr:e.wkid?e.wkid:r.toJson(e.toJson()),geometries:r.toJson(this._encodeGeometries(a))}),g=h.getJsonType(a[0]),l=this._simplifyHandler,t=this._errorHandler,f=new p(q._dfdCanceller);f._pendingDfd=m({url:this._url.path+"/simplify",content:d,callbackParamName:"callback",load:function(a,d){l(a,d,g,e,b,c,f)},error:function(a){t(a,c,f)}});return f},_simplifyHandler:function(a,b,c,d,g,h,f){try{var e=this._decodeGeometries(a,c,d);this._successHandler([e],"onSimplifyComplete",
g,f)}catch(C){this._errorHandler(C,h,f)}},onSimplifyComplete:function(){},convexHull:function(a,b,c){var e=a[0].spatialReference;a=k.mixin({},this._url.query,{f:"json",sr:r.toJson(e.toJson()),geometries:r.toJson(this._encodeGeometries(a))});var d=this._convexHullHandler,g=this._errorHandler,l=new p(q._dfdCanceller);l._pendingDfd=m({url:this._url.path+"/convexHull",content:a,callbackParamName:"callback",load:function(a,g){d(a,g,e,b,c,l)},error:function(a){g(a,c,l)}});return l},_convexHullHandler:function(a,
b,c,d,g,f){try{var e=h.fromJson(a.geometry).setSpatialReference(c);this._successHandler([e],"onConvexHullComplete",d,f)}catch(t){this._errorHandler(t,g,f)}},onConvexHullComplete:function(){},union:function(a,b,c){var e=a[0].spatialReference;a=k.mixin({},this._url.query,{f:"json",sr:r.toJson(e.toJson()),geometries:r.toJson(this._encodeGeometries(a))});var d=this._unionHandler,g=this._errorHandler,l=new p(q._dfdCanceller);l._pendingDfd=m({url:this._url.path+"/union",content:a,callbackParamName:"callback",
load:function(a,g){d(a,g,e,b,c,l)},error:function(a){g(a,c,l)}});return l},_unionHandler:function(a,b,c,d,g,f){try{var e=h.fromJson(a.geometry).setSpatialReference(c);this._successHandler([e],"onUnionComplete",d,f)}catch(t){this._errorHandler(t,g,f)}},onUnionComplete:function(){},autoComplete:function(a,b,c,d){var e=a[0].spatialReference;a=k.mixin({},this._url.query,{f:"json",sr:r.toJson(e.toJson()),polygons:r.toJson(this._encodeGeometries(a).geometries),polylines:r.toJson(this._encodeGeometries(b).geometries)});
var g=this._autoCompleteHandler,l=this._errorHandler,h=new p(q._dfdCanceller);h._pendingDfd=m({url:this._url.path+"/autoComplete",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,e,c,d,h)},error:function(a){l(a,d,h)}});return h},_autoCompleteHandler:function(a,b,c,d,h,f){try{var e=a.geometries;a=[];var l,m=e.length;for(l=0;l<m;l++)a[l]=new g({spatialReference:c,rings:e[l].rings});this._successHandler([a],"onAutoCompleteComplete",d,f)}catch(D){this._errorHandler(D,h,f)}},onAutoCompleteComplete:function(){},
reshape:function(a,b,c,d){var e=a.spatialReference;a=k.mixin({},this._url.query,{f:"json",sr:r.toJson(e.toJson()),target:r.toJson({geometryType:h.getJsonType(a),geometry:a.toJson()}),reshaper:r.toJson(b.toJson())});var g=this._reshapeHandler,l=this._errorHandler,f=new p(q._dfdCanceller);f._pendingDfd=m({url:this._url.path+"/reshape",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,e,c,d,f)},error:function(a){l(a,d,f)}});return f},_reshapeHandler:function(a,b,c,d,g,f){try{var e=h.fromJson(a.geometry).setSpatialReference(c);
this._successHandler([e],"onReshapeComplete",d,f)}catch(t){this._errorHandler(t,g,f)}},onReshapeComplete:function(){},cut:function(a,b,c,d){var e=a[0].spatialReference,g=f.map(a,function(a){return a.toJson()});a=k.mixin({},this._url.query,{f:"json",sr:r.toJson(e.toJson()),target:r.toJson({geometryType:h.getJsonType(a[0]),geometries:g}),cutter:r.toJson(b.toJson())});var l=this._cutHandler,t=this._errorHandler,v=new p(q._dfdCanceller);v._pendingDfd=m({url:this._url.path+"/cut",content:a,callbackParamName:"callback",
load:function(a,b){l(a,b,e,c,d,v)},error:function(a){t(a,d,v)}});return v},_cutHandler:function(a,b,c,d,g,m){try{var e=a.geometries,l={};l.cutIndexes=a.cutIndexes;l.geometries=[];f.forEach(e,function(a){l.geometries.push(h.fromJson(a).setSpatialReference(c))});this._successHandler([l],"onCutComplete",d,m)}catch(C){this._errorHandler(C,g,m)}},onCutComplete:function(){},intersect:function(a,b,c,d){var e=a[0].spatialReference;a=k.mixin({},this._url.query,{f:"json",sr:r.toJson(e.toJson()),geometries:r.toJson(this._encodeGeometries(a)),
geometry:r.toJson({geometryType:h.getJsonType(b),geometry:b.toJson()})});var g=this._intersectHandler,l=this._errorHandler,f=new p(q._dfdCanceller);f._pendingDfd=m({url:this._url.path+"/intersect",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,e,c,d,f)},error:function(a){l(a,d,f)}});return f},_intersectHandler:function(a,b,c,d,g,m){try{var e=[];f.forEach(a.geometries,function(a){e.push(h.fromJson(a).setSpatialReference(c))});this._successHandler([e],"onIntersectComplete",d,m)}catch(t){this._errorHandler(t,
g,m)}},onIntersectComplete:function(){},difference:function(a,b,c,d){var e=a[0].spatialReference;a=k.mixin({},this._url.query,{f:"json",sr:r.toJson(e.toJson()),geometries:r.toJson(this._encodeGeometries(a)),geometry:r.toJson({geometryType:h.getJsonType(b),geometry:b.toJson()})});var g=this._differenceHandler,l=this._errorHandler,f=new p(q._dfdCanceller);f._pendingDfd=m({url:this._url.path+"/difference",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,e,c,d,f)},error:function(a){l(a,
d,f)}});return f},_differenceHandler:function(a,b,c,d,g,m){try{var e=[];f.forEach(a.geometries,function(a){e.push(h.fromJson(a).setSpatialReference(c))});this._successHandler([e],"onDifferenceComplete",d,m)}catch(t){this._errorHandler(t,g,m)}},onDifferenceComplete:function(){},buffer:function(a,b,c){var e=k.mixin({},this._url.query,{f:"json"},a.toJson()),d=a.outSpatialReference||a.geometries[0].spatialReference,g=this._bufferHandler,l=this._errorHandler,h=new p(q._dfdCanceller);h._pendingDfd=m({url:this._url.path+
"/buffer",content:e,callbackParamName:"callback",load:function(a,e){g(a,e,d,b,c,h)},error:function(a){l(a,c,h)}});return h},_bufferHandler:function(a,b,c,d,h,f){try{var e=a.geometries;a=[];var l,m=e.length;for(l=0;l<m;l++)a[l]=new g({spatialReference:c,rings:e[l].rings});this._successHandler([a],"onBufferComplete",d,f)}catch(D){this._errorHandler(D,h,f)}},onBufferComplete:function(){},areasAndLengths:function(a,b,c){a=k.mixin({},this._url.query,{f:"json"},a.toJson());var e=this._areasAndLengthsHandler,
d=this._errorHandler,g=new p(q._dfdCanceller);g._pendingDfd=m({url:this._url.path+"/areasAndLengths",content:a,callbackParamName:"callback",load:function(a,d){e(a,d,b,c,g)},error:function(a){d(a,c,g)}});return g},_areasAndLengthsHandler:function(a,b,c,d,g){try{this._successHandler([a],"onAreasAndLengthsComplete",c,g)}catch(A){this._errorHandler(A,d,g)}},onAreasAndLengthsComplete:function(){},lengths:function(a,b,c){a=k.mixin({},this._url.query,{f:"json"},a.toJson());var e=this._lengthsHandler,d=this._errorHandler,
g=new p(q._dfdCanceller);g._pendingDfd=m({url:this._url.path+"/lengths",content:a,callbackParamName:"callback",load:function(a,d){e(a,d,b,c,g)},error:function(a){d(a,c,g)}});return g},_lengthsHandler:function(a,b,c,d,g){try{this._successHandler([a],"onLengthsComplete",c,g)}catch(A){this._errorHandler(A,d,g)}},onLengthsComplete:function(){},labelPoints:function(a,b,c){var e=f.map(a,function(a){return a.toJson()}),d=a[0].spatialReference,e=k.mixin({},this._url.query,{f:"json",sr:d.wkid?d.wkid:r.toJson(d.toJson()),
polygons:r.toJson(e)}),g=this._labelPointsHandler,l=this._errorHandler,h=new p(q._dfdCanceller);h._pendingDfd=m({url:this._url.path+"/labelPoints",content:e,callbackParamName:"callback",load:function(e,l){g(e,l,a,d,b,c,h)},error:function(a){l(a,c,h)}});return h},_labelPointsHandler:function(a,b,c,d,g,m,k){try{var e=[];f.forEach(a.labelPoints,function(a){e.push(h.fromJson(a).setSpatialReference(d))});this._successHandler([e],"onLabelPointsComplete",g,k)}catch(C){this._errorHandler(C,m,k)}},onLabelPointsComplete:function(){},
relation:function(a,b,c){a=k.mixin({},this._url.query,{f:"json"},a.toJson());var e=this._relationHandler,d=this._errorHandler,g=new p(q._dfdCanceller);g._pendingDfd=m({url:this._url.path+"/relation",content:a,callbackParamName:"callback",load:function(a,d){e(a,d,b,c,g)},error:function(a){d(a,c,g)}});return g},_relationHandler:function(a,b,c,d,g){try{this._successHandler([a.relations],"onRelationComplete",c,g)}catch(A){this._errorHandler(A,d,g)}},onRelationComplete:function(){},trimExtend:function(a,
b,c){var e=k.mixin({},this._url.query,{f:"json"},a.toJson()),d=a.sr,g=this._trimExtendHandler,l=this._errorHandler,h=new p(q._dfdCanceller);h._pendingDfd=m({url:this._url.path+"/trimExtend",content:e,callbackParamName:"callback",load:function(a,e){g(a,e,d,b,c,h)},error:function(a){l(a,c,h)}});return h},_trimExtendHandler:function(a,e,c,d,g,h){try{var l=a.geometries;a=[];var f,m=l.length;for(f=0;f<m;f++)a[f]=new b({spatialReference:c,paths:l[f].paths});this._successHandler([a],"onTrimExtendComplete",
d,h)}catch(D){this._errorHandler(D,g,h)}},onTrimExtendComplete:function(){},densify:function(a,b,c){var e=k.mixin({},this._url.query,{f:"json"},a.toJson()),d=a.geometries[0].spatialReference,g=this._densifyHandler,h=this._errorHandler,l=new p(q._dfdCanceller);l._pendingDfd=m({url:this._url.path+"/densify",content:e,callbackParamName:"callback",load:function(a,e){g(a,e,d,b,c,l)},error:function(a){h(a,c,l)}});return l},_densifyHandler:function(a,b,c,d,g,m){try{var e=[];f.forEach(a.geometries,function(a){e.push(h.fromJson(a).setSpatialReference(c))});
this._successHandler([e],"onDensifyComplete",d,m)}catch(t){this._errorHandler(t,g,m)}},onDensifyComplete:function(){},generalize:function(a,b,c){var e=k.mixin({},this._url.query,{f:"json"},a.toJson()),d=a.geometries[0].spatialReference,g=this._generalizeHandler,h=this._errorHandler,l=new p(q._dfdCanceller);l._pendingDfd=m({url:this._url.path+"/generalize",content:e,callbackParamName:"callback",load:function(a,e){g(a,e,d,b,c,l)},error:function(a){h(a,c,l)}});return l},_generalizeHandler:function(a,
b,c,d,g,m){try{var e=[];f.forEach(a.geometries,function(a){e.push(h.fromJson(a).setSpatialReference(c))});this._successHandler([e],"onGeneralizeComplete",d,m)}catch(t){this._errorHandler(t,g,m)}},onGeneralizeComplete:function(){},offset:function(a,b,c){var e=k.mixin({},this._url.query,{f:"json"},a.toJson()),d=a.geometries[0].spatialReference,g=this._offsetHandler,h=this._errorHandler,l=new p(q._dfdCanceller);l._pendingDfd=m({url:this._url.path+"/offset",content:e,callbackParamName:"callback",load:function(a,
e){g(a,e,d,b,c,l)},error:function(a){h(a,c,l)}});return l},_offsetHandler:function(a,b,c,d,g,m){try{var e=[];f.forEach(a.geometries,function(a){e.push(h.fromJson(a).setSpatialReference(c))});this._successHandler([e],"onOffsetComplete",d,m)}catch(t){this._errorHandler(t,g,m)}},onOffsetComplete:function(){},distance:function(a,b,c){var e=k.mixin({},this._url.query,{f:"json"},a.toJson()),d=a.geometry1.spatialReference,g=this._distanceHandler,h=this._errorHandler,l=new p(q._dfdCanceller);l._pendingDfd=
m({url:this._url.path+"/distance",content:e,callbackParamName:"callback",load:function(a,e){g(a,e,d,b,c,l)},error:function(a){h(a,c,l)}});return l},_distanceHandler:function(a,b,c,d,g,h){try{a=a&&a.distance,this._successHandler([a],"onDistanceComplete",d,h)}catch(y){this._errorHandler(y,g,h)}},onDistanceComplete:function(){},toGeoCoordinateString:function(a,b,c){var e={};k.isObject(a.sr)?e.sr=a.sr.wkid||r.toJson(a.sr.toJson()):e.sr=a.sr;e.coordinates=r.toJson(a.coordinates);e.conversionType=a.conversionType||
"MGRS";e.conversionMode=a.conversionMode;e.numOfDigits=a.numOfDigits;e.rounding=a.rounding;e.addSpaces=a.addSpaces;a=k.mixin({},this._url.query,{f:"json"},e);var d=this._toGeoCoordinateHandler,g=this._errorHandler,h=new p(q._dfdCanceller);h._pendingDfd=m({url:this._url.path+"/toGeoCoordinateString",content:a,callbackParamName:"callback",load:function(a,e){d(a,e,b,c,h)},error:function(a){g(a,c,h)}});return h},_toGeoCoordinateHandler:function(a,b,c,d,g){try{this._successHandler([a.strings],"onToGeoCoordinateStringComplete",
c,g)}catch(A){this._errorHandler(A,d,g)}},onToGeoCoordinateStringComplete:function(){},fromGeoCoordinateString:function(a,b,c){var e={};k.isObject(a.sr)?e.sr=a.sr.wkid||r.toJson(a.sr.toJson()):e.sr=a.sr;e.strings=r.toJson(a.strings);e.conversionType=a.conversionType||"MGRS";e.conversionMode=a.conversionMode;a=k.mixin({},this._url.query,{f:"json"},e);var d=this._fromGeoCoordinateHandler,g=this._errorHandler,h=new p(q._dfdCanceller);h._pendingDfd=m({url:this._url.path+"/fromGeoCoordinateString",content:a,
callbackParamName:"callback",load:function(a,e){d(a,e,b,c,h)},error:function(a){g(a,c,h)}});return h},_fromGeoCoordinateHandler:function(a,b,c,d,g){try{this._successHandler([a.coordinates],"onToGeoCoordinateStringComplete",c,g)}catch(A){this._errorHandler(A,d,g)}},onFromGeoCoordinateStringComplete:function(){}});k.mixin(n,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});d("extend-esri")&&k.setObject("tasks.GeometryService",n,w);return n})},"esri/layers/FeatureLayer":function(){define("require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/sniff dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/promise/all ../kernel ../lang ../request ../config ../deferredUtils ../SpatialReference ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../renderers/arcadeUtils ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./FeatureType ./FeatureTemplate ./FeatureEditResult ./LabelClass ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./TrackManager ./HeatmapManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),
function(n,k,f,r,p,d,w,m,q,u,c,b,g,x,h,a,e,l,v,z,A,y,t,C,D,M,Q,ha,ra,K,R,S,da,aa,ia,X,H,F,L,I,T,V,O,Z,N,ea,fa,ja,ka,ba,ga){var la=v.defaults,G=f(F,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reHostedFS:/(https?:)?\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4E3,maxRecordCountForAuto:2E3,maxVertexCountForAuto:25E4,generalizeForScale:4E3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],
"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(a,b){this._preventInit||this._initFeatureLayer(a,b)},_initFeatureLayer:function(a,b){this.i18n=ga;b=b||{};this.showLabels=
null!=b.showLabels?b.showLabels:!0;this._outFields=b.outFields;this._defnExpr=b.definitionExpression;this._loadCallback=b.loadCallback;var c=b._usePatch;this._usePatch=null===c||void 0===c?!0:c;this._trackIdField=b.trackIdField;this.objectIdField=b.objectIdField;this._maxOffset=null!=b.maxAllowableOffset?b.maxAllowableOffset:this.maxAllowableOffset;this.quantize=null!=b.quantize?b.quantize:!0;this._optEditable=b.editable;this._optAutoGen=b.autoGeneralize;this.editSummaryCallback=b.editSummaryCallback;
this.userId=b.userId;this.userIsAdmin=b.userIsAdmin;this.useMapTime=b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0;this.source=b.source;this.gdbVersion=b.gdbVersion;this.orderByFields=b.orderByFields;this.maxPointCountForAuto=null!=b.maxPointCountForAuto?b.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=b.maxRecordCountForAuto?b.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=b.maxVertexCountForAuto?b.maxVertexCountForAuto:this.maxVertexCountForAuto;
this.generalizeForScale=null!=b.generalizeForScale?b.generalizeForScale:this.generalizeForScale;this.queryPagination=null!=b.queryPagination?b.queryPagination:this.url?this.reHostedFS.test(this.url):!1;this.multipatchOption=b.multipatchOption;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var d=G,c=this.mode=e.isDefined(b.mode)?b.mode:d.MODE_ONDEMAND;this._isStream&&(this.mode=c=d.MODE_STREAM);switch(c){case d.MODE_SNAPSHOT:this.currentMode=
d.MODE_SNAPSHOT;this._mode=new N(this);this._isSnapshot=!0;break;case d.MODE_ONDEMAND:case d.MODE_AUTO:this.currentMode=d.MODE_ONDEMAND;this._tileWidth=b.tileWidth||512;this._tileHeight=b.tileHeight||512;this._mode=new ea(this);this.latticeTiling=b.latticeTiling;break;case d.MODE_SELECTION:this.currentMode=d.MODE_SELECTION;this._mode=new fa(this);this._isSelOnly=!0;break;case d.MODE_STREAM:this.currentMode=d.MODE_STREAM,this._mode=new ja(this),this._isStream=!0}this._initLayer=p.hitch(this,this._initLayer);
this._selectHandler=p.hitch(this,this._selectHandler);this._editable=!1;if(p.isObject(a)&&a.layerDefinition)return this._collection=!0,this.mode=this._isStream?d.MODE_STREAM:d.MODE_SNAPSHOT,this._isStream||this._outFields||(this._outFields=["*"]),this._initLayer(a),this;this._task=new K(this.url,{source:this.source,gdbVersion:this.gdbVersion});c=this._url.path;this._fserver=!1;-1!==c.search(/\/FeatureServer\//i)&&(this._fserver=!0);this.mode===d.MODE_AUTO&&this.reHostedFS.test(this.url)&&this._queryLimit();
(d=b.resourceInfo)?this._initLayer(d):(this.source&&(d={source:this.source.toJson()},this._url.query=p.mixin(this._url.query,{layer:w.toJson(d)})),this.gdbVersion&&(this._url.query=p.mixin(this._url.query,{gdbVersion:this.gdbVersion})),l({url:c,content:p.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler}));this.registerConnectEvents()},_initLayer:function(a,b){if(a||b){this._json=a;this._findCredential();if(this.credential&&this.credential.ssl||
a&&a._ssl)this._useSSL(),this._task._useSSL();this.version=a.currentVersion;this.version||(this.version="capabilities"in a||"drawingInfo"in a||"hasAttachments"in a||"htmlPopupType"in a||"relationships"in a||"timeInfo"in a||"typeIdField"in a||"types"in a?10:9.3);this._collection&&(this._isStream||(this.currentMode=G.MODE_SNAPSHOT,this._mode=new N(this)),this._isSnapshot=!0,this._featureSet=a.featureSet,this._nextId=a.nextObjectId,a=a.layerDefinition);this.geometryType=a.geometryType;"string"!==typeof this.multipatchOption&&
"esriGeometryMultiPatch"===this.geometryType&&(this.multipatchOption="xyFootprint");if(a.hasOwnProperty("capabilities")){var c=this.capabilities=a.capabilities;c&&-1!==c.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||(this._editable=this._fserver);e.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):"esriGeometryMultiPatch"===this.geometryType&&(this._editable=!1);this._json=w.toJson(this._json);this.isEditable()?this._setMaxOffset(null):
this.mode===G.MODE_SNAPSHOT||"esriGeometryPolyline"!==this.geometryType&&"esriGeometryPolygon"!==this.geometryType&&!this.hasXYFootprint()||(this._autoGeneralize=e.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===G.MODE_ONDEMAND||this.mode===G.MODE_AUTO,delete this._optAutoGen);var c=a.effectiveMinScale||a.minScale,g=a.effectiveMaxScale||a.maxScale;!this._hasMin&&c&&this.setMinScale(c);!this._hasMax&&g&&this.setMaxScale(g);this.layerId=a.id;this.name=a.name;this.description=a.description;
this.copyright=a.copyrightText;this.type=a.type;this.displayField=a.displayField;this.defaultDefinitionExpression=a.definitionExpression||(a.isView?a.viewDefinitionQuery:a.definitionQuery);this.fullExtent=new aa(a.extent);this.initialExtent=new aa(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new A(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=a.defaultVisibility;if("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=
!1;this.hasM=a.hasM||!1;this.hasZ=a.hasZ||!1;this.indexedFields=a.indexedFields;this.maxRecordCount=a.maxRecordCount;this.canModifyLayer=a.canModifyLayer;this.supportsStatistics=a.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:a.supportsAdvancedQueries;this.supportsCalculate=a.supportsCalculate;this.supportsAttachmentsByUploadId=a.supportsAttachmentsByUploadId;this.supportsCoordinatesQuantization=a.supportsCoordinatesQuantization;this.quantize=this.quantize&&this.supportsCoordinatesQuantization;
this.hasLabels=a.hasLabels;this.canScaleSymbols=a.canScaleSymbols;this.supportsRollbackOnFailureParameter=this.supportsRollbackOnFailure=a.supportsRollbackOnFailure;this.syncCanReturnChanges=a.syncCanReturnChanges;this.isDataVersioned=a.isDataVersioned;this.editFieldsInfo=a.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=a.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=
a.relationships;this.allowGeometryUpdates=e.isDefined(a.allowGeometryUpdates)?a.allowGeometryUpdates:!0;this.allowUpdateWithoutMValues=!!a.allowUpdateWithoutMValues;this.advancedQueryCapabilities=a.advancedQueryCapabilities||{supportsStatistics:this.supportsStatistics,supportsOrderBy:this.supportsAdvancedQueries,supportsDistinct:this.supportsAdvancedQueries};this.useStandardizedQueries=a.useStandardizedQueries;this.tileMaxRecordCount=a.tileMaxRecordCount;this.standardMaxRecordCount=a.standardMaxRecordCount;
this._setMaxOffset(this._maxOffset,!0);this._isTable="Table"===this.type;for(var B=this.fields=[],g=a.fields,c=0;c<g.length;c++)B.push(new L(g[c]));if(!this.objectIdField){this.objectIdField=a.objectIdField;if(!this.objectIdField)for(g=a.fields,c=0;c<g.length;c++)if(B=g[c],"esriFieldTypeOID"===B.type){this.objectIdField=B.name;break}this.objectIdField||this._isStream||console.debug("esri.layers.FeatureLayer: "+e.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!e.isDefined(this._nextId)){g=
this.objectIdField;B=-1;if(this._collection&&g)for(var h=(c=this._featureSet)&&c.features,P=h?h.length:0,l,c=0;c<P;c++)l=(l=h[c].attributes)&&l[g],l>B&&(B=l);this._nextId=B+1}this.globalIdField=a.globalIdField;if(c=this.typeIdField=a.typeIdField)if(c=!this._getField(c)&&this._getField(c,!0))this.typeIdField=c.name;this.visibilityField=a.visibilityField;if(g=a.defaultSymbol)this.defaultSymbol=D.fromJson(g);var f=this.types=[],m=a.types,k,q,B=(c=this.editFieldsInfo)&&c.creatorField,h=c&&c.editorField;
l=B||h;P=[];if(m)for(c=0;c<m.length;c++)k=new T(m[c]),q=k.templates,l&&q&&q.length&&(P=P.concat(q)),f.push(k);m=a.templates;k=this.templates=[];if(m)for(c=0;c<m.length;c++)f=new V(m[c]),l&&P.push(f),k.push(f);for(c=0;c<P.length;c++)if(l=p.getObject("prototype.attributes",!1,P[c]))B&&delete l[B],h&&delete l[h];if(c=a.timeInfo)this.timeInfo=new I(c),this._startTimeField=c.startTimeField,this._endTimeField=c.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?
c.trackIdField=this._trackIdField:this._trackIdField=c.trackIdField;this.hasAttachments=!this._collection&&a.hasAttachments?!0:!1;this.htmlPopupType=a.htmlPopupType;var c=a.drawingInfo,x;(B=c&&c.labelingInfo)&&!this.labelingInfo&&(this.labelingInfo=d.map(B,function(a){return new Z(a)}),this._fixLabelExpr());if(!this.renderer)if(c&&c.renderer){if(x=c.renderer,this.setRenderer(ha.fromJson(x)),"classBreaks"===x.type&&this.renderer.setMaxInclusive(!0),!this._collection){var v=x.type,g=[];x=this.renderer;
switch(v){case "simple":g.push(x.symbol);break;case "uniqueValue":case "classBreaks":g.push(x.defaultSymbol),g=g.concat(d.map(x.infos,function(a){return a.symbol}))}var g=d.filter(g,e.isDefined),n=this._url.path+"/images/",r=this._getToken();d.forEach(g,function(a){var b=a.url;b&&(-1===b.search(/https?\:/)&&-1===b.indexOf("data:")&&(a.url=n+b),r&&-1!==a.url.search(/https?\:/)&&(a.url+="?token\x3d"+r))})}}else if(g)m=this.types,0<m.length?(x=new Q(this.defaultSymbol,this.typeIdField),d.forEach(m,function(a){x.addValue(a.id,
a.symbol)})):x=new M(this.defaultSymbol),this.setRenderer(x);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":v=new y;break;case "esriGeometryPolyline":v=new t;break;case "esriGeometryPolygon":v=new C;break;default:this.hasXYFootprint()&&(v=new C)}this.setRenderer(v?new M(v):null)}v=c&&c.transparency||0;!this.hasOwnProperty("opacity")&&0<v&&(this.opacity=1-v/100);(u("ie")||7<=u("trident")||u("safari"))&&this.isEditable()&&10.02>this.version&&
(this._ts=!0);this.statistics=a.statistics;this._fixRendererFields();this._updateRequiredFieldsFromLabelingInfo();this._checkFields();this._updateCaps();var z=function(){this.currentMode!==G.MODE_SNAPSHOT&&(this.queryPagination=!1);null==this._maxOffset||this._isFractionalOffsetAllowed()||this._setMaxOffset(this._maxOffset);this.loaded=!0;this.onLoad(this);var a=this._loadCallback;a&&(delete this._loadCallback,a(this))};this._collection?(v=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new S(v)),
this._fcAdded=!0,z.call(this)):this._forceIdentity(this._limitPromise?function(){var a=this;this._limitPromise.then(function(b){a._checkMode(b)});this._limitPromise.always(function(){a._limitPromise=null;z.call(a)})}:z)}},setShowLabels:function(a){this.showLabels=a;this.onShowLabelsChange()},onShowLabelsChange:function(){},onRendererChange:function(a){this.inherited(arguments);var b=this._map;this._ager=!!(a&&a.observationAger&&a.observationRenderer);a&&"colors"in a&&"blurRadius"in a&&"maxPixelIntensity"in
a?"esriGeometryPoint"==this.geometryType&&!this._heatmapManager&&b&&(this._heatmapManager=new ba(this),this._heatmapManager.initialize(b)):this.renderer&&this.renderer.getRendererInfo?d.some(this.renderer.rendererInfos,function(a){return a.renderer&&"colors"in a.renderer&&"blurRadius"in a.renderer})||(this._heatmapManager=null):this._heatmapManager=null;this.timeInfo&&b&&(a&&(a.latestObservationRenderer||a.trackRenderer)?this._trackManager||(this._trackManager=new ka(this),this._trackManager.initialize(b),
this._childLayer=this._trackManager.container,this._mode._applyTimeFilter()):this._trackManager&&!this._isStream&&(this._trackManager.destroy(),this._trackManager=null));if(a){var c=[],b=d.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],e.isDefined),g=function(a){return null!=a&&"function"!=typeof a&&a};d.forEach(b,function(a){var b=g(a.attributeField),e=g(a.attributeField2);a=g(a.attributeField3);!1!==b&&c.push(b);!1!==e&&c.push(e);!1!==a&&c.push(a)});this._requiredFields=
c}else this._requiredFields=[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._requiredFields),this._collection&&(this._typesDirty=!0))},redraw:function(){this.inherited(arguments);this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(){this.inherited(arguments);var a=this._getRenderer();this._ager=!!(a&&a.observationAger&&a.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(a&&
a.trackRenderer)},_setMap:function(a){var b=this.inherited(arguments),c=this._mode,e=this;c&&c.initialize(a);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());this._addHandle=this.on("graphic-node-add",function(a){a=a.graphic.attributes;(a=e._selectedFeatures[a&&a[e.objectIdField]])&&a.attr("data-selected","")});return b},_unsetMap:function(a){var b=this._mode;b&&b.suspend();this._trackManager&&(this._trackManager.destroy(),this._trackManager=
null);r.disconnect(this._zoomConnect);r.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this._toggleTime(!1);this.inherited("_unsetMap",arguments)},refresh:function(){this._needsRefresh=!1;var a=this._mode;a&&a.refresh()},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},getOutFields:function(){return d.filter(this._getOutFields(),function(a){return"*"===a||!!this._getField(a)},this)},getField:function(a){return this._getField(a,
!0)},getFieldLabel:function(a){var b=this.infoTemplate,b=b&&b.getFieldInfo&&b.getFieldInfo(a);a=p.isFunction(a)?null:this.getField(a);var c=b||a,e="";c&&(e=b&&b.label||a&&a.alias||c.name||c.fieldName);return e},getDomain:function(a,b){var c,e,g=b&&b.feature,B=g&&this.typeIdField&&g.attributes&&g.attributes[this.typeIdField];null!=B&&d.some(this.types,function(b){return b.id==B?((c=b.domains&&b.domains[a])&&"inherited"===c.type&&(c=this._getLayerDomain(a),e=!0),!0):!1},this);e||c||(c=this._getLayerDomain(a));
return c},_getLayerDomain:function(a){var b;d.some(this.fields,function(c){c.name===a&&(b=c.domain);return!!b});return b},getType:function(a){var b,c=a&&this.typeIdField&&a.attributes&&a.attributes[this.typeIdField];d.some(this.types,function(a){a.id==c&&(b=a);return!!b});return b},setEditable:function(a){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(!this.loaded)return this._optEditable=a,this;
var b=this._editable;this._editable=a;this._updateCaps();if(b!==a)this.onCapabilitiesChange();return this},getEditCapabilities:function(a){var b={canCreate:!1,canUpdate:!1,canDelete:!1};if(!this.loaded||!this.isEditable())return b;var c=a&&a.feature;a=a&&a.userId||this.getUserId();var e=d.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],p.trim),g=(b=-1<d.indexOf(e,"editing"))&&-1<d.indexOf(e,"create"),B=b&&-1<d.indexOf(e,"update"),e=b&&-1<d.indexOf(e,"delete"),h=this.ownershipBasedAccessControlForFeatures,
l=this.editFieldsInfo,f=l&&l.creatorField,l=l&&l.realm,c=(c=c&&c.attributes)&&f?c[f]:void 0,m=!!this.userIsAdmin,f=!h||m||!(!h.allowOthersToUpdate&&!h.allowUpdateToOthers),k=!h||m||!(!h.allowOthersToDelete&&!h.allowDeleteToOthers),q=!h||m||!h.hasOwnProperty("allowAnonymousToUpdate")||h.allowAnonymousToUpdate,h=!h||m||!h.hasOwnProperty("allowAnonymousToDelete")||h.allowAnonymousToDelete;a&&l&&(a=a+"@"+l);if(m||b&&!(g||B||e))g=B=e=!0;b={canCreate:g,canUpdate:B,canDelete:e};a||(b.canUpdate=b.canUpdate&&
q,b.canDelete=b.canDelete&&h);null===c?(b.canUpdate=b.canUpdate&&f,b.canDelete=b.canDelete&&k):""!==c&&c&&a.toLowerCase()!==c.toLowerCase()&&(b.canUpdate=b.canUpdate&&f,b.canDelete=b.canDelete&&k);return b},getUserId:function(){var a;this.loaded&&(a=this.credential&&this.credential.userId||this.userId||"");return a},setUserIsAdmin:function(a){this.userIsAdmin=a},setEditSummaryCallback:function(a){this.editSummaryCallback=a},getEditSummary:function(a,b,c){c=e.isDefined(c)?c:(new Date).getTime();var d=
"";c=this.getEditInfo(a,b,c);(b=b&&b.callback||this.editSummaryCallback)&&(c=b(a,c)||"");if(p.isString(c))d=c;else{if(c){a=c.action;b=c.userId;var g=c.timeValue,B=0;a&&B++;b&&B++;e.isDefined(g)&&B++;1<B&&(d=("edit"===a?"edit":"create")+(b?"User":"")+(e.isDefined(g)?c.displayPattern:""))}d=d&&e.substitute(c,this.i18n.layers.FeatureLayer[d])}return d},getEditInfo:function(a,b,c){if(this.loaded){c=e.isDefined(c)?c:(new Date).getTime();b=b&&b.action||"last";var d=this.editFieldsInfo,g=d&&d.creatorField,
B=d&&d.creationDateField,h=d&&d.editorField,d=d&&d.editDateField,h=(a=a&&a.attributes)&&h?a[h]:void 0,d=a&&d?a[d]:null,g=this._getEditData(a&&g?a[g]:void 0,a&&B?a[B]:null,c);c=this._getEditData(h,d,c);var l;switch(b){case "creation":l=g;break;case "edit":l=c;break;case "last":l=c||g}l&&(l.action=l===c?"edit":"creation");return l}},_getEditData:function(a,b,c){var d,g,B;e.isDefined(b)&&(g=c-b,B=0>g?"Full":6E4>g?"Seconds":12E4>g?"Minute":36E5>g?"Minutes":72E5>g?"Hour":864E5>g?"Hours":6048E5>g?"WeekDay":
"Full");if(void 0!==a||B)d=d||{},d.userId=a,B&&(a=q.format,c=new Date(b),d.minutes=Math.floor(g/6E4),d.hours=Math.floor(g/36E5),d.weekDay=a(c,{datePattern:"EEEE",selector:"date"}),d.formattedDate=a(c,{selector:"date"}),d.formattedTime=a(c,{selector:"time"}),d.displayPattern=B,d.timeValue=b);return d},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},isQueryable:function(){var a=d.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],p.trim);return this._isStream||this.userIsAdmin||
this._collection||-1!==d.indexOf(a,"query")||-1!==d.indexOf(a,"catalog")},setMaxAllowableOffset:function(a){this.isEditable()||this._setMaxOffset(a,!0);return this},getMaxAllowableOffset:function(){var a=this._quantizationParameters?this._quantizationParameters.tolerance:void 0;return null!=this._maxOffset?this._maxOffset:a},_setMaxOffset:function(a,b){if(null==a)return delete this._maxOffset,delete this._quantizationParameters,this;this.quantize&&this.supportsCoordinatesQuantization?("esriGeometryPolyline"===
this.geometryType?this._maxOffset=a:delete this._maxOffset,this._quantizationParameters={mode:"view",originPosition:"upperLeft",tolerance:a,extent:this.fullExtent}):(this._isFractionalOffsetAllowed()&&b||(a=Math.floor(a)),isNaN(a)||0===a?delete this._maxOffset:this._maxOffset=a,delete this._quantizationParameters);return this},_isFractionalOffsetAllowed:function(){return null==this.version||10.1<=this.version||navigator.languages&&this._isLangWithDot(navigator.languages[0])},_isLangWithDot:function(a){a=
(a=a&&a.split("-"))&&a[0]&&a[0].toLowerCase();return-1!==d.indexOf(this._langsWithDot,a)},_langsWithDot:"ar en et fr he ja ko th vi zh".split(" "),setAutoGeneralize:function(a){this.loaded?this.isEditable()||this.mode===G.MODE_SNAPSHOT||"esriGeometryPolyline"!==this.geometryType&&"esriGeometryPolygon"!==this.geometryType&&!this.hasXYFootprint()||((this._autoGeneralize=a)?(this._autoSnapshot&&(this._prevScale=null),this._updateMaxOffset()):this._setMaxOffset(null)):this._optAutoGen=a;return this},
setGDBVersion:function(a){this._collection||a===this.gdbVersion||!a&&!this.gdbVersion||(this.gdbVersion=a,this._task.gdbVersion=a,this._url.query=p.mixin(this._url.query,{gdbVersion:a}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange());return this},hasAllFeatures:function(){return this._mode?this._mode.hasAllFeatures():!0},setDefinitionExpression:function(a){this._defnExpr=a;(a=this._mode)&&a.propertyChangeHandler(1);return this},getDefinitionExpression:function(){return this._defnExpr},
setTimeDefinition:function(a){this._isSnapshot?(this._timeDefn=a,(a=this._mode)&&a.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+this.id+", Layer URL \x3d "+this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(a,b){this._timeOffset=a;this._timeOffsetUnits=b;var c=this._mode;c&&c.propertyChangeHandler(0);return this},setUseMapTime:function(a){this.useMapTime=
a;this._toggleTime(!this.suspended);(a=this._mode)&&a.propertyChangeHandler(0)},selectFeatures:function(a,b,c,e){b=b||G.SELECTION_NEW;this._hasPartialSelectedFeatures=!1;a=this._getShallowClone(a);var d=this._map,g,h=this,l=z._fixDfd(new m(z._dfdCanceller));a.outFields=this.getOutFields();a.returnGeometry=!0;a.multipatchOption=this.multipatchOption;d&&(a.outSpatialReference=new A(d.spatialReference.toJson()));if(!this._applyQueryFilters(a,!0))return g={features:[]},this._selectHandler(g,b,c,e,l),
l;if(d=this._canDoClientSideQuery(a))l._pendingDfd=x(this._doQuery(a,d)),l._pendingDfd.then(function(a){g={features:a};h._selectHandler(g,b,c,e,l)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,e,l,!0),l;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,e,l,!0),l;var B=this;this._ts&&(a._ts=(new Date).getTime());(l._pendingDfd=this._task.execute(a)).addCallbacks(function(a){B._selectHandler(a,
b,c,e,l)},function(a){B._hasPartialSelectedFeatures=!0;B._resolve([a],null,e,l,!0)})}return l},getSelectedFeatures:function(){var a=this._selectedFeatures,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},clearSelection:function(a){var b=this._selectedFeatures,c=this._mode,e;for(e in b)b.hasOwnProperty(e)&&(this._unSelectFeatureIIf(e,c),c._removeFeatureIIf(e));this._selectedFeatures={};this._isSelOnly&&c._applyTimeFilter(!0);if(!a)this.onSelectionClear();return this},setSelectionSymbol:function(a){if(this._selectionSymbol=
a){var b=this._selectedFeatures,c;for(c in b)b.hasOwnProperty(c)&&b[c].setSymbol(a)}return this},getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(a){a?(this.labelingInfo=a,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this.onLabelingInfoChange()},_fixLabelExpr:function(){var a=/\[([^\[\]]+)\]/ig,b,c=this,e=function(a,b){var e=c._getField(b,!0);return"["+(e&&e.name||b)+"]"};d.forEach(this.labelingInfo,function(c){if(b=c.labelExpression)c.labelExpression=
b.replace(a,e)})},_updateRequiredFieldsFromLabelingInfo:function(){var a=[];d.forEach(this.labelingInfo,function(b){var c=b.labelExpressionInfo;if(b.labelExpression){var e=/[\[\]]/ig;b=b.labelExpression.match(/\[[^\[\]]+\]/ig);(b=d.map(b,function(a){return a.replace(e,"")}))&&(a=a.concat(b))}if(c){if(c.value){var g=/[\{\}]/ig;b=c.value.match(/\{[^\{\}]+\}/ig);(b=d.map(b,function(a){return a.replace(g,"")}))&&(a=a.concat(b))}c.expression&&(a=a.concat(ra.extractFieldNames(c.expression)))}});a=d.map(a,
function(a){var b=this.getField(a);return b?b.name:a},this);this._requiredFields&&(this._requiredFields=this._requiredFields.concat(a))},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(a,b,c,e,g,h){var f=h.assembly,m=h.dfd;this._applyNormalized(a,f&&f[0]);this._applyNormalized(b,f&&f[1]);this.onBeforeApplyEdits(a,b,c);var B={},k=this.objectIdField,f={f:"json"},q=!1;if(this._collection)h={},h.addResults=a?d.map(a,function(){q=!0;return{objectId:this._nextId++,success:!0}},
this):null,h.updateResults=b?d.map(b,function(a){q=!0;var b=a.attributes[k];B[b]=a;return{objectId:b,success:!0}},this):null,h.deleteResults=c?d.map(c,function(a){q=!0;return{objectId:a.attributes[k],success:!0}},this):null,q?this._editHandler(h,a,B,e,g,m):this._resolve([h.addResults,h.updateResults,h.deleteResults],null,e,m);else{a&&0<a.length&&(f.adds=this._convertFeaturesToJson(a,0,1),q=!0);if(b&&0<b.length){for(h=0;h<b.length;h++){var P=b[h];B[P.attributes[k]]=P}f.updates=this._convertFeaturesToJson(b,
0,0,1);q=!0}if(c&&0<c.length){b=[];for(h=0;h<c.length;h++)b.push(c[h].attributes[k]);f.deletes=b.join(",");q=!0}if(q){var x=this;return l({url:this._url.path+"/applyEdits",content:p.mixin(f,this._url.query),callbackParamName:"callback",load:function(b){x._editHandler(b,a,B,e,g,m)},error:function(a){x._resolve([a],null,g,m,!0)}},{usePost:!0})}this._resolve([],null,e,m)}},queryFeatures:function(a,b,c){return this._query("execute","onQueryFeaturesComplete",a,b,c)},queryRelatedFeatures:function(a,b,c){return this._query("executeRelationshipQuery",
"onQueryRelatedFeaturesComplete",a,b,c)},queryIds:function(a,b,c){return this._query("executeForIds","onQueryIdsComplete",a,b,c)},queryCount:function(a,b,c){return this._query("executeForCount","onQueryCountComplete",a,b,c)},queryExtent:function(a,b,c){return this._query("executeForExtent","onQueryExtentComplete",a,b,c)},queryAttachmentInfos:function(a,b,e){var g=this._url.path+"/"+a+"/attachments",h=new m(z._dfdCanceller),f=this;h._pendingDfd=l({url:g,content:p.mixin({f:"json"},this._url.query),
callbackParamName:"callback",load:function(e){e=e.attachmentInfos;var l;d.forEach(e,function(b){l=c.objectToQuery({gdbVersion:f._url.query&&f._url.query.gdbVersion,layer:f._url.query&&f._url.query.layer,token:f._getToken()});b.url=g+"/"+b.id+(l?"?"+l:"");b.objectId=a});f._resolve([e],"onQueryAttachmentInfosComplete",b,h)},error:function(a){f._resolve([a],null,e,h,!0)}});return h},addAttachment:function(a,b,c,e){return this._sendAttachment("add",a,b,c,e)},updateAttachment:function(a,c,e,d,g){e.appendChild(b.create("input",
{type:"hidden",name:"attachmentId",value:c}));return this._sendAttachment("update",a,e,d,g)},deleteAttachments:function(a,b,c,e){var g=this._url.path+"/"+a+"/deleteAttachments",h=new m(z._dfdCanceller),f=this;b={f:"json",attachmentIds:b.join(",")};h._pendingDfd=l({url:g,content:p.mixin(b,this._url.query),callbackParamName:"callback",load:p.hitch(this,function(b){b=b.deleteAttachmentResults;b=d.map(b,function(b){b=new O(b);b.attachmentId=b.objectId;b.objectId=a;return b});f._resolve([b],"onDeleteAttachmentsComplete",
c,h)}),error:function(a){f._resolve([a],null,e,h,!0)}},{usePost:!0});return h},addType:function(a){var b=this.types;if(b){if(d.some(b,function(b){return b.id==a.id?!0:!1}))return!1;b.push(a)}else this.types=[a];return this._typesDirty=!0},deleteType:function(a){if(this._collection){var b=this.types;if(b){var c=-1;d.some(b,function(b,e){return b.id==a?(c=e,!0):!1});if(-1<c)return this._typesDirty=!0,b.splice(c,1)[0]}}},toJson:function(){var a=this._json;if(a=p.isString(a)?w.fromJson(a):p.clone(a)){var a=
a.layerDefinition?a:{layerDefinition:a},b=a.layerDefinition,c=this._collection;if(c&&this._typesDirty){b.types=d.map(this.types||[],function(a){return a.toJson()});var e=this.renderer,g=this.labelingInfo,h=b.drawingInfo;!e&&!g||h||(h=b.drawingInfo={});h&&e&&-1===e.declaredClass.indexOf("TemporalRenderer")&&(h.renderer=e.toJson());g&&(h.labelingInfo=d.map(g,function(a){return a.toJson()}))}e=null;if(!c||this._fcAdded)e={geometryType:b.geometryType,features:this._convertFeaturesToJson(this.graphics,
!0)};a.featureSet=p.mixin({},a.featureSet||{},e);a.featureSet.transform&&(g=a.featureSet.transform,delete a.featureSet.transform,e=new S(a.featureSet),e.quantize(g),a.featureSet=e.toJson());c&&(a.nextObjectId=this._nextId,b.capabilities=this.capabilities);return a}},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},
onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},onLabelingInfoChange:function(){},_forceIdentity:function(b){var c=this,e,d=this._url&&this._url.path;e=d&&d.toLowerCase().indexOf("/rest/services");var g=this.editFieldsInfo,
g=g&&(g.creatorField||g.editorField);(this.userIsAdmin||g)&&!this._getToken()&&-1<e&&a.id?(e=d.substring(0,e)+"/rest/info",l({url:e,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(b){if(b.owningSystemUrl)return a.id.checkSignInStatus(b.owningSystemUrl+"/sharing")}).then(function(b){if(b)return a.id.getCredential(d)}).then(function(a){a&&c._findCredential()}).always(function(){b.call(c)})):b.call(this)},_checkMode:function(a){var b=this.geometryType,c=this.maxRecordCount;
a=(a=a&&a.features&&a.features[0])&&a.attributes&&a.attributes.exceedslimit;this.mode===G.MODE_AUTO&&!this.isEditable()&&0===a&&(this.queryPagination||("esriGeometryPolyline"===b||"esriGeometryPolygon"===b||"esriGeometryMultipoint"===b||this.hasXYFootprint())&&c>=this.maxRecordCountForAuto||"esriGeometryPoint"===b&&c>=this.maxPointCountForAuto)&&(this.currentMode=G.MODE_SNAPSHOT,this._mode=new N(this),this._isSnapshot=this._autoSnapshot=!0)},_queryLimit:function(){var a=this,b=new m;this._limitPromise=
b.promise;setTimeout(function(){var c=new R,e=new da;e.statisticType="exceedslimit";e.maxPointCount=a.maxPointCountForAuto;e.maxRecordCount=a.maxRecordCountForAuto;e.maxVertexCount=a.maxVertexCountForAuto;e.outStatisticFieldName="exceedslimit";c.outStatistics=[e];a.queryFeatures(c).promise.then(function(a){b.resolve(a)},function(a){b.reject(a)})},0)},_updateCaps:function(){var a=this._editable,b=p.trim(this.capabilities||""),c=d.map(b?b.split(","):[],p.trim),e=d.map(b?b.toLowerCase().split(","):[],
p.trim),b=d.indexOf(e,"editing"),g,e={Create:d.indexOf(e,"create"),Update:d.indexOf(e,"update"),Delete:d.indexOf(e,"delete")};if(a&&-1===b)c.push("Editing");else if(!a&&-1<b){a=[b];for(g in e)-1<e[g]&&a.push(e[g]);a.sort();for(g=a.length-1;0<=g;g--)c.splice(a[g],1)}this.capabilities=c.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._toggleTime(!1);var a=this._mode;a&&a.suspend()},onResume:function(a){this.inherited(arguments);
this._toggleTime(!0);var b=this._mode,c=this._map,e=this._getRenderer();a.firstOccurrence?(this._fixRendererFields(),this._updateRequiredFieldsFromLabelingInfo(),this._checkFields(),this.clearSelection(),this.timeInfo&&!this._trackManager&&(this._trackIdField||e&&(e.latestObservationRenderer||e.trackRenderer))&&(this._trackManager=new ka(this),this._trackManager.initialize(c),this._childLayer=this._trackManager.container),e&&"colors"in e&&"blurRadius"in e&&"maxPixelIntensity"in e&&"esriGeometryPoint"==
this.geometryType&&!this._heatmapManager&&(this._heatmapManager=new ba(this),this._heatmapManager.initialize(c)),this._autoSnapshot&&this._autoGeneralize&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint())&&!this.isEditable()&&null==this.getMaxAllowableOffset()&&(e=this.generalizeForScale,this._calculatedScale=e=this.maxScale?this.maxScale:this.minScale?Math.min(e,this.minScale):Math.min(e,H.getScale(c,this.initialExtent)),this._calcMaxOffset=
c.extent.getWidth()/c.width/c.getScale()*e),this._zoomConnect=r.connect(c,"onZoomEnd",this,this._zoomEndHandler),this._updateMaxOffset(),this._needsRefresh=!1,b&&b.startup()):(this._zoomEndHandler(),b&&b.resume())},_zoomEndHandler:function(){var a=this._map;this._updateMaxOffset();this._prevScale=a.getScale();!this.suspended&&this._needsRefresh&&this.refresh()},_updateMaxOffset:function(){var a=this._map;a&&a.loaded&&this._autoGeneralize&&(this._autoSnapshot?(a=this.getMaxAllowableOffset(),this._setMaxOffset(this._getMaxOffsetForScale(),
!0),this._needsRefresh||(this._needsRefresh=a!=this.getMaxAllowableOffset())):this._setMaxOffset(a.extent.getWidth()/a.width,!a.extent.spatialReference.isWebMercator()))},_getMaxOffsetForScale:function(){if(this._map){var a=this._map.getScale(),b=this._calculatedScale,c=this._calcMaxOffset,e=this._prevScale;return a>=b&&(null==e||e<b)?c:a<b&&(null==e||e>=b)?null:this.getMaxAllowableOffset()}},_toggleTime:function(a){var b=this._map;a&&this.timeInfo&&this.useMapTime&&b?(this._mapTimeExtent=b.timeExtent,
this._timeConnect||(this._timeConnect=r.connect(b,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,r.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(a){this._mapTimeExtent=a;(a=this._mode)&&a.propertyChangeHandler(0)},_getOffsettedTE:function(a){var b=this._timeOffset,c=this._timeOffsetUnits;return a&&b&&c?a.offset(-1*b,c):a},_getTimeOverlap:function(a,b){return a&&b?a.intersection(b):a||b},_getTimeFilter:function(a){var b=this.getTimeDefinition(),
c;if(b&&(c=this._getTimeOverlap(b,null),!c))return[!1];if(a){if(a=c?this._getTimeOverlap(a,c):a,!a)return[!1]}else a=c;return[!0,a]},_getAttributeFilter:function(a){var b=this.getDefinitionExpression();return a?b?"("+b+") AND ("+a+")":a:b},_applyQueryFilters:function(a,b){a.where=this._getAttributeFilter(a.where);a.maxAllowableOffset||(a.maxAllowableOffset=this._maxOffset);a.quantizationParameters=this._quantizationParameters;b&&this.supportsAdvancedQueries&&(a.orderByFields=a.orderByFields||this.getOrderByFields());
if(this.timeInfo){var c=this._getTimeFilter(a.timeExtent);if(c[0])a.timeExtent=c[1];else return!1}return!0},_add:function(a){var b=this._selectionSymbol,c=a.attributes,e=this.visibilityField;b&&this._isSelOnly&&a.setSymbol(b);if(e&&c&&c.hasOwnProperty(e))a[c[e]?"show":"hide"]();return this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(a){var b=[],c=this._map,e;if((this._collection||!this._isTable&&c)&&!(a.text||a.where&&a.where!==
this.getDefinitionExpression()||a.orderByFields&&a.orderByFields.length&&(e=this.getOrderByFields()||[])&&a.orderByFields.join()!==e.join()||a.outStatistics||a.returnDistinctValues)){e=this._isSnapshot;var g=this._isSelOnly,h=a.geometry;if(h){if(g||a.spatialRelationship!==R.SPATIAL_REL_INTERSECTS||"extent"!==h.type||!e&&!c.extent.contains(h))return;b.push(1)}if(c=a.objectIds)if(e)b.push(2);else{var h=c.length,l=this._mode,f=0,m;for(m=0;m<h;m++)l._getFeature(c[m])&&f++;if(f===h)b.push(2);else return}if(this.timeInfo)if(a=
a.timeExtent,c=this._mapTimeExtent,e)a&&b.push(3);else if(g){if(a)return}else if(c)if(-1!==d.indexOf(b,2))a&&b.push(3);else if(-1!==d.indexOf(b,1))a==c&&b.push(3);else return;else if(0<b.length)a&&b.push(3);else if(a)return;return 0<b.length?b:null}},_getAbsMid:function(a){return n.toAbsMid?n.toAbsMid(a):k.id.replace(/\/[^\/]*$/ig,"/")+a},_doQuery:function(a,b,c){var e=[],g=this.objectIdField,h=this,l=new m,f=new m,k=this.graphics;if(-1!==d.indexOf(b,1)){var q=this.spatialIndex||this._map&&this._map.spatialIndex,
x,v=a.geometry._normalize(null,!0);null==q&&la.autoSpatialIndexing?x=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(p.hitch(this,p.partial(this._getFromIndex,v,q)),function(a){f.resolve(p.hitch(this,p.partial(this._filterByExtent,k,v)))}):q&&(x=this._getFromIndex(v,q));x?x.then(function(a){for(var b=0;b<a.length;b++)a[b].results&&(e=e.concat(a[b].results));f.resolve(e)}).otherwise(function(a){f.reject(a)}):f.resolve(this._filterByExtent(k,v))}else f.resolve(k);f.then(function(f){e=
f;if(-1!==d.indexOf(b,2)){var m=a.objectIds;e=d.filter(e,function(a){return-1<d.indexOf(m,a.attributes[g])})}-1!==d.indexOf(b,3)&&h.timeInfo&&(f=a.timeExtent,e=h._filterByTime(e,f.startTime,f.endTime).match);c&&(e=d.map(e,function(a){return a.attributes[g]},this));l.resolve(e)});return l},_getFromIndex:function(a,b){b=b||this.spatialIndex||this._map.spatialIndex;a instanceof Array||(a=[a]);var c=this.id;return h(d.map(a,function(a){return b.intersects(a,c)}))},_filterByExtent:function(a,b){for(var c=
[],e=0,d=a.length;e<d;e++){var g=a[e],h=g.geometry;h&&(this.normalization&&b.length?(b[0].intersects(h)||b[1].intersects(h))&&c.push(g):b.intersects(h)&&c.push(g))}return c},_filterByTime:function(a,b,c){var d=this._startTimeField,g=this._endTimeField,h;this._twoTimeFields||(h=d||g);var l=e.isDefined,f=[],m=[],k,q=a.length,x,p;b=b?b.getTime():-Infinity;c=c?c.getTime():Infinity;if(h)for(k=0;k<q;k++)x=a[k],p=x.attributes,d=p[h],d>=b&&d<=c?f.push(x):m.push(x);else for(k=0;k<q;k++)x=a[k],p=x.attributes,
h=p[d],p=p[g],h=l(h)?h:-Infinity,p=l(p)?p:Infinity,h>=b&&h<=c||p>=b&&p<=c||b>=h&&c<=p?f.push(x):m.push(x);return{match:f,noMatch:m}},_getSizeVariables:function(a){return a&&d.filter(a.getVisualVariablesForType("sizeInfo",!1),function(a){return!(!a.field&&!a.valueExpression)})},_needClientSideSorting:function(a){return this._collection?!(!a||!a.length):d.some(a,function(a){return!!a.valueExpression})},_sortFeatures:function(a){var b=this.renderer,c=this._getSizeVariables(b);if(a&&1<a.length&&this._needClientSideSorting(c)){var e=
c[0],d=this;a.sort(function(a,c){a._layer||(a._layer=d);c._layer||(c._layer=d);var g=b._getDataValue(a,e,"sizeInfo",null,d),h=b._getDataValue(c,e,"sizeInfo",null,d);return null==g?-1:null==h?1:h-g})}return a},_resolve:function(a,b,c,e,d){b&&this[b].apply(this,a);c&&c.apply(null,a);e&&z._resDfd(e,a,d)},_getShallowClone:function(a){var b=new R,c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_query:function(a,b,c,e,g){var h=this,l=this._map,f=new m(z._dfdCanceller),k=c,q,p;if("executeRelationshipQuery"!==
a){var k=this._getShallowClone(c),v=this.getOutFields();k.outFields||(k.outFields=v);k.outFields&&k.outFields.length&&(p=-1<d.indexOf(v,"*")?!1:!d.every(k.outFields,function(a){return-1<d.indexOf(v,a)}));k.returnGeometry=c.hasOwnProperty("returnGeometry")?c.returnGeometry:!c.outStatistics;k.returnGeometry&&(k.multipatchOption=this.multipatchOption);var t;l&&(c=l&&l.spatialReference,(l=k.outSpatialReference)?q=!l.equals(c):k.outSpatialReference=new A(c.toJson()));if(!this._applyQueryFilters(k,"execute"===
a&&!k.outStatistics)){switch(a){case "execute":t=new S({features:[]});break;case "executeForIds":t=[];break;case "executeForCount":t=0;break;case "executeForExtent":t={}}this._resolve([t],b,e,f);return f}if(c="executeForExtent"!==a&&!q&&!p&&this._canDoClientSideQuery(k))return f._pendingDfd=x(this._doQuery(k,c,"executeForIds"===a||"executeForCount"===a)),f._pendingDfd.then(function(c){switch(a){case "execute":t=new S;t.features=c;break;case "executeForIds":t=c;break;case "executeForCount":t=c.length}h._resolve([t],
b,e,f)}),f}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,g,f,!0),f;if(this.loaded&&!this.isQueryable())return this._resolve([Error("Layer does not support query capability.")],null,g,f,!0),f;this._ts&&(k._ts=(new Date).getTime());(f._pendingDfd=this._task[a](k)).addCallbacks(function(c){var d=!!k.outStatistics||q||p;if("execute"===a||"executeRelationshipQuery"===a){var g,l;if("execute"===a)for(g=c.features,l=g.length,--l;0<=l;l--){if(g[l]._layer=
h,!d&&!h._isTable){var m=h._mode._getFeature(g[l].attributes[h.objectIdField]);m&&g.splice(l,1,m)}}else for(m in c)if(c.hasOwnProperty(m))for(g=c[m].features,l=g.length,--l;0<=l;l--)g[l]._layer=h}h._resolve([c],b,e,f)},function(a){h._resolve([a],null,g,f,!0)});return f},_convertFeaturesToJson:function(a,b,c,e){var g=[],h=this._selectionSymbol,l=this.visibilityField,f,m=this.objectIdField;this.loaded&&(c||e)&&(f=d.filter(this.fields,function(a){return!1===a.editable&&(!e||a.name!==m)}));for(c=0;c<
a.length;c++){var k=a[c],q={},x=k.geometry,v=k.attributes,t=k.symbol;!x||e&&this.loaded&&!this.allowGeometryUpdates||(q.geometry=x.toJson());l?(q.attributes=v=p.mixin({},v),v[l]=k.visible?1:0):v&&(q.attributes=p.mixin({},v));q.attributes&&f&&f.length&&d.forEach(f,function(a){delete q.attributes[a.name]});t&&t!==h&&(q.symbol=t.toJson());g.push(q)}return b?g:w.toJson(g)},_selectHandler:function(a,b,c,e,d){var g;e=G;switch(b){case e.SELECTION_NEW:this.clearSelection(!0);g=!0;break;case e.SELECTION_ADD:g=
!0;break;case e.SELECTION_SUBTRACT:g=!1}e=a.features;var h=this._mode,l=[],f=this.objectIdField,m,k;if(g)for(g=0;g<e.length;g++)m=e[g],k=m.attributes[f],m=h._addFeatureIIf(k,m),l.push(m),this._selectFeatureIIf(k,m,h);else for(g=0;g<e.length;g++)m=e[g],k=m.attributes[f],this._unSelectFeatureIIf(k,h),k=h._removeFeatureIIf(k),l.push(k||m);this._isSelOnly&&h._applyTimeFilter(!0);this._hasPartialSelectedFeatures=!!a.exceededTransferLimit;this._resolve([l,b,a.exceededTransferLimit?{queryLimitExceeded:!0}:
null],"onSelectionComplete",c,d);if(a.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(a,b,c){var e=this._selectedFeatures,d=e[a];d||(c._incRefCount(a),e[a]=b,this._isTable||(this._setSelectSymbol(b),b.attr("data-selected","")));return d||b},_unSelectFeatureIIf:function(a,b){var c=this._selectedFeatures[a];c&&(b._decRefCount(a),delete this._selectedFeatures[a],this._isTable||(this._setUnSelectSymbol(c),c.attr("data-selected")));return c},_isSelected:function(a){},_setSelectSymbol:function(a){var b=
this._selectionSymbol;b&&!this._isSelOnly&&a.setSymbol(b)},_setUnSelectSymbol:function(a){var b=this._selectionSymbol;b&&!this._isSelOnly&&b===a.symbol&&a.setSymbol(null,!0)},_getOutFields:function(){var a=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._requiredFields).concat(this.dataAttributes),a=d.filter(a,function(a,b,c){return!!a&&d.indexOf(c,a)===b}),b=p.clone(this._outFields);if(b){if(-1!==d.indexOf(b,"*"))return b;
d.forEach(a,function(a){-1===d.indexOf(b,a)&&b.push(a)});return b}return a},_checkFields:function(a){var b=a||this._getOutFields();d.forEach(b,function(a){"*"!==a&&(this._getField(a)||console.debug("esri.layers.FeatureLayer: "+e.substitute({url:this.url,field:a},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);a||this._isTable||this._fserver||this._collection||this._isStream||d.some(this.fields,function(a){return a&&"esriFieldTypeGeometry"===a.type?!0:!1})||
console.debug("esri.layers.FeatureLayer: "+e.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]"))},_fixFieldCase:function(a,b,c){var e=a&&a[b],d;if(e&&!p.isFunction(e)){if(d=!this._getField(e)&&this._getField(e,!0))e=a[b]=d.name;c&&c.push(e)}return e},_fixRendererFields:function(){var a=this.renderer;this._orderBy=null;this._requiredFields=[];if(a&&
0<this.fields.length){var b=[],c,a=d.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],e.isDefined),g=[].concat(a);d.forEach(a,function(a){d.forEach(a.rendererInfos,function(a){a.renderer&&g.push(a.renderer)})});d.forEach(g,function(a){this._fixFieldCase(a,"attributeField",b);this._fixFieldCase(a,"attributeField2",b);this._fixFieldCase(a,"attributeField3",b);this._fixFieldCase(a.rotationInfo,"field",b);(c=this._fixFieldCase(a.sizeInfo,"field",b))&&!this._orderBy&&(this._orderBy=
[c+" DESC"]);this._fixFieldCase(a.sizeInfo,"normalizationField",b);this._fixFieldCase(a.colorInfo,"field",b);this._fixFieldCase(a.colorInfo,"normalizationField",b);this._fixFieldCase(a.field,"field",b);this._fixFieldCase(a.opacityInfo,"field",b);this._fixFieldCase(a.opacityInfo,"normalizationField",b);d.forEach(a.visualVariables,function(a){c=this._fixFieldCase(a,"field",b);"sizeInfo"===a.type&&c&&!this._orderBy&&(this._orderBy=[c+" DESC"]);this._fixFieldCase(a,"normalizationField",b)},this);var e=
d.map(a.getFieldsUsedInExpressions(),function(a){var b=this.getField(a);return b?b.name:a},this);b=b.concat(e);this._orderBy||!a.addBreak||p.isFunction(a.attributeField)||!a.backgroundFillSymbol&&!this._hasSizeDiff(a)||(this._orderBy=[a.attributeField+" DESC"])},this);this._requiredFields=d.filter(b,e.isDefined)}},_hasSizeDiff:function(a){var b=Number.MAX_VALUE,c=-Number.MAX_VALUE,e,g;d.forEach(a.infos,function(a){if(g=a.symbol){e=0;switch(g.type){case "simplemarkersymbol":e=g.size;break;case "picturemarkersymbol":e=
(g.width+g.height)/2;break;case "simplelinesymbol":case "cartographiclinesymbol":e=g.width;break;case "simplefillsymbol":case "picturefillsymbol":e=g.outline&&g.outline.width}e&&(b=Math.min(b,e),c=Math.max(c,e))}});return b!==Number.MAX_VALUE&&c!==-Number.MAX_VALUE&&1<Math.abs(c-b)},getOrderByFields:function(){var a=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&a?d.filter(a,function(a){a=a.split(" ")[0];return!!this._getField(a,!0)},this):null},_getField:function(a,b){var c=
this.fields;if(!c||0===c.length)return null;var e;b&&(a=a.toLowerCase());d.some(c,function(c){var d=!1;(d=b?c&&c.name.toLowerCase()===a?!0:!1:c&&c.name===a?!0:!1)&&(e=c);return d});return e},_getDateOpts:function(){this._dtOpts||(this._dtOpts={properties:d.map(d.filter(this.fields,function(a){return!(!a||"esriFieldTypeDate"!==a.type)}),function(a){return a.name})});return this._dtOpts},_applyNormalized:function(a,b){a&&b&&d.forEach(a,function(a,c){a&&b[c]&&a.setGeometry(b[c])})},_editHandler:function(a,
b,c,e,g,h){g=a.addResults;var l=a.updateResults;a=a.deleteResults;var f,m,k,q,x,v=this.objectIdField,t=this._mode,u=this._isTable;f=this.editFieldsInfo;q=this.getOutFields()||[];var n=f&&f.creatorField,r=f&&f.creationDateField,y=f&&f.editorField,z=f&&f.editDateField;f=f&&f.realm;-1===d.indexOf(q,"*")&&(n&&-1===d.indexOf(q,n)&&(n=null),r&&-1===d.indexOf(q,r)&&(r=null),y&&-1===d.indexOf(q,y)&&(y=null),z&&-1===d.indexOf(q,z)&&(z=null));var A=r||z?(new Date).getTime():null,w=n||y?this.getUserId():void 0;
w&&f&&(w=w+"@"+f);if(g){var D=this.globalIdField;for(f=0;f<g.length;f++)g[f]=new O(g[f]),u||(m=g[f],m.success&&(k=m.objectId,q=b[f],(x=q._graphicsLayer)&&x!==this&&x.remove(q),x=q.attributes||{},x[v]=k,k=m.globalId,D&&k&&(x[D]=k),n&&(x[n]=w),y&&(x[y]=w),r&&(x[r]=A),z&&(x[z]=A),q.setAttributes(x),t._init&&t.drawFeature(q)))}if(l)for(f=0;f<l.length;f++)if(l[f]=new O(l[f]),!u&&(m=l[f],m.success)){k=m.objectId;q=c[k];if(b=t._getFeature(k))b.geometry!==q.geometry&&q.geometry&&b.setGeometry(ia.fromJson(q.geometry.toJson())),
b.attributes!==q.attributes&&q.attributes&&b.setAttributes(p.mixin(b.attributes,q.attributes)),this._repaint(b,k);q=b||q;x=q.attributes||{};y&&(x[y]=w);z&&(x[z]=A);q.setAttributes(x)}if(a){c=[];for(f=0;f<a.length;f++)if(a[f]=new O(a[f]),!u&&(m=a[f],m.success&&(k=m.objectId,q=t._getFeature(k))))this._unSelectFeatureIIf(k,t)&&c.push(q),q._count=0,t._removeFeatureIIf(k);if(0<c.length)this.onSelectionComplete(c,G.SELECTION_SUBTRACT)}this._resolve([g,l,a],"onEditsComplete",e,h)},_sendAttachment:function(a,
b,c,e,d){var g=this;return l({url:this._url.path+"/"+b+"/"+("add"===a?"addAttachment":"updateAttachment"),form:c,content:p.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(c){var d="add"===a?"onAddAttachmentComplete":"onUpdateAttachmentComplete";c=new O(c["add"===a?"addAttachmentResult":"updateAttachmentResult"]);c.attachmentId=c.objectId;c.objectId=b;g._resolve([c],d,e);return c}).addErrback(function(a){g._resolve([a],
null,d,null,!0)})},_repaint:function(a,b,c){b=e.isDefined(b)?b:a.attributes[this.objectIdField];b in this._selectedFeatures&&this._selectionSymbol||a.setSymbol(a.symbol,c)},_getKind:function(a){var b=this._trackManager;return b?b.isLatestObservation(a)?1:0:0}});p.mixin(G,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});
X._createWrappers(G);u("extend-esri")&&p.setObject("layers.FeatureLayer",G,a);return G})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./RangeDomain ./CodedValueDomain ./InheritedDomain ./FeatureTemplate".split(" "),function(n,k,f,r,p,d,w,m,q,u,c){n=n(null,{declaredClass:"esri.layers.FeatureType",constructor:function(b){if(b&&k.isObject(b)){this.id=b.id;this.name=b.name;var d=b.symbol;d&&(this.symbol=
w.fromJson(d));var d=b.domains,f,h=this.domains={};for(f in d)if(d.hasOwnProperty(f)){var a=d[f];switch(a.type){case "range":h[f]=new m(a);break;case "codedValue":h[f]=new q(a);break;case "inherited":h[f]=new u(a)}}if(f=b.templates)for(d=this.templates=[],b=0;b<f.length;b++)d.push(new c(f[b]))}},toJson:function(){var b={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},c,m=this.domains,h=this.templates,a=d.fixJson;if(m){var e=b.domains={};for(c in m)m.hasOwnProperty(c)&&(e[c]=m[c]&&
m[c].toJson());a(e)}h&&(b.templates=f.map(h,function(a){return a.toJson()}));return a(b)}});r("extend-esri")&&k.setObject("layers.FeatureType",n,p);return n})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(n,k,f,r,p,d){n=n(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(f){f&&k.isObject(f)&&(this.name=f.name,this.description=f.description,this.drawingTool=f.drawingTool,this.thumbnail=
f.thumbnail,f=f.prototype,this.prototype=new d(f.geometry,null,f.attributes))},toJson:function(){return p.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,thumbnail:p.fixJson(k.clone(this.thumbnail)),prototype:this.prototype&&this.prototype.toJson()})}});k.mixin(n,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",
TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});f("extend-esri")&&k.setObject("layers.FeatureTemplate",n,r);return n})},
"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,k,f,r){n=n(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(f){f&&k.isObject(f)&&(this.objectId=f.objectId,this.globalId=f.globalId,this.success=f.success,f.success||(f=f.error,this.error=Error(),this.error.code=f.code,this.error.message=f.description))}});f("extend-esri")&&k.setObject("layers.FeatureEditResult",n,r);return n})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../tasks/query ./RenderMode".split(" "),
function(n,k,f,r,p,d,w){n=n([w],{declaredClass:"esri.layers._SnapshotMode",constructor:function(d){this.featureLayer=d;this.pagination=d.queryPagination;this._featureMap={};this._hasPartialFeatures=!1;this._drawFeatures=k.hitch(this,this._drawFeatures);this._queryErrorHandler=k.hitch(this,this._queryErrorHandler)},startup:function(){this.pagination=this.pagination&&null!=this.featureLayer.maxRecordCount;this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},propertyChangeHandler:function(d){this._init&&
(d?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},drawFeature:function(d){var f=d.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(f,d);this._incRefCount(f)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var d=this.featureLayer;d._collection?(d._fireUpdateStart(),
d._refresh(!0),d._fireUpdateEnd()):this._fetchAll()},hasAllFeatures:function(){return!this._hasPartialFeatures},_getRequestId:function(d){return("_"+d.name+d.layerId+d._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchAll:function(){var d=this.featureLayer;d._collection||d.suspended||!d.isQueryable()||(d._fireUpdateStart(),this._clearIIf(),this._hasPartialFeatures=!1,this._sendRequest())},_sendRequest:function(f){var m=this.map,k=this.featureLayer,c=k.getDefinitionExpression(),b=new d;b.outFields=k.getOutFields();
b.where=c||"1\x3d1";b.returnGeometry=!0;b.outSpatialReference=new p(m.spatialReference.toJson());b.timeExtent=k.getTimeDefinition();b.maxAllowableOffset=k._maxOffset;b.quantizationParameters=k._quantizationParameters;k._ts&&(b._ts=(new Date).getTime());b.orderByFields=k.supportsAdvancedQueries?k.getOrderByFields():null;b.multipatchOption=k.multipatchOption;this.pagination&&(this._start=b.start=null==f?0:f,b.num=k.maxRecordCount);var g;k._usePatch&&(g=this._getRequestId(k),this._cancelPendingRequest(null,
g));k._task.execute(b,this._drawFeatures,this._queryErrorHandler,g)},_drawFeatures:function(d){this._purgeRequests();var f=d.features,m=this.featureLayer,c=m.objectIdField,b,g=f.length,k=d.exceededTransferLimit&&!m._collection,h=m._selectedFeatures,a=m.mode===m.constructor.MODE_AUTO,e,l,v;m._fireUpdateStart();m._sortFeatures(f);for(b=0;b<g;b++)l=f[b],v=l.attributes[c],e=this._addFeatureIIf(v,l),this._incRefCount(v),a&&e!==l&&h[v]&&(e.setGeometry(l.geometry),e.setAttributes(l.attributes));this._applyTimeFilter(!0);
this.pagination&&k||(this._hasPartialFeatures=!!d.exceededTransferLimit,m._fireUpdateEnd(null,d.exceededTransferLimit?{queryLimitExceeded:!0}:null));k&&(this.pagination&&this._sendRequest(this._start+m.maxRecordCount),m.onQueryLimitExceeded())},_queryErrorHandler:function(d){this._purgeRequests();this._hasPartialFeatures=!0;var f=this.featureLayer;f._errorHandler(d);f._fireUpdateEnd(d)}});f("extend-esri")&&k.setObject("layers._SnapshotMode",n,r);return n})},"esri/layers/RenderMode":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/io/script ../kernel".split(" "),
function(n,k,f,r,p,d,w){k=k(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(n._scopeName||"dojo")+"IoScript"},initialize:function(d){this.map=d;this._init=!0},startup:function(){},propertyChangeHandler:function(d){},destroy:function(){this._init=!1},drawFeature:function(d){},suspend:function(){},resume:function(){},refresh:function(){},hasAllFeatures:function(){return!0},_incRefCount:function(d){(d=this._featureMap[d])&&d._count++},_decRefCount:function(d){(d=
this._featureMap[d])&&d._count--},_getFeature:function(d){return this._featureMap[d]},_addFeatureIIf:function(d,f){var k=this._featureMap,c=k[d],b=this.featureLayer;c||(k[d]=f,b._add(f),f._count=0);return c||f},_removeFeatureIIf:function(d){var f=this._featureMap[d],k=this.featureLayer;if(f){if(f._count)return;delete this._featureMap[d];k._remove(f)}return f},_clearIIf:function(){var d;d=this.featureLayer;var f=d.graphics,k=d._selectedFeatures,c=d.getSelectedFeatures().length,b=d.objectIdField;if(c)for(d=
f.length-1;0<=d;d--){var c=f[d],g=c.attributes[b];g in k?c._count=1:(c._count=0,this._removeFeatureIIf(g))}else d.clear(),this._featureMap={}},_isPending:function(f){return d[this._prefix+f]?!0:!1},_cancelPendingRequest:function(f,k){if(f=f||d[this._prefix+k])try{f.cancel(),d._validCheck(f)}catch(u){}},_purgeRequests:function(){d._validCheck(null)},_toggleVisibility:function(d){var f=this.featureLayer,k=f.graphics,c=d?"show":"hide",b,g=k.length;d=d&&f._ager;for(b=0;b<g;b++){var m=k[b];m[c]();d&&f._repaint(m)}},
_applyTimeFilter:function(d){var f=this.featureLayer;if(f.timeInfo&&!f.suspended){d||f._fireUpdateStart();var k=f._trackManager;k&&k.clearTracks();var c=f.getTimeDefinition(),b=f._getOffsettedTE(f._mapTimeExtent);b?(b=f._getTimeOverlap(c,b))?(c=f._filterByTime(f.graphics,b.startTime,b.endTime),k&&k.addFeatures(c.match),r.forEach(c.match,function(b){var c=b._shape;b.visible||(b.show(),(c=b._shape)&&c._moveToFront());f._ager&&c&&f._repaint(b)}),r.forEach(c.noMatch,function(b){b.visible&&b.hide()})):
this._toggleVisibility(!1):(k&&k.addFeatures(f.graphics),this._toggleVisibility(!0));k&&(k.moveLatestToFront(),k.drawTracks());d||f._fireUpdateEnd()}}});p("extend-esri")&&f.setObject("layers._RenderMode",k,w);return k})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),function(n,k,f,r,p,d,w,m,q,u){n=n([q],{declaredClass:"esri.layers._OnDemandMode",
constructor:function(c){this.featureLayer=c;this._featureMap={};this._hasPartialFeatures=!1;this._queryErrorHandler=f.hitch(this,this._queryErrorHandler)},initialize:function(c){this.inherited(arguments);var b=this.featureLayer,d=b._srInfo;this._gridLayer=new u(new w(d?d.valid[0]:c.extent.xmin,d?d.valid[1]:c.extent.ymax,c.spatialReference),{width:b._tileWidth,height:b._tileHeight},{width:c.width,height:c.height},d);this._cellMap={};this._gridLayer.setResolution(c.extent)},startup:function(){this._ioQueue=
[];this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(c){this._init&&(2>c?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this.inherited(arguments)},drawFeature:function(c){var b=c.geometry,d=[];if(b){var d=this._gridLayer.getCellsInExtent("point"===b.type?{xmin:b.x,
ymin:b.y,xmax:b.x,ymax:b.y}:b.getExtent(),!1).cells,b=this._cellMap,f,h,a=c.attributes[this.featureLayer.objectIdField],e,l,k;for(f=0;f<d.length;f++)h=d[f],e=h.latticeID,l=h.row,k=h.col,e?h=b[e]=b[e]||h:(b[l]=b[l]||{},h=b[l][k]=b[l][k]||h),h.features=h.features||[],h.features.push(c),this._addFeatureIIf(a,c),this._incRefCount(a)}},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},
hasAllFeatures:function(){if(this._hasPartialFeatures)return!0;var c=!1,b=this._getCurrentCells(),d;for(d=0;d<b.length;d++)if(b[d].hasPartialFeatures){c=!0;break}return!c},_enableConnectors:function(){var c=this.map;this._zoomConnect=k.connect(c,"onZoomEnd",this,this._zoomHandler);this._panConnect=k.connect(c,"onPanEnd",this,this._panHandler);this._resizeConnect=k.connect(c,"onResize",this,this._panHandler)},_disableConnectors:function(){k.disconnect(this._zoomConnect);k.disconnect(this._panConnect);
k.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var c=this.featureLayer,b=this.map;!c.suspended&&c.isQueryable()&&(c._fireUpdateStart(),this._clearIIf(),this._hasPartialFeatures=!1,(c=c._trackManager)&&c.clearTracks(),this._cellMap={},this._gridLayer.setResolution(b.extent),this._sendRequest())},_panHandler:function(c){if(this.featureLayer.isQueryable()){this.featureLayer._fireUpdateStart();var b=this.featureLayer._resized;c=b?c:null;b&&this._gridLayer.setMapState(c,
this.map.width,this.map.height);this._sendRequest(c)}},_getRequestId:function(c,b){return("_"+c.name+c.layerId+c._ulid+"_"+b.resolution+"_"+(b.latticeID||b.row+"_"+b.col)).replace(/[^a-zA-Z0-9\_]+/g,"_")},_sendRequest:function(c){this._exceeds=!1;var b=this.featureLayer,d=this.map;c=c||d.extent;d=this._gridLayer.getCellsInExtent(c,b.latticeTiling).cells;if(!b.isEditable())var f=this._cellMap,d=r.filter(d,function(a){if(a.lattice){if(f[a.latticeID])return!1}else if(f[a.row]&&f[a.row][a.col])return!1;
return!0});var h=b.getOutFields(),a=b.getDefinitionExpression(),e=b._getOffsettedTE(b._mapTimeExtent),l=b.supportsAdvancedQueries?b.getOrderByFields():null,k=b._usePatch,q=this._ioQueue,p,n=this,t=this._drawFeatures,u,w,M;this._pending=this._pending||0;for(p=0;p<d.length;p++){u=d[p];w=new m;w.geometry=u.extent||u.lattice;w.outFields=h;w.where=a;b.latticeTiling&&u.extent&&(w.spatialRelationship=m.SPATIAL_REL_CONTAINS);w.returnGeometry=!0;w.timeExtent=e;b._ts&&(w._ts=(new Date).getTime());w.orderByFields=
l;w.multipatchOption=b.multipatchOption;w.maxAllowableOffset=b._maxOffset;w.quantizationParameters=b._quantizationParameters;(M=b.advancedQueryCapabilities)&&M.supportsQueryWithResultType&&(w.resultType="tile");M=null;if(k&&(M=this._getRequestId(b,u),this._isPending(M)))continue;this._pending++;q.push(b._task.execute(w,function(){var a=u;return function(b){t.apply(n,[b,a])}}.call(this),this._queryErrorHandler,M))}this._removeOldCells(c);this._endCheck()},_drawFeatures:function(c,b){b.hasPartialFeatures=
!!c.exceededTransferLimit;this._exceeds=this._exceeds||c.exceededTransferLimit;this._finalizeIO();var d=this.featureLayer,f=this.map.extent,h=b.extent,a=b.row,e=b.col,l=d.objectIdField,k=c.features,m=this._gridLayer,q=this._cellMap,p=b.latticeID,t=p?q[p]:q[a]&&q[a][e];if(b.resolution==m._resolution&&(p?p===m.getLatticeID(f):m.intersects(h,f)))if(t)d._sortFeatures(k),this._updateCell(t,k);else for(d._sortFeatures(k),b.features=k,p?q[p]=b:(q[a]=q[a]||{},q[a][e]=b),f=k.length,d=0;d<f;d++)h=k[d],a=h.attributes[l],
this._addFeatureIIf(a,h),this._incRefCount(a);else t&&this._removeCell(a,e,p);this._endCheck()},_queryErrorHandler:function(c){this._finalizeIO();this._hasPartialFeatures=!0;this.featureLayer._errorHandler(c);this._endCheck(!0)},_finalizeIO:function(){this._purgeRequests();this._pending--},_endCheck:function(c){if(0===this._pending){this._processIOQueue();var b=this.featureLayer,d=b._trackManager;d&&(d.clearTracks(),d.addFeatures(b.graphics),b._ager&&r.forEach(b.graphics,function(c){c._shape&&b._repaint(c)}),
d.moveLatestToFront(),d.drawTracks());this.featureLayer._fireUpdateEnd(c&&Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)b.onQueryLimitExceeded()}},_processIOQueue:function(c){this._ioQueue=r.filter(this._ioQueue,function(b){return-1<b.fired?!1:!0});c&&r.forEach(this._ioQueue,this._cancelPendingRequest)},_getCurrentCells:function(c){var b=[];c=c||this._cellMap;for(var d in c)if(c.hasOwnProperty(d)){var f=c[d];f&&(f.hasOwnProperty("row")||
f.hasOwnProperty("latticeID")?b.push(f):"object"===typeof f&&b.push.apply(b,this._getCurrentCells(f)))}return b},_removeOldCells:function(c){var b=this._cellMap,d=this._gridLayer,f,h;for(f in b)if(b[f]){var a=b[f],e=a.latticeID,l=0,k=0;if(e)l++,e!==d.getLatticeID(c)&&(this._removeCell(null,null,e),k++);else for(h in a)a[h]&&(l++,d.intersects(a[h].extent,c)||(this._removeCell(f,h),k++));k===l&&delete b[f]}},_updateCell:function(c,b){var d=this.featureLayer,f=d.objectIdField,d=d._selectedFeatures,h,
a=b.length;c.features=c.features||[];for(h=0;h<a;h++){var e=b[h],l=e.attributes[f],k=this._addFeatureIIf(l,e);k===e?(this._incRefCount(l),c.features.push(k)):l in d||(k.setGeometry(e.geometry),k.setAttributes(e.attributes))}},_removeCell:function(c,b,d){var g=this._cellMap,f=this.featureLayer,a=f.objectIdField,e=d?g[d]:g[c]&&g[c][b];if(e)for(d?delete g[d]:delete g[c][b],c=e.features,b=0;b<c.length;b++)d=c[b].attributes[a],this._decRefCount(d),d in f._selectedFeatures||this._removeFeatureIIf(d)}});
p("extend-esri")&&f.setObject("layers._OnDemandMode",n,d);return n})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/Polyline".split(" "),function(n,k,f,r,p,d,w,m){n=n(null,{declaredClass:"esri.layers._GridLayout",constructor:function(d,f,c,b){this.origin=d;this.cellWidth=f.width;this.cellHeight=f.height;this.mapWidth=c.width;this.mapHeight=c.height;this.srInfo=b},setResolution:function(d){this._resolution=
(d.xmax-d.xmin)/this.mapWidth;this.srInfo&&(d=Math.round(Math.round(2*this.srInfo.valid[1]/this._resolution)/this.cellWidth),this._frameStats=[d,0,d-1])},setMapState:function(d,f,c){this.mapWidth=f;this.mapHeight=c;this.setResolution(d)},getCellCoordinates:function(d){var f=this._resolution,c=this.origin;return{row:Math.floor((c.y-d.y)/(this.cellHeight*f)),col:Math.floor((d.x-c.x)/(this.cellWidth*f))}},normalize:function(d){var f=this._frameStats;if(f){var c=f[0],b=f[1],f=f[2];d<b?(d%=c,d=d<b?d+c:
d):d>f&&(d%=c)}return d},intersects:function(d,k){var c=this.srInfo;return c?f.some(k._getParts(c),function(b){return d.intersects(b.extent)}):d.intersects(k)},getCellExtent:function(f,k){var c=this._resolution,b=this.origin,g=this.cellWidth,m=this.cellHeight;return new w(k*g*c+b.x,b.y-(f+1)*m*c,(k+1)*g*c+b.x,b.y-f*m*c,new d(b.spatialReference.toJson()))},getLatticeID:function(d){var f=this.getCellCoordinates({x:d.xmin,y:d.ymax}),c=this.getCellCoordinates({x:d.xmax,y:d.ymin});d=f.row;var b=c.row,
f=this.normalize(f.col),c=this.normalize(c.col);return d+"_"+b+"_"+f+"_"+c},sorter:function(d,f){return d<f?-1:1},getCellsInExtent:function(d,k){var c=this.getCellCoordinates({x:d.xmin,y:d.ymax}),b=this.getCellCoordinates({x:d.xmax,y:d.ymin}),g=c.row,p=b.row,c=c.col,b=b.col,h=[],a,e,l,q=[],n=[],r,y,t,u,w=[];for(a=g;a<=p;a++)for(e=c;e<=b;e++)l=this.normalize(e),d=this.getCellExtent(a,l),f.some(h,function(b){return b.row===a&&b.col===l})||h.push({row:a,col:l,extent:d,resolution:this._resolution}),k&&
(q.push(d.xmin,d.xmax),n.push(d.ymin,d.ymax));c=this.normalize(c);b=this.normalize(b);q.sort(this.sorter);n.sort(this.sorter);e=q.length;for(a=e-1;0<=a;a--)a<e-1&&q[a]===q[a+1]&&q.splice(a,1);e=n.length;for(a=e-1;0<=a;a--)a<e-1&&n[a]===n[a+1]&&n.splice(a,1);if(q.length&&n.length){r=q[0];y=q[q.length-1];t=n[0];u=n[n.length-1];e=q.length;for(a=0;a<e;a++)w.push([[q[a],u],[q[a],t]]);e=n.length;for(a=0;a<e;a++)w.push([[r,n[a]],[y,n[a]]]);q=new m({paths:w,spatialReference:this.origin.spatialReference.toJson()});
h.push({latticeID:g+"_"+p+"_"+c+"_"+b,lattice:q,resolution:this._resolution})}return{minRow:g,maxRow:p,minCol:c,maxCol:b,cells:h}}});r("extend-esri")&&k.setObject("layers._GridLayout",n,p);return n})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./RenderMode"],function(n,k,f,r,p){n=n([p],{declaredClass:"esri.layers._SelectionMode",constructor:function(d){this.featureLayer=d;this._featureMap={}},propertyChangeHandler:function(d){this._init&&
0===d&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)},hasAllFeatures:function(){return!this.featureLayer._hasPartialSelectedFeatures}});f("extend-esri")&&k.setObject("layers._SelectionMode",n,r);return n})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../tasks/query ../tasks/QueryTask ../geometry/jsonUtils ./RenderMode".split(" "),function(n,k,f,r,p,d,w,m,q,u){n=n([u],{declaredClass:"esri.layers._StreamMode",
constructor:function(c,b){this.featureLayer=c;this._featureMap={};this._setRefreshRate();this._drawBuffer={adds:[],updates:[]};this._timeoutId=null;this._flushDrawBuffer=k.hitch(this,this._flushDrawBuffer);this._featuresByTime={};this._lastEndTimeCheck=null;this._maxFeatureAge=0;c.purgeOptions&&c.purgeOptions.age&&"number"===typeof c.purgeOptions.age&&(this._maxFeatureAge=1E3*Math.ceil(60*c.purgeOptions.age));this._drawFeatures=k.hitch(this,this._drawFeatures);this._queryErrorHandler=k.hitch(this,
this._queryErrorHandler)},startup:function(){},propertyChangeHandler:function(c){this._init&&(0===c?this._applyTimeFilter():3===c?this._redrawAllTracks():console.debug("StreamLayer: Stream Layer only supports changing map time or maximumTrackPoints. Layer id \x3d "+this.featureLayer.id))},destroy:function(){this.inherited(arguments);clearTimeout(this._timeoutId);this._featuresByTime=this._drawBuffer=this._featureMap=null},drawFeature:function(c){var b=this.featureLayer,d=b.objectIdField;this._timeoutId||
(this._timeoutId=setTimeout(this._flushDrawBuffer,this._refreshRate));b._joinField&&this._getFeature(c.attributes[d])?this._drawBuffer.updates.push({oid:c.attributes[d],updates:c}):this._drawBuffer.adds.push(c)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var c=this.featureLayer;c&&(c._relatedUrl||c._keepLatestUrl?(c._fireUpdateStart(),c._refreshing=!0,c.disconnect(),c.clear(),c._relatedQueried=!1,c._keepLatestQueried=!1,c.connect()):(c._fireUpdateStart(),c.clear(),c._fireUpdateEnd()))},
_drawFeatures:function(c,b){this._purgeRequests();var d=this.featureLayer;d._create(c.features||[]);d._fireUpdateEnd(null,b)},_applyTimeFilter:function(c){this.inherited(arguments);this._redrawAllTracks()},_removeFeatures:function(c){var b=this.featureLayer,d=b.objectIdField;c&&f.forEach(c,function(c){c=c.attributes[d];b._unSelectFeatureIIf(c,this);this._decRefCount(c);this._removeFeatureIIf(c)},this)},_addFeatures:function(c){var b=this.featureLayer,d=b._endTimeField,k=b._startTimeField,h,a,e,l=
[],m=[],q=[];h=b._trackManager;a=b.objectIdField;if(h)for(e in c=h.addFeatures(c),c)c.hasOwnProperty(e)&&(l.push(e),c[e].adds&&(m=m.concat(c[e].adds)),c[e].deletes&&(q=q.concat(c[e].deletes)));else m=c;f.forEach(m,function(b){var c=b.attributes[a],e;e=d&&b.attributes[d];!e&&this._maxFeatureAge&&(e=k&&b.attributes[k]?b.attributes[k]+this._maxFeatureAge:Date.now()+this._maxFeatureAge);e&&(e=1E3*Math.ceil(e/1E3),this._featuresByTime[e]?this._featuresByTime[e].push(c):this._featuresByTime[e]=[c]);this._addFeatureIIf(c,
b);this._incRefCount(c)},this);q.length&&this._removeFeatures(q);h&&h.refreshTracks(l)},_updateFeatures:function(c){var b=this.featureLayer,d,k,h=[];d=b._trackManager;k=b._trackIdField;f.forEach(c,function(a){var c=a.updates;a=this._getFeature(a.oid);var g;if(a){c.geometry&&a.setGeometry(c.geometry);c=c.attributes||{};for(g in c)c.hasOwnProperty(g)&&(a.attributes[g]=c[g]);a.setAttributes(a.attributes);a.visible=this._checkFeatureTimeIntersects(a);d&&a.attributes[k]?h.push(a.attributes[k]):b._repaint(a,
null,!0)}},this);h.length&&d.refreshTracks(h)},_redrawAllTracks:function(){var c=this.featureLayer._trackManager,b;c&&(b=c.trimTracks())&&0<b.length&&(this._removeFeatures(b),c.refreshTracks())},_flushDrawBuffer:function(){clearTimeout(this._timeoutId);var c=this._drawBuffer,b=c.adds.splice(0,c.adds.length),d=c.updates.splice(0,c.updates.length),c=this.featureLayer;if(!c)return!1;c.updating||c._fireUpdateStart();this._addFeatures(b);this._updateFeatures(d);(b=this._getExpiredFeatures())&&b.length&&
(this._removeFeatures(b),c._trackManager&&c._trackManager.removeFeatures(b));c._purge();c._fireUpdateEnd();this._timeoutId=null},_clearDrawBuffer:function(){var c=this._timeoutId,b=this._drawBuffer,d=b.adds,b=b.updates;c&&clearTimeout(c);d.splice(0,d.length);b.splice(0,b.length);this._timeoutId=null},_clearTimeBin:function(){this._featuresByTime={};this._lastEndTimeCheck=1E3*Math.ceil(Date.now()/1E3)},_clearFeatureMap:function(){this._featureMap={}},_setRefreshRate:function(c){c=c||0===c?c:200;0>
c&&(c=200);this._refreshRate=c},_checkFeatureTimeIntersects:function(c){var b=this.featureLayer,d=b.getMap();return(d=d?d.timeExtent:null)&&b.timeInfo&&(b.timeInfo.startTimeField||b.timeInfo.endTimeField)?0<b._filterByTime([c],d.startTime,d.endTime).match.length:!0},_getRequestId:function(c){return("_"+c.name+c.layerId+c._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchArchive:function(c){function b(b){p++;h.execute(a).then(function(a){b(null,a)},function(a){b(a)})}function g(c,d){if(c)p>=n||!f._relatedUrl?
r._queryErrorHandler(Error("Could not get features from related feature service")):(t={relatedFeatureWarning:"Querying related feature service using the current filter failed. All related features are displayed, and the filter is applied to the stream service only"},a.where="1\x3d1",b(g));else{var e=r._fixFieldNameCasing(f,d);d.features=e;r._drawFeatures(d,t)}}var f=this.featureLayer,h,a,e,l,k;f._fireUpdateStart();if(c&&this.map){h=new m(c);a=new w;c=this.map;e=f.getFilter()||{};l=e.where||"1\x3d1";
k=e.geometry?q.fromJson(e.geometry):null;e=e.outFields?e.outFields.split(","):["*"];a.geometry=k;a.where=l;a.outFields=e;a.returnGeometry=!0;a.outSpatialReference=new d(c.spatialReference.toJson());f._usePatch&&(c=this._getRequestId(f),this._cancelPendingRequest(null,c));var p=0,n=2,r=this,t=null;b(g)}else return this._fireUpdateEnd({error:"Archive data cannot be fetched if no feature service url is provided or if the layer is not added to a map"}),!1},_queryErrorHandler:function(c){this._purgeRequests();
var b=this.featureLayer;b._errorHandler(c);b._fireUpdateEnd(c)},_fixFieldNameCasing:function(c,b){var d=b.features||[],f=b.fields;if(!f||!d.length)return d;for(var f=this._mapFieldNameDifferences(c.fields,f),h=[],a,e,l=0,k=b.features.length;l<k;l++)a=d[l],e=this._swizzleResponseAttributes(a.attributes,f),h.push({geometry:a.geometry,attributes:e});return h},_mapFieldNameDifferences:function(c,b){var d=[],f={},h,a;h=0;for(a=b.length;h<a;h++)d.push(b[h].name);h=0;for(a=c.length;h<a;h++){var e=c[h].name,
l=this._checkForStreamFieldName(e,d);l&&(f[l]=e)}return f},_checkForStreamFieldName:function(c,b){for(var d=c.toLowerCase(),f,h=0,a=b.length;h<a;h++)if(b[h].toLowerCase()===d){f=b[h];break}return f},_swizzleResponseAttributes:function(c,b){var d={},f;for(f in c)if(c.hasOwnProperty(f)){var h=c[f];b.hasOwnProperty(f)?d[b[f]]=h:d[f]=h}return d},_getExpiredFeatures:function(){var c,b,d,k=[],h=[];if(!this.featureLayer._endTimeField&&!this._maxFeatureAge)return h;c=1E3*Math.floor(this._lastEndTimeCheck/
1E3);this._lastEndTimeCheck=b=1E3*Math.ceil(Date.now()/1E3);if(c&&c!==b)for(d=this._featuresByTime;c<=b;c+=1E3)d[c]&&(k=k.concat(d[c]),delete d[c]);f.forEach(k,function(a){(a=this._getFeature(a))&&h.push(a)},this);return h}});r("extend-esri")&&k.setObject("layers._StreamMode",n,p);return n})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/dom-construct dojox/gfx ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),function(n,
k,f,r,p,d,w,m,q,u){var c=-1!==d.renderer.toLowerCase().indexOf("canvas");n=n(null,{declaredClass:"esri.layers._TrackManager",constructor:function(b){this.layer=b;this.trackMap={};this.trackLineMap={}},initialize:function(b){this.map=b;var d=this.layer,f=d._getRenderer(),f=f&&f.trackRenderer;if("esriGeometryPoint"===d.geometryType){var h=this.container=new u._GraphicsLayer({id:d.id+"_tracks",_child:!0,visible:d.visible,minScale:d.minScale,maxScale:d.maxScale});h.loaded=!0;h.onLoad(h);h._setMap(b,d._div);
if(!c){b=h._div.getNode();var a=d._div.getNode();b&&a&&p.place(b,a,"first")}h.setRenderer(f);d.on("visibility-change",k.hitch(this,function(a){this.container.setVisibility(a.visible);this.container.evaluateSuspension()}));d.on("scale-range-change",k.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)}))}},addFeatures:function(b){var c=this.trackMap,d=this.layer,h=d._trackIdField,a=[];f.forEach(b,function(b){var d=b.attributes[h];(c[d]=c[d]||[]).push(b);-1===
f.indexOf(a,d)&&a.push(d)});var e=d._startTimeField,l=d.objectIdField,k=function(a,b){var c=a.attributes[e],d=b.attributes[e];return c===d?a.attributes[l]<b.attributes[l]?-1:1:c<d?-1:1};f.forEach(a,function(a){c[a].sort(k)})},trimTracks:function(b){function c(b){for(b=d[b]||[];b.length>h;)a.push(b.shift())}var d=this.trackMap,h=this.layer.maximumTrackPoints||0,a=[],e;if(!h)return a;if(b)f.forEach(b,function(a){c(a)});else for(e in d)d.hasOwnProperty(e)&&c(e);return a},drawTracks:function(b){function c(b){var c=
a[b],f,g,l;g=d.trackLineMap[b];h.remove(g);delete d.trackLineMap[b];g=null;if(!c||2>c.length)return!1;g=[];for(f=c.length-1;0<=f;f--)(l=c[f].geometry)&&g.push([l.x,l.y]);c={};c[k]=b;1<g.length&&(g=new m(new q({paths:[g],spatialReference:e}),null,c),h.add(g),d.trackLineMap[b]=g)}var d=this,h=this.container,a,e,k,p;if(h)if(a=this.trackMap,e=this.map.spatialReference,k=this.layer._trackIdField,b)f.forEach(b,function(a){c(a)});else for(p in a)a.hasOwnProperty(p)&&c(p)},refreshTracks:function(b){function c(b){var c,
f;d.drawTracks([b]);if(e&&e.latestObservationRenderer)for(b=h[b]||[],c=b.length,f=0;f<c;f++)a._repaint(b[f],null,!0)}var d=this,h=this.trackMap,a=this.layer,e=a._getRenderer(),k;if(b)f.forEach(b,function(a){c(a)});else for(k in h)h.hasOwnProperty(k)&&c(k);this.moveLatestToFront()},moveLatestToFront:function(b){f.forEach(this.getLatestObservations(b),function(b){var c=b._shape;c&&c._moveToFront();this._repaint(b,null,!0)},this.layer)},getLatestObservations:function(b){function c(b){b=a[b];return b[b.length-
1]}var d=[],h=this.layer._getRenderer(),a=this.trackMap,e;if(!h.latestObservationRenderer)return d;if(b)f.forEach(b,function(a){d.push(c(a))});else for(e in a)a.hasOwnProperty(e)&&d.push(c(e));return d},clearTracks:function(b){var c=this.getLatestObservations(b),d=this.container,h;b?f.forEach(b,function(a){delete this.trackMap[a];d&&(h=this.trackLineMap[a],d.remove(h),delete this.trackLineMap[a])},this):(this.trackMap={},this.trackLineMap={},d&&d.clear());f.forEach(c,function(a){this._repaint(a,null,
!0)},this.layer)},isLatestObservation:function(b){var c=this.trackMap[b.attributes[this.layer._trackIdField]];return c?c[c.length-1]===b:!1},destroy:function(){var b=this.container;b&&(b.clear(),b._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});r("extend-esri")&&k.setObject("layers._TrackManager",n,w);return n})},"esri/layers/HeatmapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/_base/array require ../kernel ../sniff ../geometry/Point ../geometry/webMercatorUtils ./MapImage ../renderers/HeatmapRenderer ../tasks/query dojo/_base/fx".split(" "),
function(n,k,f,r,p,d,w,m,q,u,c,b,g){function x(){}function h(a){var b=a.layer;return{geometry:a.geometry,attributes:a.attributes,getLayer:function(){return b}}}n=n(null,{declaredClass:"esri.layers.HeatmapManager",heatmapRenderer:null,sourceLayer:null,imageLayer:null,useTiles:!0,useWorker:!1,map:null,constructor:function(a){this.sourceLayer=a;this._hndls=[]},initialize:function(a){this.map=a;var b=this.sourceLayer,d=b.renderer;b.setDrawMode(!1);this.imageLayer=a._getMapImageLyr();var f=this;this.heatmapRenderer=
d instanceof c?d:(d.getRendererInfoByZoom(a.getZoom())||d.getRendererInfoByScale(a.getScale())).renderer;this._setupDraw=this._setupDraw.bind(this);this.recalculateHeatmap=this.recalculateHeatmap.bind(this);this._removeRenderer=this._removeRenderer.bind(this);this._handleRendererChange=this._handleRendererChange.bind(this);this._rendererChangeHandle=this.sourceLayer.on("renderer-change",this._handleRendererChange);this._handleOpacityChange=this._handleOpacityChange.bind(this);this._reprojectFeature=
this._reprojectFeature.bind(this);p(["../workers/heatmapCalculator"],function(a){f._calculator=new a(k.mixin({width:f.map.width,height:f.map.height},f._getOptions()));f._setupRenderer();f.heatmapRenderer.getStats=a.calculateStats;f.heatmapRenderer.getHistogramData=a.getHistogramData})},destroy:function(){this._removeHandlers();this._rendererChangeHandle&&this._rendererChangeHandle.remove();this._rendererChangeHandle=this.sourceLayer=this.imageLayer=this.map=this.heatmapRenderer=this._hndls=null},
_handleRendererChange:function(a){var b=a.renderer,d=b instanceof c;this.heatmapRenderer?d?this.heatmapRenderer=b:this._removeRenderer(a):d&&(this.heatmapRenderer=b,this.sourceLayer&&this.map&&this._setupRenderer())},_handleOpacityChange:function(a){a=a.opacity;var b=this._getImageBySourceId(this.sourceLayer.id);b&&b.setOpacity(a)},_setupRenderer:function(){var a=this._hndls,b=this.sourceLayer,c=this.map,d=this;b._originalDraw=b._draw;b._draw=x;b._div.clear();clearTimeout(this._resetTimer);this._resetTimer=
setTimeout(this._resetGraphics.bind(this),250);a.push(b.on("update-end",this._setupDraw));a.push(b.on("suspend",function(a){(a=d._getImageBySourceId(d.sourceLayer.id))&&a.hide()}));a.push(b.on("resume",function(a){(a=d._getImageBySourceId(d.sourceLayer.id))&&a.show()}));a.push(f.after(b,"redraw",this._setupDraw));a.push(c.on("layer-remove",function(a){a.layer==b&&((a=d._getImageBySourceId(d.sourceLayer.id))&&d.imageLayer.removeImage(a),d._removeRenderer({target:b}))}));b._collection&&a.push(b.on("graphic-add",
function(a){d._reprojectFeature(a.graphic);d._setupDraw()}));1!==b.mode&&(a.push(c.on("resize, pan-end",this._setupDraw)),a.push(c.on("zoom-end",this._setupDraw)));a.push(b.on("opacity-change",this._handleOpacityChange));this.imageLayer.suspended&&this.imageLayer.resume();b.graphics&&b.graphics.length&&(b.graphics[0].geometry&&!c.spatialReference.equals(b.graphics[0].geometry.spatialReference)&&r.forEach(b.graphics,function(a){this._reprojectFeature(a)}.bind(this)),this._setupDraw())},_setupDraw:function(){if(!this._drawTimer){var a=
this;this._drawTimer=setTimeout(function(){clearTimeout(a._drawTimer);a._drawTimer=null;a.sourceLayer._getRenderer().isInstanceOf(c)&&a.recalculateHeatmap()},16)}},_removeRenderer:function(a){var b=a.target;b._draw=b._originalDraw;delete b._originalDraw;b.setDrawMode(!0);this._removeHandlers();this._hndls=[];var c=this._getImageBySourceId(this.sourceLayer.id);c&&this.imageLayer.removeImage(c);clearTimeout(this._drawTimer);clearTimeout(this._resetTimer);this._drawTimer=this._resetTimer=null;b.renderer!=
a.renderer&&b.renderer.getRendererInfo?this.heatmapRenderer=null:(b.redraw(),this.destroy())},recalculateHeatmap:function(){this._calculator?this._doMainCalculation():this._calculatorClient&&this._doWorkerCalculation()},_reprojectFeature:function(a){if(a&&a.geometry){var b=a.geometry,c=this.map.spatialReference;c.equals(b.spatialReference)||(b=q.project(b,c),null==b?console.log("Unable to reproject features to map's spatial reference. Please convert feature geometry before adding to layer"):a.geometry=
b)}},_doWorkerCalculation:function(){},_doMainCalculation:function(){var a=this.sourceLayer,c=this.map,d=this.heatmapRenderer,f=this.map.extent,g=this.map.width,m=this.map.height,p=this._calculator,q=this,n=function(b){b=q._getScreenPoints(b.features,c,a);b=p.calculateImageData(k.mixin({screenPoints:b,mapinfo:{extent:[f.xmin,f.ymin,f.xmax,f.ymax],resolution:c.getResolution()},width:g,height:m},q._getOptions()));b=d.getSymbol(h({geometry:c.extent,attributes:{size:[g,m],imageData:b},layer:a}));b=new u({extent:c.extent,
href:b.url,opacity:0,sourceId:a.id});q._swapMapImages(b,q._getImageBySourceId(a.id));a.suspended&&b.hide()},r={geometry:c.extent,timeExtent:a.useMapTime?c.timeExtent:void 0,spatialRelationship:b.SPATIAL_REL_INTERSECTS};null!=a._canDoClientSideQuery(r)?a.queryFeatures(r,n):n({features:a.graphics})},_getScreenPoints:function(a,b,c){var d=[],e=a.length,f=0,g=0,h,k=new m(b.extent.xmin,b.extent.ymax,b.spatialReference),l=b.toScreen(k),q=l.x,l=l.y,p=b.getResolution(),n;for((g=b.extent.getCacheValue("_parts"))&&
(n=r.map(g,function(a){return c._intersects(b,a.extent)[0]}));e--;)g=a[e],g.geometry&&(h={x:Math.ceil((g.geometry.x-k.x)/p+q),y:Math.floor((k.y-g.geometry.y)/p-l),attributes:g.attributes},n&&(g=1<n.length&&h.x<-n[0]?n[1]:n[0],h.x+=g),d[f++]=h);return d},_getImageBySourceId:function(a){var b=this.imageLayer.getImages(),b=r.filter(b,function(b){return b.sourceId==a});if(b.length)return b[b.length-1]},_swapMapImages:function(a,b){function c(){d.removeImage(b)}var d=this.imageLayer,e=this.sourceLayer.opacity;
d.addImage(a);g.anim(a._node,{opacity:e},null,null,function(){a.opacity=e});null!=b&&g.anim(b._node,{opacity:0},null,null,c)},_removeHandlers:function(){if(null!=this._hndls)for(var a=this._hndls.length;a--;)this._hndls[a].remove()},_getOptions:function(){var a=this.heatmapRenderer;return{blurRadius:a.blurRadius,gradient:a.gradient,maxPixelIntensity:a.maxPixelIntensity,minPixelIntensity:a.minPixelIntensity,field:a.field,fieldOffset:a.fieldOffset}},_resetGraphics:function(){clearTimeout(this._resetTimer);
this._resetTimer=null;for(var a=this.sourceLayer.graphics,b=a.length,c;b--;)c=a[b],c._shape=c._offsets=void 0}});w("extend-esri")&&k.setObject("layers.HeatmapManager",n,d);return n})},"*noref":1}});
define("esri/arcgis/utils","require dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/on dojo/DeferredList dojo/dom-construct dojo/sniff ../kernel ../config ../Color ../lang ../request ../SpatialReference ../map ../urlUtils ../geometry/ScreenPoint ../geometry/Extent ../geometry/webMercatorUtils ../symbols/jsonUtils ../renderers/jsonUtils ../dijit/PopupTemplate ../dijit/Popup ../tasks/query ../tasks/GeometryService ../layers/ArcGISTiledMapServiceLayer ../layers/FeatureLayer dojo/i18n!../nls/jsapi".split(" "),function(n,
k,f,r,p,d,w,m,q,u,c,b,g,x,h,a,e,l,v,z,A,y,t,C,D,M,Q,ha,ra,K,R){function S(b){return a({url:J.arcgisUrl+"/"+b.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function da(b,c){var d={f:"json"};c&&(d.token=c);return a({url:b,content:d,callbackParamName:"callback"},{disableIdentityLookup:!0})}function aa(a){!a.layerDefinition||a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.labelingInfo||(a.showLabels=!1);a.itemProperties.layerDefinition&&
(a.layerDefinition?(a.layerDefinition.drawingInfo||(a.layerDefinition.drawingInfo=a.itemProperties.layerDefinition.drawingInfo),h.isDefined(a.layerDefinition.definitionExpression)||(a.layerDefinition.definitionExpression=a.itemProperties.layerDefinition.definitionExpression),h.isDefined(a.layerDefinition.minScale)||(a.layerDefinition.minScale=a.itemProperties.layerDefinition.minScale),h.isDefined(a.layerDefinition.maxScale)||(a.layerDefinition.maxScale=a.itemProperties.layerDefinition.maxScale)):
a.layerDefinition=a.itemProperties.layerDefinition);!a.itemProperties.popupInfo||a.popupInfo||a.disablePopup||(a.popupInfo=a.itemProperties.popupInfo);h.isDefined(a.itemProperties.showLabels)&&!h.isDefined(a.showLabels)&&(a.showLabels=a.itemProperties.showLabels);h.isDefined(a.itemProperties.showLegend)&&!h.isDefined(a.showLegend)&&(a.showLegend=a.itemProperties.showLegend);h.isDefined(a.itemProperties.refreshInterval)&&!h.isDefined(a.refreshInterval)&&(a.refreshInterval=a.itemProperties.refreshInterval)}
function ia(a){aa(a);a.itemProperties.layerDefinition&&a.layerDefinition&&(!h.isDefined(a.layerDefinition.maximumTrackPoints)&&h.isDefined(a.itemProperties.layerDefinition.maximumTrackPoints)&&(a.layerDefinition.maximumTrackPoints=a.itemProperties.layerDefinition.maximumTrackPoints),!a.layerDefinition.definitionGeometry&&a.itemProperties.layerDefinition.definitionGeometry&&(a.layerDefinition.definitionGeometry=a.itemProperties.layerDefinition.definitionGeometry));a.itemProperties.purgeOptions&&!a.purgeOptions&&
(a.purgeOptions=a.itemProperties.purgeOptions)}function X(a,b){var c=new p,d=a.itemData,e=[],E=[];f.forEach(d.operationalLayers,function(a){if(a.itemId&&!a.type){var b=a.url.toLowerCase();-1<b.indexOf("/featureserver")||-1<b.indexOf("/mapserver/")?(E.push(a),e.push(S(a))):-1<b.indexOf("/mapserver")&&-1===b.indexOf("/mapserver/")&&(!a.layers||!h.isDefined(a.minScale)&&!h.isDefined(a.maxScale))?(E.push(a),e.push(S(a))):-1<b.indexOf("/imageserver")&&!h.isDefined(a.minScale)&&!h.isDefined(a.maxScale)?
(E.push(a),e.push(S(a))):-1<b.indexOf("/streamserver")&&(E.push(a),e.push(S(a)))}});d.baseMap&&d.baseMap.baseMapLayers&&f.forEach(d.baseMap.baseMapLayers,function(a){a.itemId&&"VectorTileLayer"!==a.layerType&&(E.push(a),e.push(S(a)))});if(0<e.length){var g={};(new q(e)).addCallback(function(b){f.forEach(E,function(a,c){var d=b[c][1];if(d&&!(d instanceof Error)&&(g[a.itemId]=d,!a.type)){var e=a.url.toLowerCase();(-1<e.indexOf("/featureserver")||-1<e.indexOf("/mapserver/"))&&d.layers?f.forEach(d.layers,
function(b){var c="/featureserver/"+b.id;(c=e.match(c+"$")==c)||(c="/mapserver/"+b.id,c=e.match(c+"$")==c);c&&(a.itemProperties=b,aa(a))}):-1<e.indexOf("/streamserver")?(a.itemProperties=d,ia(a)):-1<e.indexOf("/mapserver")?(d.layers&&!a.layers&&(a.layers=d.layers),h.isDefined(d.minScale)&&!h.isDefined(a.minScale)&&(a.minScale=d.minScale),h.isDefined(d.maxScale)&&!h.isDefined(a.maxScale)&&(a.maxScale=d.maxScale),h.isDefined(d.refreshInterval)&&!h.isDefined(a.refreshInterval)&&(a.refreshInterval=d.refreshInterval),
d.visibleLayers&&!a.visibleLayers&&(a.visibleLayers=d.visibleLayers)):-1<e.indexOf("/imageserver")&&(h.isDefined(d.minScale)&&!h.isDefined(a.minScale)&&(a.minScale=d.minScale),h.isDefined(d.maxScale)&&!h.isDefined(a.maxScale)&&(a.maxScale=d.maxScale),h.isDefined(d.refreshInterval)&&!h.isDefined(a.refreshInterval)&&(a.refreshInterval=d.refreshInterval),!d.popupInfo||a.popupInfo||a.disablePopup||(a.popupInfo=d.popupInfo),d.renderingRule&&!a.renderingRule&&(a.renderingRule=d.renderingRule,d.renderingRule.functionName&&
(a.renderingRule.rasterFunction=d.renderingRule.functionName)),d.bandIds&&!a.bandIds&&(a.bandIds=d.bandIds),d.mosaicRule&&!a.mosaicRule&&(a.mosaicRule=d.mosaicRule),d.format&&!a.format&&(a.format=d.format),h.isDefined(d.compressionQuality)&&!h.isDefined(a.compressionQuality)&&(a.compressionQuality=d.compressionQuality),!d.layerDefinition||!d.layerDefinition.definitionExpression||h.isDefined(a.layerDefinition)&&h.isDefined(a.layerDefinition.definitionExpression)||(a.layerDefinition=a.layerDefinition||
{},a.layerDefinition.definitionExpression=d.layerDefinition.definitionExpression))}});a.relatedItemsData=g;c.callback(a)})}else c.callback(a);return c}function H(a,c){var d=new p,e=a.itemData,f=e.baseMap.baseMapLayers[0];if("BingMapsAerial"===f.type||"BingMapsRoad"===f.type||"BingMapsHybrid"===f.type)if(f.portalUrl&&b.id)delete c.bingMapsKey,b.id.checkSignInStatus(v.urlToObject(J.arcgisUrl).path).then(k.hitch(null,function(a,b,c,d,e){da(f.portalUrl,e.token).then(k.hitch(null,L,a,b,c,d),k.hitch(null,
I,a,b,c,d))},a,c,e,d),k.hitch(null,function(a,b,c,d,e){da(f.portalUrl).then(k.hitch(null,L,a,b,c,d),k.hitch(null,I,a,b,c,d))},a,c,e,d));else if(c.bingMapsKey){var g=new W({bingMapsKey:c.bingMapsKey,mapStyle:W.MAP_STYLE_AERIAL});r.connect(g,"onLoad",k.hitch(this,function(){d.callback([a,c])}));r.connect(g,"onError",function(b){delete c.bingMapsKey;a.itemData=T(e);f=a.itemData.baseMap.baseMapLayers[0];f.errors=[];f.errors.push({message:"The owner of the application has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});
d.callback([a,c])})}else a.itemData=T(e),f=a.itemData.baseMap.baseMapLayers[0],f.errors=[],f.errors.push({message:"The owner of the application has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."}),d.callback([a,c]);else d.callback([a,c]);return d}function F(a){var b=new p,c,d;a=a.itemData;var e=a.baseMap&&a.baseMap.baseMapLayers;if(qa&&!qa.supported())for(a=0;a<e.length;a++){var f=e[a];if(!f.isReference){"VectorTileLayer"===f.layerType&&(c=f.itemId,d=a);break}}c?
ta(c,!1).addBoth(function(a){var c=/^https?:\/\/basemaps(dev)?\.arcgis\.com\/arcgis\/rest\/services\/World_Basemap\/VectorTileServer/i;a&&a.item&&c.test(a.item.url)&&(e[d]={id:"FB_"+f.id,layerType:"ArcGISTiledMapServiceLayer",opacity:"opacity"in f?f.opacity:1,visibility:"visibility"in f?f.visibility:!0,url:"http://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer"});b.resolve()}):b.resolve();return b}function L(a,b,c,d,e){e.bingKey?(b.bingMapsKey=e.bingKey,e=new W({bingMapsKey:b.bingMapsKey,
mapStyle:W.MAP_STYLE_AERIAL}),r.connect(e,"onLoad",k.hitch(this,function(){d.callback([a,b])})),r.connect(e,"onError",function(e){delete b.bingMapsKey;a.itemData=T(c);e=a.itemData.baseMap.baseMapLayers[0];e.errors=[];e.errors.push({message:"The owner of the map has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});d.callback([a,b])})):I(a,b,c,d)}function I(a,b,c,d){delete b.bingMapsKey;a.itemData=T(c);c=a.itemData.baseMap.baseMapLayers[0];c.errors=[];c.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."});
d.callback([a,b])}function T(a){a.baseMap="BingMapsAerial"===a.baseMap.baseMapLayers[0].type?{title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,opacity:1,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:"BingMapsRoad"===a.baseMap.baseMapLayers[0].type?{title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:{title:"Imagery with Labels",
baseMapLayers:[{id:"World_Imagery_6611",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},{id:"World_Boundaries_and_Places_1145",isReference:!0,opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]};return a}function V(a,b,c,d){var e=a.dynamicLayerInfos||a.layerInfos,g=b.layers;if(g&&e)if(d.usePopupManager){var E;f.forEach(e,function(a){var b=a.id;if(!a.subLayerIds)for(a=
0;a<g.length;a++){var d=g[a];if(d.id===b&&d.popupInfo){E||(E={});E[b]={infoTemplate:new c(d.popupInfo),layerUrl:d.layerUrl};break}}});E&&a.setInfoTemplates(E)}else{var k=[],l=[],m=[],q=[],p=[],n=[];f.forEach(e,function(b){var c=b.id;if(!b.subLayerIds&&-1!==f.indexOf(a.visibleLayers,c))for(b=0;b<g.length;b++){var d=g[b];if(d.id===c){l.push(c);k.push(d.popupInfo);m.push(d.layerUrl||"");d.layerDefinition&&d.layerDefinition.definitionExpression?q.push(d.layerDefinition.definitionExpression):q.push("");
p.push(h.isDefined(d.minScale)?d.minScale:null);n.push(h.isDefined(d.maxScale)?d.maxScale:null);break}}});k.length&&(a.__popups=k,a.__popupIds=l,a.__popupUrls=m,a.__popupWhereClauses=q,a.__popupMinScales=p,a.__popupMaxScales=n,a.__resourceInfo=b.resourceInfo)}}function O(a){if(!a)return!1;var b=(new w(J.arcgisUrl)).authority;return-1!==a.indexOf(".arcgis.com/")||-1!==a.indexOf(b)}function Z(a){return a?-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/"):!1}function N(a){"https:"===
location.protocol&&(O(a)||Z(a))&&(a=a.replace("http:","https:"));return a}function ea(a,b,c){var d=[],e;a.displayLevels||(d=f.map(a.resourceInfo.tileInfo.lods,function(a){return a.level}));a.exclusionAreas&&(e=k.clone(a.exclusionAreas),e=f.map(e,function(a){a.geometry=new A(a.geometry);return a}));d=new ra(N(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,displayLevels:a.displayLevels||d,id:a.id,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval,exclusionAreas:e});
c.ignorePopups||V(d,a,b,c);return d}function fa(a,b){if(!a||!b||0===b.length)return[];var c=","+b+",",d=[],e,f=",";for(e=0;e<a.length;e++)if(null!==a[e].subLayerIds){if(-1===c.indexOf(","+a[e].id+",")||-1<f.indexOf(","+a[e].id+","))f+=a[e].subLayerIds.toString()+","}else-1<c.indexOf(","+a[e].id+",")&&-1===f.indexOf(","+a[e].id+",")&&d.push(a[e].id);return d}function ja(a,b,c){var d=new Ha;d.format="png24";a.resourceInfo&&a.resourceInfo.supportedImageFormatTypes&&-1<a.resourceInfo.supportedImageFormatTypes.indexOf("PNG32")&&
(d.format="png32");var d=new Ia(N(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageParameters:d,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval}),e=a.visibleLayers;if(!a.visibleLayers){var g="";f.forEach(d.layerInfos,function(a){a.defaultVisibility&&(g+=(0<g.length?",":"")+a.id)});e=g}if(a.layers&&0<a.layers.length){var h=[],E=[],l,m=[],q,p;f.forEach(a.layers,function(b){b.layerDefinition&&b.layerDefinition.definitionExpression&&(h[b.id]=
b.layerDefinition.definitionExpression);if(b.layerDefinition&&b.layerDefinition.source){l=null;p=b.layerDefinition.source;if("mapLayer"===p.type){var c=f.filter(a.resourceInfo.layers,function(a){return a.id===p.mapLayerId});c.length&&(l=k.mixin(c[0],b))}else l=k.mixin({},b);l&&(l.source=p,delete l.popupInfo,l=new Ja(l),a.visibleLayers&&(c="string"==typeof a.visibleLayers?a.visibleLayers.split(","):a.visibleLayers,-1<f.indexOf(c,b.id)?l.defaultVisibility=!0:l.defaultVisibility=!1),E.push(l))}b.layerDefinition&&
b.layerDefinition.source&&b.layerDefinition.drawingInfo&&(q=new Ka(b.layerDefinition.drawingInfo),m[b.id]=q)},this);0<h.length&&d.setLayerDefinitions(h);0<E.length?(d.setDynamicLayerInfos(E,!0),0<m.length&&d.setLayerDrawingOptions(m,!0)):(e=fa(d.layerInfos,e),d.setVisibleLayers(e))}else e=fa(d.layerInfos,e),d.setVisibleLayers(e);c.ignorePopups||V(d,a,b,c);return d}function ka(a,b,c){var d=new La;d.bandIds=a.bandIds;null!=a.format&&(d.format=a.format,null!=a.compressionQuality&&(d.compressionQuality=
a.compressionQuality));if(a.renderingRule&&a.renderingRule.rasterFunction){var e=new Ma(a.renderingRule);d.renderingRule=e}a.mosaicRule&&(e=new Na(a.mosaicRule),d.mosaicRule=e);h.isDefined(a.noData)&&(d.noData=a.noData);h.isDefined(a.noDataInterpretation)&&(d.noDataInterpretation=a.noDataInterpretation);h.isDefined(a.interpolation)&&(d.interpolation=a.interpolation);e=a.layerType?"ArcGISImageServiceVectorLayer"===a.layerType:!1;h.isDefined(a.layerType)||(e=a.resourceInfo.hasMultidimensions&&("esriImageServiceDataTypeVector-UV"===
a.resourceInfo.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===a.resourceInfo.serviceDataType));d={resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageServiceParameters:d,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval};d=e?new Oa(N(a.url),d):new Pa(N(a.url),d);a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(e=C.fromJson(a.layerDefinition.drawingInfo.renderer),d.setRenderer(e)),a.layerDefinition.definitionExpression&&
d.setDefinitionExpression(a.layerDefinition.definitionExpression,!0));!c.ignorePopups&&a.popupInfo&&d.setInfoTemplate(new b(a.popupInfo));return d}function ba(a,b,c){var d=[102113,102100,3857],g=c||new e(b[0].layerObject.fullExtent.spatialReference),k=new e(a.resourceInfo.fullExtent.spatialReference);return g.wkt==k.wkt&&(g.wkid==k.wkid||h.isDefined(g.latestWkid)&&g.latestWkid==k.wkid||h.isDefined(k.latestWkid)&&g.wkid==k.latestWkid||h.isDefined(g.latestWkid)&&g.latestWkid==k.latestWkid)||g.wkid&&
k.wkid&&f.some(d,function(a){return a===k.wkid})&&f.some(d,function(a){return a===g.wkid})?!0:!1}function ga(a,b,c){if(!b[0].layerObject.tileInfo)return!1;a=a.resourceInfo.tileInfo;b=b[0].layerObject.tileInfo;c=c.width>c.height?c.width:c.height;for(var d=!1,e=!1,f=0;f<a.lods.length;f++){for(var g=a.lods[f].scale/a.dpi,h=0;h<b.lods.length;h++){var k=b.lods[h].scale/b.dpi;if(Math.abs(k-g)/k<1/c)if(d){e=!0;break}else d=!0}if(e)break}return e||d&&(1===a.lods.length||1===b.lods.length)?!0:!1}function la(a,
c,g,l,q,p){var n,E,U=g._clazz;if("OpenStreetMap"===a.type)n=new Qa({id:a.id,opacity:a.opacity,visible:null!==a.visibility&&void 0!==a.visibility?a.visibility:!0});else if("WFS"===a.type)l={customParameters:a.wfsInfo.customParameters,geometryType:a.layerDefinition.geometryType,id:a.id,labelingInfo:a.layerDefinition.drawingInfo.labelingInfo,maxFeatures:a.wfsInfo.maxFeatures,mode:a.mode,name:a.wfsInfo.name,showLabels:!0,swapXY:a.wfsInfo.swapXY,title:a.title,url:a.url,version:a.wfsInfo.version,visible:a.visibility,
wkid:a.layerDefinition.spatialReference.wkid},n=new Ra,n.fromJson(l,function(){h.isDefined(a.opacity)&&n.setOpacity(a.opacity);h.isDefined(a.visibility)&&n.setVisibility(a.visibility);(a.minScale||a.maxScale)&&n.setScaleRange(a.minScale,a.maxScale);n.renderer=C.fromJson(a.layerDefinition.drawingInfo.renderer);!g.ignorePopups&&a.popupInfo&&n.setInfoTemplate(new U(a.popupInfo));n.emit("fromJsonComplete")});else if("WMS"===a.type){var u=[],Ga=[];f.forEach(a.layers,function(a){Ga.push(new Sa({name:a.name,
title:a.title,legendURL:a.legendURL,queryable:a.queryable,showPopup:a.showPopup}));u.push(a.name)},this);a.visibleLayers&&(u=a.visibleLayers);l=new A(a.extent[0][0],a.extent[0][1],a.extent[1][0],a.extent[1][1],new e({wkid:4326}));l={customLayerParameters:a.customLayerParameters,customParameters:a.customParameters,extent:l,layerInfos:Ga,version:a.version,maxWidth:a.maxWidth,maxHeight:a.maxHeight,featureInfoFormat:a.featureInfoFormat,getFeatureInfoURL:a.featureInfoUrl,getMapURL:a.mapUrl,spatialReferences:a.spatialReferences,
title:a.title,copyright:a.copyright,minScale:a.minScale||0,maxScale:a.maxScale||0,format:a.format};n=new Ta(a.url,{id:a.id,visibleLayers:u,format:"png",transparent:a.firstLayer?!1:!0,opacity:a.opacity,visible:null!==a.visibility?a.visibility:!0,resourceInfo:l,refreshInterval:a.refreshInterval});n.spatialReference.wkid=l.spatialReferences[0]}else if("KML"===a.type){E=a.url;if(b.id){var ca=b.id.findCredential(v.urlToObject(J.arcgisUrl).path);ca&&(c=J.arcgisUrl.substring(J.arcgisUrl.indexOf("//")+2,
J.arcgisUrl.indexOf("/",J.arcgisUrl.indexOf("//")+3)),q=c.split("."),q=q[q.length-2]+"."+q[q.length-1],p=E.indexOf(q),-1<p&&(E="https://"+c+E.substring(p+q.length),E+="?token\x3d"+ca.token))}n=new Ua(E,{id:a.id,visible:null!==a.visibility?a.visibility:!0,outSR:l,refreshInterval:a.refreshInterval});r.connect(n,"onLoad",function(){(a.opacity||0===a.opacity)&&n.setOpacity(a.opacity);h.isDefined(a.minScale)&&h.isDefined(a.maxScale)&&n.setScaleRange(a.minScale,a.maxScale);a.visibleFolders&&f.forEach(n.folders,
function(b){-1<f.indexOf(a.visibleFolders,b.id)?n.setFolderVisibility(b,!0):n.setFolderVisibility(b,!1)},this)})}else if("WebTiledLayer"===a.type){if(n=new Va(a.templateUrl,{id:a.id,visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent&&new A(a.fullExtent),initialExtent:a.fullExtent&&new A(a.fullExtent),subDomains:a.subDomains,tileInfo:a.tileInfo?new Wa(a.tileInfo):null,refreshInterval:a.refreshInterval,wmtsInfo:a.wmtsInfo}),h.isDefined(a.minScale)||
h.isDefined(a.maxScale))n.loaded?n.setScaleRange(a.minScale,a.maxScale):r.connect(n,"onLoad",function(){n.setScaleRange(a.minScale,a.maxScale)})}else"GeoRSS"===a.type?(n=new Xa(a.url,{id:a.id,opacity:a.opacity,outSpatialReference:l,refreshInterval:a.refreshInterval}),r.connect(n,"onLoad",function(){!1===a.visibility&&n.hide();h.isDefined(a.minScale)&&h.isDefined(a.maxScale)&&n.setScaleRange(a.minScale,a.maxScale);var b=n.getFeatureLayers();f.forEach(b,function(c){a.pointSymbol&&"esriGeometryPoint"===
c.geometryType?(c.renderer.symbol=t.fromJson(a.pointSymbol),1===b.length&&(n.pointSymbol=t.fromJson(a.pointSymbol))):a.lineSymbol&&"esriGeometryPolyline"===c.geometryType?(c.renderer.symbol=t.fromJson(a.lineSymbol),1===b.length&&(n.polylineSymbol=t.fromJson(a.lineSymbol))):a.polygonSymbol&&"esriGeometryPolygon"===c.geometryType&&(c.renderer.symbol=t.fromJson(a.polygonSymbol),1===b.length&&(n.polygonSymbol=t.fromJson(a.polygonSymbol)))})})):"CSV"==a.type&&a.url?(l={layerDefinition:a.layerDefinition,
columnDelimiter:a.columnDelimiter,id:a.id?a.id:null,visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,refreshInterval:a.refreshInterval},a.locationInfo&&(l.latitudeFieldName=a.locationInfo.latitudeFieldName,l.longitudeFieldName=a.locationInfo.longitudeFieldName),g.ignorePopups||(l.infoTemplate=new D(a.popupInfo?a.popupInfo:Ya.generateDefaultPopupInfo(a))),n=new Za(a.url,l)):"VectorTileLayer"===a.layerType&&a.styleUrl?n=new qa(a.styleUrl,{id:a.id,minScale:a.minScale,maxScale:a.maxScale,
opacity:a.opacity,visible:a.visibility}):a.layerDefinition&&!a.url?(l=d.fromJson(d.toJson(a)),delete l.id,delete l.opacity,delete l.visibility,n=new K(l,{id:a.id,opacity:a.opacity,visible:a.visibility,outFields:["*"],autoGeneralize:!0}),!g.ignorePopups&&l.popupInfo&&n.setInfoTemplate(new U(l.popupInfo)),ua(n)):"BingMapsAerial"===a.type||"BingMapsRoad"===a.type||"BingMapsHybrid"===a.type?g.bingMapsKey?(l=W.MAP_STYLE_AERIAL_WITH_LABELS,"BingMapsAerial"===a.type?l=W.MAP_STYLE_AERIAL:"BingMapsRoad"===
a.type&&(l=W.MAP_STYLE_ROAD),n=new W({bingMapsKey:g.bingMapsKey,mapStyle:l,opacity:a.opacity,id:a.id}),r.connect(n,"onError",k.hitch(this,function(a){a.errors=a.errors||[];a.errors.push({message:"This application does not have a valid Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})},a))):(a.errors=a.errors||[],a.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})):a.resourceInfo&&a.resourceInfo.mapName?
n=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||ba(a,c,l)&&ga(a,q,p))?ea(a,U,g):ja(a,U,g):a.resourceInfo&&a.resourceInfo.pixelSizeX?n=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||ba(a,c,l)&&ga(a,q,p))?ea(a,U,g):ka(a,U,g):a.resourceInfo&&"Feature Layer"===a.resourceInfo.type?(a.capabilities&&(a.resourceInfo.capabilities=a.capabilities),n=new K(N(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,mode:a.mode===K.MODE_SELECTION?K.MODE_SELECTION:
K.MODE_AUTO,editable:!1===g.editable?!1:void 0,outFields:["*"],autoGeneralize:!0,refreshInterval:a.refreshInterval}),!g.ignorePopups&&a.popupInfo&&n.setInfoTemplate(new U(a.popupInfo)),a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(l=C.fromJson(a.layerDefinition.drawingInfo.renderer),l.isMaxInclusive=!0,n.setRenderer(l)),a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.labelingInfo&&(l=f.map(a.layerDefinition.drawingInfo.labelingInfo,function(a){return new $a(a)}),
n.setLabelingInfo(l)),a.layerDefinition.definitionExpression&&n.setDefinitionExpression(a.layerDefinition.definitionExpression),h.isDefined(a.layerDefinition.minScale)&&n.setMinScale(a.layerDefinition.minScale),h.isDefined(a.layerDefinition.maxScale)&&n.setMaxScale(a.layerDefinition.maxScale)),ua(n)):a.resourceInfo&&a.resourceInfo.streamUrls&&(l={resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id},a.layerDefinition&&(ca=a.layerDefinition.drawingInfo,a.layerDefinition.definitionGeometry&&
(E=E||{},E.geometry=a.layerDefinition.definitionGeometry),h.isDefined(a.layerDefinition.definitionExpression)&&(E=E||{},E.where=a.layerDefinition.definitionExpression),h.isDefined(a.layerDefinition.maximumTrackPoints)&&(l.maximumTrackPoints=a.layerDefinition.maximumTrackPoints)),E&&(l.filter=E),a.purgeOptions&&(l.purgeOptions=a.purgeOptions),n=new ab(N(a.url),l),ca&&ca.renderer&&(l=ca.renderer,n.setRenderer(C.fromJson(l))),!g.ignorePopups&&a.popupInfo&&n.setInfoTemplate(new U(a.popupInfo)),a.layerDefinition&&
(h.isDefined(a.layerDefinition.minScale)&&n.setMinScale(a.layerDefinition.minScale),h.isDefined(a.layerDefinition.maxScale)&&n.setMaxScale(a.layerDefinition.maxScale)),m.once(n,"error",function(b){a.errors.push({message:"Error loading stream layer. Check websocket url"})}));n&&(n.arcgisProps={title:a.title},a.baseMapLayer&&(a.isReference?(n.attr("data-reference",!0),n._basemapGalleryLayerType="reference"):n._basemapGalleryLayerType="basemap"));return n}function G(a,b,c,d,e){f.forEach(a,function(f){f.layerObject=
la(f,a,b,c,d,e)});var g=f.filter(a,function(a){return!a.isReference}),h=f.filter(a,function(a){return!!a.isReference});return a=g.concat(h)}function B(a){var b=null;a=a[0];a.url&&!a.type?a.resourceInfo.spatialReference&&(b=new e,a.resourceInfo.spatialReference.wkid&&(b.wkid=a.resourceInfo.spatialReference.wkid),a.resourceInfo.spatialReference.wkt&&(b.wkt=a.resourceInfo.spatialReference.wkt)):a.type&&(-1<a.type.indexOf("BingMaps")||"OpenStreetMap"==a.type?b=new e({wkid:102100}):"WMS"==a.type&&(b=new e({wkid:a.spatialReferences[0]})));
return b}function P(a,b,c,d,e,g,h,k){f.forEach(b,function(b){b.url&&!b.type&&(b.resourceInfo=a[b.deferredsPos][1],delete b.deferredsPos)});g=g||B(b);b=G(b,c,g,h,k);e.callback(b);return e}function ua(a){!window.CanvasRenderingContext2D&&a.renderer&&"esri.renderer.HeatmapRenderer"===a.renderer.declaredClass&&a.setRenderer(C.fromJson({type:"simple",symbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:.75,type:"esriSLS",
style:"esriSLSSolid"}}}))}function va(b,c){var d=N(b);return a({url:d,content:{f:"json"},callbackParamName:"callback",error:function(a,b){a.message=a.message?a.message+(" [url:"+d+"]"):"[url:"+d+"]";c.push(a);g.defaults.io.errorHandler(a,b)}})}function wa(b){var c=J.arcgisUrl+"/"+b.itemId+"/data";return a({url:c,content:{f:"json"},callbackParamName:"callback",error:function(a,d){a.message=a.message?a.message+(" [url:"+c+"]"):"[url:"+c+"]";b.errors=b.errors||[];b.errors.push(a);g.defaults.io.errorHandler(a,
d)}})}function xa(a,b,c){var e=new p;if(!(c.featureCollection&&c.featureCollection.layers||c.layers))return console.log("Invalid Feature Collection item data [item id: "+a.itemId+"]: ",c),a.errors=a.errors||[],a.errors.push({message:"Invalid Feature Collection item data. [item id: "+a.itemId+"]"}),e.errback(),e;c.layers&&(c.featureCollection={layers:c.layers},delete c.layers,h.isDefined(c.showLegend)&&(c.featureCollection.showLegend=c.showLegend,delete c.showLegend));ya(a,c.featureCollection,b).then(function(b){c.featureCollection=
b;a.featureCollection&&a.featureCollection.layers?f.forEach(c.featureCollection.layers,function(b,c){var e=a.featureCollection.layers[c];e.popupInfo||e.layerDefinition?e.layerDefinition?(h.isDefined(e.layerDefinition.minScale)&&h.isDefined(e.layerDefinition.maxScale)&&(e.layerDefinition.minScale!==b.layerDefinition.minScale||e.layerDefinition.maxScale!==b.layerDefinition.maxScale)&&(delete b.layerDefinition.minScale,delete b.layerDefinition.maxScale),e.layerDefinition.drawingInfo&&d.toJson(e.layerDefinition.drawingInfo)!==
d.toJson(b.layerDefinition.drawingInfo)&&delete b.layerDefinition.drawingInfo,e.layerDefinition.showLegend!==b.layerDefinition.showLegend&&delete b.layerDefinition.showLegend,e.layerDefinition=k.mixin(e.layerDefinition,b.layerDefinition)):e.layerDefinition=b.layerDefinition:(e.popupInfo=b.popupInfo,e.layerDefinition=b.layerDefinition);e.featureSet=b.featureSet;e.nextObjectId=b.nextObjectId}):(a.featureCollection=a.featureCollection||{},a.featureCollection=k.mixin(a.featureCollection,c.featureCollection));
e.callback(a)});return e}function ya(a,b,c){var d=new p;n(["./csv"],function(e){var g=[];f.forEach(b.layers,function(a){a.featureSet&&a.featureSet.features&&a.featureSet.features.length&&a.featureSet.features[0].geometry&&a.featureSet.features[0].geometry.spatialReference&&(a.deferredsPos=g.length,g.push(e.projectFeatureCollection(a,c,a.featureSet.features[0].geometry.spatialReference)))});(new q(g)).addCallback(function(){f.forEach(b.layers,function(b){h.isDefined(b.deferredsPos)&&(g[b.deferredsPos].results&&
g[b.deferredsPos].results.length?b=g[b.deferredsPos].results[0]:(console.log("Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"),b.errors=b.errors||[],b.errors.push({message:"Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"})),delete b.deferredsPos)});d.callback(b)})});return d}function ma(a,b,c,d,e){var g=new p,h=new p,l=[],r;f.forEach(a.operationalLayers,function(a){a.itemId&&"Feature Collection"==a.type&&l.push(wa(a).then(k.hitch(null,
xa,a,c)))});0===l.length?za(a,b,c,d,h,e):(r=new q(l),r.addCallback(function(f){za(a,b,c,d,h,e)}));h.then(function(a){l=[];f.forEach(a,function(a){var b;a=a.layerObject;a instanceof K&&!a.loaded&&!a.loadError?(b=new p,m.once(a,"load, error",function(){b.callback(a)}),l.push(b)):a&&"esri.layers.WFSLayer"===a.declaredClass&&!a.loadError&&(b=new p,m.once(a,"fromJsonComplete, error",function(c){b.callback(a)}),l.push(b))});if(l.length){var b=new p;r=new q(l);r.addCallback(function(){b.callback(a)});return b.promise}return a}).then(function(a){var b=
[];f.forEach(a,function(a){var c=a.layerObject;c instanceof K?c.loaded&&c.labelingInfo&&(a.showLabels||c._collection)&&b.push(c):c&&"esri.layers.WFSLayer"===c.declaredClass&&c.loaded&&c.labelingInfo&&b.push(c)});b.length?n(["../layers/LabelLayer"],function(c){var d=new c;f.forEach(b,function(a){d.addFeatureLayer(a)});a.push({layerObject:d});g.callback(a)}):g.callback(a)});return g}function za(a,b,c,d,e,g){var h=[],k=[],l=[];f.forEach(a.operationalLayers,function(a,b){if(a.featureCollection&&a.featureCollection.layers){var c=
a.featureCollection.layers.length;f.forEach(a.featureCollection.layers,function(d,e){var g=!0;a.visibleLayers&&-1==f.indexOf(a.visibleLayers,e)&&(g=!1);d.visibility=a.visibility&&g;d.opacity=a.opacity;d.id=(a.id||"operational"+b)+"_"+e;a.title&&(d.title=1!==c&&d.layerDefinition.name&&a.title!==d.layerDefinition.name?a.title+" - "+d.layerDefinition.name:a.title);l.push(d)},this)}else l.push(a)});f.forEach(a.baseMap.baseMapLayers,function(a,b){a.baseMapLayer=!0;a.id=a.id||"base"+b;h.push(a)});f.forEach(l,
function(a,b){a.id=a.id||"operational"+b;h.push(a)});f.forEach(h,function(a){a.url&&!a.type&&(a.deferredsPos=k.length,a.errors=a.errors||[],k.push(va(a.url,a.errors)))});0===k.length?(c=c||B(h),h=G(h,b,c,d,g),e.callback(h)):(new q(k)).addCallback(function(a){P(a,h,b,k,e,c,d,g)});return e}function na(a,b,c,d){var e=a.minScale,g=a.maxScale;if(10.1>=c.version&&b)for(a=b.length-1;0<=a;a--){if(b[a].id==d)if(0==e&&0<b[a].minScale?e=b[a].minScale:0<e&&0==b[a].minScale?e=c.minScale:0<e&&0<b[a].minScale&&
(e=Math.min(e,b[a].minScale)),g=Math.max(c.maxScale||0,b[a].maxScale||0),c.setScaleRange(e,g),-1<b[a].parentLayerId)d=b[a].parentLayerId;else break}else 10.1<c.version&&(f.forEach(a.layerInfos,function(a){a.id==d&&(0==e&&0<a.minScale?e=a.minScale:0<e&&0==a.minScale||0<e&&0<a.minScale&&(e=Math.min(e,a.minScale)),g=Math.max(g||0,a.maxScale||0))}),c.setScaleRange(e,g))}function oa(a,b,c,d){var e=a.url,g=a.__popupIds,l=a.__popupUrls,m=a.__popupWhereClauses,n=a.__popupMinScales,q=a.__popupMaxScales,p=
a.__resourceInfo,t=[];f.forEach(a.__popups,function(d,k){if(d){var u,v=[];f.forEach(d.fieldInfos,function(a){"shape"!==a.fieldName.toLowerCase()&&v.push(a.fieldName)});if(a.dynamicLayerInfos&&0<a.dynamicLayerInfos.length){var w=f.filter(a.dynamicLayerInfos,function(a){return g[k]==a.id})[0].source;u=new K(e+"/dynamicLayer",{id:a.id+"_"+g[k],source:w,outFields:v,mode:K.MODE_SELECTION,infoTemplate:d&&new c(d),drawMode:!1,visible:a.visible,autoGeneralize:!0});var x=function(c,d){0<m[c].length&&d.setDefinitionExpression(m[c]);
if(h.isDefined(n[c])||h.isDefined(q[c]))if(h.isDefined(a.minScale)||h.isDefined(a.maxScale)){var e=a.minScale,f=a.maxScale;0==e&&0<n[c]?e=n[c]:0<e&&0==n[c]||0<e&&0<n[c]&&(e=Math.min(e,n[c]));f=Math.max(f||0,q[c]||0);d.setScaleRange(e,f)}else d.setScaleRange(n[c],q[c]);else na(a,b||p.layers,d,g[c])};u.loaded?x(k,u):r.connect(u,"onLoad",function(a){x(k,u)})}else{var U=null,y=e+"/"+g[k];if(l[k].length)y=l[k];else if(b)for(w=0;w<b.length;w++)if(b[w].id===g[k]){U=b[w];break}u=new K(N(y),{id:a.id+"_"+g[k],
outFields:v,mode:K.MODE_SELECTION,infoTemplate:d&&new c(d),drawMode:!1,visible:a.visible,resourceInfo:U,autoGeneralize:!0});u.loaded?(0<m[k].length&&u.setDefinitionExpression(m[k]),na(a,b||p.layers,u,g[k])):r.connect(u,"onLoad",function(c){0<m[k].length&&u.setDefinitionExpression(m[k]);na(a,b||p.layers,c,g[k])})}t.push(u)}});0<t.length&&(r.connect(a,"onVisibilityChange",k.hitch(this,function(a,b){f.forEach(a,function(a){b?a.show():a.hide()})},t)),r.connect(d,"onLayerRemove",k.hitch(this,function(a,
b,c){a.id===c.id&&f.forEach(b,function(a){d.removeLayer(a)})},a,t)));delete a.__popups;delete a.__popupIds;delete a.__popupUrls;delete a.__popupWhereClauses;delete a.__popupMinScales;delete a.__popupMaxScales;delete a.__resourceInfo;return t}function Aa(b){return a({url:N(b.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}})}function Ba(a,b,c){var d=[];f.forEach(a,function(a){var b=a.__popups;b&&1<b.length&&10<=a.version&&(a.__deferredsPos=d.length,d.push(Aa(a)))});
var e=[];0<d.length?(new q(d)).addCallback(function(d){f.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(a.__deferredsPos||0===a.__deferredsPos?(e=e.concat(oa(a,d[a.__deferredsPos][1].layers,c,b)),delete a.__deferredsPos):e=e.concat(oa(a,null,c,b)))});b.addLayers(e)}):(f.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(e=e.concat(oa(a,null,c,b)))}),b.addLayers(e))}function Ca(a){f.forEach(a,function(a){var b=a.layer;b.toJson&&(a=b.toJson(),a.featureSet&&b.name&&-1<b.name.indexOf("Text")&&
f.forEach(a.featureSet.features,function(a,c){if(a.attributes.TEXT){var d=b.graphics[c];d.symbol.setText(a.attributes.TEXT);a.symbol.horizontalAlignment&&(d.symbol.align=a.symbol.horizontalAlignment);d.setSymbol(d.symbol);d.setAttributes(a.attributes)}},this))})}function Da(a){var b=6;f.forEach(a,function(a){if(a=a.renderer)"esri.renderer.SimpleRenderer"===a.declaredClass?((a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset))),a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))):"esri.renderer.UniqueValueRenderer"!==
a.declaredClass&&"esri.renderer.ClassBreaksRenderer"!==a.declaredClass||f.forEach(a.infos,function(a){(a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset)));a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))})});return b}function sa(a){var b=this,c=b.infoWindow,d=a.graphic;if(b.loaded){c.hide();c.clearFeatures();var e=[];f.forEach(b.graphicsLayerIds,function(a){(a=b.getLayer(a))&&a instanceof K&&a.loaded&&a.visible&&(a.clearSelection(),a.infoTemplate&&!a.suspended&&e.push(a))});f.forEach(b.layerIds,
function(a){(a=b.getLayer(a))&&-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")&&a.loaded&&a.visible&&a.infoTemplate&&e.push(a)});d=d&&d.getInfoTemplate()?d:null;if(e.length||d){var g=Da(e),h=a.screenPoint,k=b.toMap(new z(h.x-g,h.y+g)),g=b.toMap(new z(h.x+g,h.y-g)),k=new A(k.x,k.y,g.x,g.y,b.spatialReference),l=new Q;l.geometry=k;l.timeExtent=b.timeExtent;var m=!0,k=f.map(e,function(b){var c;-1!==b.declaredClass.indexOf("ArcGISImageServiceLayer")?(l.geometry=a.mapPoint,m=!1,c=b.queryVisibleRasters(l,
{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0}),c.addCallback(function(){return b.getVisibleRasters()})):(c=b.selectFeatures(l),c.addCallback(function(){return b.getSelectedFeatures()}));return c});d&&(g=new p,g.callback([d]),k.splice(0,0,g));if(!f.some(k,function(a){return-1===a.fired})){var n=d?1:0;f.forEach(e,function(a){n=-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?n+a.getVisibleRasters().length:n+a.getSelectedFeatures().length});if(!n)return}c.setFeatures(k);c.show(a.mapPoint,
{closestFirst:m})}}}function cb(a,b){var c=b.mapOptions||{},d;c.infoWindow||(d=new M({visibleWhenEmpty:!1},u.create("div")),c.infoWindow=d);h.isDefined(c.showInfoWindowOnClick)||b.usePopupManager||(c.showInfoWindowOnClick=!1);c=new l(a,c);r.connect(c,"onLayersAddResult",Ca);return c}function Y(a,b,c,d,e,g){var h,k,l,m;d.map?(h=d.map,k=d.clickEventHandle,l=d.clickEventListener,m=d.errors):(h=cb(d,e),e.ignorePopups||e.disableClickBehavior||e.usePopupManager||(k=r.connect(h,"onClick",sa),l=sa));h.addLayers(a);
e.ignorePopups||e.usePopupManager||Ba(a,h,e._clazz);var n=m||[];f.forEach(b,function(a){a.errors&&(n=n.concat(a.errors))},this);h.loaded?g.callback({map:h,itemInfo:c,errors:n,clickEventHandle:k,clickEventListener:l}):r.connect(h,"onLoad",function(){g.callback({map:h,itemInfo:c,errors:n,clickEventHandle:k,clickEventListener:l})})}function pa(a,b,c,d,e){var g=[];f.forEach(e,function(a){k.isArray(a.layerObject)?f.forEach(a.layerObject,function(a){g.push(a)}):g.push(a.layerObject)});if("BingMapsAerial"===
e[0].type||"BingMapsRoad"===e[0].type||"BingMapsHybrid"===e[0].type)var h=setInterval(function(){if(e[0].layerObject&&e[0].layerObject.loaded)clearInterval(h),Ea(a,b,c,d,e,g);else if(e[0].errors){clearInterval(h);var f="";e[0].errors&&e[0].errors.length&&(f=" ("+e[0].errors[0].message+")");d.errback(Error(R.arcgis.utils.baseLayerError+f))}},10);else if(!g[0]&&e[0].baseMapLayer){var l="";e[0].errors&&e[0].errors.length&&(l=" ("+e[0].errors[0].message+")");d.errback(Error(R.arcgis.utils.baseLayerError+
l))}else Ea(a,b,c,d,e,g)}function Ea(a,b,c,d,k,l){try{var m=c.mapOptions||{};c.mapOptions=m;var n=a.item,q=a.itemData;!m.backgroundColor&&q.background&&q.background.color&&null!=q.background.color[0]&&(m.backgroundColor=x.toDojoColor(q.background.color));l=f.filter(l,h.isDefined);if(n)if(n.extent&&n.extent.length)if(m.extent)Y(l,k,a,b,c,d);else{var p=new A(n.extent[0][0],n.extent[0][1],n.extent[1][0],n.extent[1][1],new e({wkid:4326})),r=l[0].spatialReference;4326===r.wkid?(m.extent=p,Y(l,k,a,b,c,
d)):102100===r.wkid||102113===r.wkid||3857===r.wkid?(p.xmin=Math.max(p.xmin,-180),p.xmax=Math.min(p.xmax,180),p.ymin=Math.max(p.ymin,-89.99),p.ymax=Math.min(p.ymax,89.99),m.extent=y.geographicToWebMercator(p),Y(l,k,a,b,c,d)):c.geometryServiceURL||g.defaults.geometryService?(c.geometryServiceURL?new ha(c.geometryServiceURL):g.defaults.geometryService).project([p],r,function(e){e=e[0];m.extent=m.extent||e;Y(l,k,a,b,c,d)},function(){Y(l,k,a,b,c,d)}):d.errback(Error(R.arcgis.utils.geometryServiceError))}else Y(l,
k,a,b,c,d);else Y(l,k,a,b,c,d)}catch(eb){d.errback(eb)}}function db(a){var b=[];f.forEach(a.operationalLayers,function(a){a.featureCollection?b.push({featureCollection:a.featureCollection,visibility:a.visibility,title:a.title}):a.layerObject&&b.push({layer:a.layerObject,visibility:a.visibility,title:a.title})});return b}function Fa(a){var b=[];a=a.baseMap.baseMapLayers.concat(a.operationalLayers);f.forEach(a,function(a){var c={};if(a.featureCollection&&"CSV"!==a.type)!0===a.featureCollection.showLegend&&
f.forEach(a.featureCollection.layers,function(d){if(!1!==d.showLegend){var e=d.layerObject.renderer;c={layer:d.layerObject,title:a.title,defaultSymbol:e&&e.defaultSymbol&&e.defaultLabel?!0:!1};1<a.featureCollection.layers.length&&(c.title+=" - "+d.layerDefinition.name);b.push(c)}});else if(a.baseMapLayer&&!0===a.showLegend&&a.layerObject||!a.baseMapLayer&&!1!==a.showLegend&&a.layerObject&&!(a.layerObject instanceof K&&a.layerObject.mode===K.MODE_SELECTION)){var d=a.layerObject.renderer,e=a.layerObject.declaredClass,
d=!d||d&&d.defaultSymbol&&d.defaultLabel?!0:!1;if(10.1>a.layerObject.version&&("esri.layers.ArcGISDynamicMapServiceLayer"===e||"esri.layers.ArcGISTiledMapServiceLayer"===e)||"esri.layers.ArcGISImageServiceLayer"===e)d=!0;c={layer:a.layerObject,title:a.title,defaultSymbol:d};a.layers&&(e=f.map(f.filter(a.layers,function(a){return!1===a.showLegend}),function(a){return a.id}),e.length&&(c.hideLayers=e));b.push(c)}});return b}function fb(a,b){function c(a,b){f.forEach(a,function(a,c){switch(a){case "../layers/ArcGISDynamicMapServiceLayer":Ia=
b[c];break;case "../layers/ArcGISImageServiceLayer":Pa=b[c];break;case "../layers/ArcGISImageServiceVectorLayer":Oa=b[c];break;case "./csv":Ya=b[c];break;case "../layers/CSVLayer":Za=b[c];break;case "../layers/DynamicLayerInfo":Ja=b[c];break;case "../layers/GeoRSSLayer":Xa=b[c];break;case "../layers/ImageParameters":Ha=b[c];break;case "../layers/ImageServiceParameters":La=b[c];break;case "../layers/KMLLayer":Ua=b[c];break;case "../layers/LabelClass":$a=b[c];break;case "../layers/LayerDrawingOptions":Ka=
b[c];break;case "../layers/MosaicRule":Na=b[c];break;case "../layers/OpenStreetMapLayer":Qa=b[c];break;case "../layers/RasterFunction":Ma=b[c];break;case "../layers/StreamLayer":ab=b[c];break;case "../layers/TileInfo":Wa=b[c];break;case "../layers/VectorTileLayer":qa=b[c];break;case "../virtualearth/VETiledLayer":W=b[c];break;case "../layers/WebTiledLayer":Va=b[c];break;case "../layers/WFSLayer":Ra=b[c];break;case "../layers/WMSLayer":Ta=b[c];break;case "../layers/WMSLayerInfo":Sa=b[c]}})}var d=new p,
e=a.itemData,g=[];e.baseMap&&e.baseMap.baseMapLayers&&(g=g.concat(e.baseMap.baseMapLayers));e.operationalLayers&&(g=g.concat(e.operationalLayers));for(var e=f.map(g,function(a){return a&&a.layerType}),h=[],k=[],g=!1,l=0;l<e.length;l++){switch(e[l]){case "ArcGISFeatureLayer":-1===f.indexOf(h,"../layers/LabelClass")&&h.push("../layers/LabelClass");break;case "ArcGISImageServiceLayer":case "ArcGISTiledImageServiceLayer":-1===f.indexOf(h,"../layers/ArcGISImageServiceLayer")&&(h.push("../layers/ArcGISImageServiceLayer"),
k.push("../layers/ImageServiceParameters"),k.push("../layers/MosaicRule"),k.push("../layers/RasterFunction"));break;case "ArcGISImageServiceVectorLayer":-1===f.indexOf(h,"../layers/ArcGISImageServiceVectorLayer")&&(h.push("../layers/ArcGISImageServiceVectorLayer"),k.push("../layers/ImageServiceParameters"),k.push("../layers/MosaicRule"),k.push("../layers/RasterFunction"));break;case "ArcGISMapServiceLayer":case "ArcGISTiledMapServiceLayer":-1===f.indexOf(h,"../layers/ArcGISDynamicMapServiceLayer")&&
(h.push("../layers/ArcGISDynamicMapServiceLayer"),k.push("../layers/DynamicLayerInfo"),k.push("../layers/ImageParameters"),k.push("../layers/LayerDrawingOptions"));break;case "ArcGISStreamLayer":-1===f.indexOf(h,"../layers/StreamLayer")&&h.push("../layers/StreamLayer");break;case "BingMapsAerial":case "BingMapsHybrid":case "BingMapsRoad":-1===f.indexOf(h,"../virtualearth/VETiledLayer")&&h.push("../virtualearth/VETiledLayer");break;case "CSV":-1===f.indexOf(h,"../layers/CSVLayer")&&(h.push("../layers/CSVLayer"),
k.push("./csv"));break;case "GeoRSS":-1===f.indexOf(h,"../layers/GeoRSSLayer")&&h.push("../layers/GeoRSSLayer");break;case "KML":-1===f.indexOf(h,"../layers/KMLLayer")&&h.push("../layers/KMLLayer");break;case "OpenStreetMap":-1===f.indexOf(h,"../layers/OpenStreetMapLayer")&&h.push("../layers/OpenStreetMapLayer");break;case "VectorTileLayer":-1===f.indexOf(h,"../layers/VectorTileLayer")&&h.push("../layers/VectorTileLayer");break;case "WebTiledLayer":-1===f.indexOf(h,"../layers/WebTiledLayer")&&(h.push("../layers/WebTiledLayer"),
k.push("../layers/TileInfo"));break;case "WFS":-1===f.indexOf(h,"../layers/WFSLayer")&&h.push("../layers/WFSLayer");break;case "WMS":-1===f.indexOf(h,"../layers/WMSLayer")&&(h.push("../layers/WMSLayer"),k.push("../layers/WMSLayerInfo"));break;default:g=!0}if(g)break}g&&(h=gb,k=hb);h.length?n(h,function(){c(h,arguments);k.length?n(k,function(){c(k,arguments);d.resolve()}):d.resolve()}):d.resolve();return d}function bb(a,b,c,d){var e=d.itemData;e.baseMap&&e.baseMap.baseMapLayers&&e.baseMap.baseMapLayers.length&&
(e.baseMap.baseMapLayers[0].firstLayer=!0);var g=b.layerMixins,h=g&&g.length;if(h){var l=function(a){for(var b=0;b<h;b++){var c=g[b];if(c.mixin)if(c.hasOwnProperty("id")){if(a.id===c.id){k.mixin(a,c.mixin);break}}else if(a.url===c.url){k.mixin(a,c.mixin);break}}};f.forEach(e.baseMap&&e.baseMap.baseMapLayers,l);f.forEach(e.operationalLayers,l)}fb(d,b).then(function(){return F(d,b)}).then(function(){return H(d,b)}).then(function(b){var d=b[0],e=b[1];if(d.itemData.operationalLayers&&0!==d.itemData.operationalLayers.length){var g=
new p,h=d.itemData.baseMap.baseMapLayers.slice(),l=f.filter(d.itemData.baseMap.baseMapLayers,function(a){return!a.isReference});b={item:d.item,itemData:{baseMap:{baseMapLayers:l}}};d.itemData.baseMap.baseMapLayers=f.filter(d.itemData.baseMap.baseMapLayers,function(a){return a.isReference});X(b,e).addCallback(function(b){ma(b.itemData,e).addCallback(k.hitch(null,pa,b,a,e,g))});g.then(function(a){X(d,e).addCallback(function(b){ma(b.itemData,e,a.map.spatialReference,l,a.map).addCallback(function(d){b.itemData.baseMap.baseMapLayers=
h;pa(b,a,e,c,d)})})},k.hitch(c,c.errback))}else X(d,e).addCallback(function(b){ma(b.itemData,e).addCallback(k.hitch(null,pa,b,a,e,c))})})}function ta(b,c){"undefined"===typeof c&&(c=!0);J._arcgisUrl&&0<J._arcgisUrl.length&&(J.arcgisUrl=J._arcgisUrl);var d=J.arcgisUrl+"/"+b,e={},f=new p;a({url:d,content:{f:"json"},callbackParamName:"callback",load:function(b){e.item=b;c?a({url:d+"/data",content:{f:"json"},callbackParamName:"callback",load:function(a){e.itemData=a;f.callback(e)},error:function(a){f.errback(a)}}):
f.callback(e)},error:function(a){f.errback(a)}});return f}var J,Ia,Pa,Oa,Ya,Za,Ja,Xa,Ha,La,Ua,$a,Ka,Na,Qa,Ma,ab,Wa,qa,W,Va,Ra,Ta,Sa,gb="../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/ArcGISImageServiceVectorLayer ../layers/CSVLayer ../layers/GeoRSSLayer ../layers/KMLLayer ../layers/LabelClass ../layers/OpenStreetMapLayer ../layers/StreamLayer ../layers/VectorTileLayer ../virtualearth/VETiledLayer ../layers/WebTiledLayer ../layers/WFSLayer ../layers/WMSLayer".split(" "),
hb="./csv ../layers/DynamicLayerInfo ../layers/ImageParameters ../layers/ImageServiceParameters ../layers/LayerDrawingOptions ../layers/MosaicRule ../layers/RasterFunction ../layers/TileInfo ../layers/WMSLayerInfo".split(" ");J={arcgisUrl:v.getProtocolForWebResource()+"//www.arcgis.com/sharing/rest/content/items",getItem:ta,createMap:function(a,b,c){var d=new p;c=c||{};var e=c.infoTemplateClass;c._clazz=e&&(k.isObject(e)?e:k.getObject(e))||D;k.isString(a)?ta(a).addCallback(k.hitch(null,bb,b,c,d)).addErrback(k.hitch(d,
d.errback)):bb(b,c,d,a);return d},getLayerList:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?db(a.itemInfo.itemData):[]},getLegendLayers:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?Fa(a.itemInfo.itemData):[]},_arcgisUrl:null,_getItemProps:X,_getItemData:S,_getBingKey:da,_portalUrlResponse:L,_portalUrlFailure:I,_processFSItemProperties:aa,_processSSItemProperties:ia,_getLayers:ma,_preBuildLayerObjects:P,_buildLayerObjects:G,_preCreateMap:pa,_getMapSR:B,_createMap:Y,_addSelectionLayers:Ba,
_createSelectionFeatureLayers:oa,_getServiceInfo:va,_getFeatureCollectionItem:wa,_mergeFeatureCollectionItem:xa,_projectFeatureCollection:ya,_getLayersInfo:Aa,_initLayer:la,_loadAsCached:ea,_loadAsDynamic:ja,_processPopups:V,_onLayersAddResult:Ca,_sameSpatialReferenceAsBasemap:ba,_sameTilingSchemeAsBasemap:ga,_showPopup:sa,_calculateClickTolerance:Da,_getVisibleFeatureLayers:fa,_updateLayerScaleInfo:na,_checkUrl:N,_isHostedService:O,_isAgolService:Z,_getLegendLayers:Fa};k.setObject("arcgis.utils",
J,b);return J});